diff --git a/.diff.swp b/.diff.swp
deleted file mode 100644
index a090463..0000000
Binary files a/.diff.swp and /dev/null differ
diff --git a/CASES/AYOTTE/AYOTTE_A00SC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A00SC_driver_FC_RR.nc
index 1eecde7..d0108eb 100644
Binary files a/CASES/AYOTTE/AYOTTE_A00SC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A00SC_driver_FC_RR.nc differ
diff --git a/CASES/AYOTTE/AYOTTE_A00WC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A00WC_driver_FC_RR.nc
index d4d7fc3..299db43 100644
Binary files a/CASES/AYOTTE/AYOTTE_A00WC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A00WC_driver_FC_RR.nc differ
diff --git a/CASES/AYOTTE/AYOTTE_A03SC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A03SC_driver_FC_RR.nc
index 303b5c2..f9b7aa5 100644
Binary files a/CASES/AYOTTE/AYOTTE_A03SC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A03SC_driver_FC_RR.nc differ
diff --git a/CASES/AYOTTE/AYOTTE_A05SC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A05SC_driver_FC_RR.nc
index d2f0806..12a20bb 100644
Binary files a/CASES/AYOTTE/AYOTTE_A05SC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A05SC_driver_FC_RR.nc differ
diff --git a/CASES/AYOTTE/AYOTTE_A05WC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A05WC_driver_FC_RR.nc
index 169bc99..cedc9f9 100644
Binary files a/CASES/AYOTTE/AYOTTE_A05WC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A05WC_driver_FC_RR.nc differ
diff --git a/CASES/AYOTTE/AYOTTE_A24F_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A24F_driver_FC_RR.nc
index b3efd1c..d9629f1 100644
Binary files a/CASES/AYOTTE/AYOTTE_A24F_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A24F_driver_FC_RR.nc differ
diff --git a/CASES/AYOTTE/AYOTTE_A24SC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A24SC_driver_FC_RR.nc
index 34805f6..4ac2021 100644
Binary files a/CASES/AYOTTE/AYOTTE_A24SC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A24SC_driver_FC_RR.nc differ
diff --git a/CASES/AYOTTE/convert_AYOTTE_A00SC.py b/CASES/AYOTTE/convert_AYOTTE_A00SC.py
index 9735e52..d91eefe 100644
--- a/CASES/AYOTTE/convert_AYOTTE_A00SC.py
+++ b/CASES/AYOTTE/convert_AYOTTE_A00SC.py
@@ -18,7 +18,7 @@ f.close()
 time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
 time.designateTime()
 time.id = 'time'
-time.units = 'seconds since 2009-12-11 10:00:00'
+time.units = 'seconds since 2009-12-11 00:00:00'
 time.calendar = 'gregorian'
 
 lat = MV2.zeros(1,typecode=MV2.float32) + 45
@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
 g.author = "F Couvreux"
 g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
 g.case = "AYOTTE_00SC" 
-g.startDate = "20091211100000" 
-g.endDate = "20091211160000" 
+g.startDate = "20091211000000" 
+g.endDate =   "20091211060000" 
 g.qadvh = 0 
 g.tadvh = 0 
 g.qadvv = 0 
diff --git a/CASES/AYOTTE/convert_AYOTTE_A00WC.py b/CASES/AYOTTE/convert_AYOTTE_A00WC.py
index 9eeffa0..0e1ddbd 100644
--- a/CASES/AYOTTE/convert_AYOTTE_A00WC.py
+++ b/CASES/AYOTTE/convert_AYOTTE_A00WC.py
@@ -18,7 +18,7 @@ f.close()
 time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
 time.designateTime()
 time.id = 'time'
-time.units = 'seconds since 2009-12-11 10:00:00'
+time.units = 'seconds since 2009-12-11 00:00:00'
 time.calendar = 'gregorian'
 
 lat = MV2.zeros(1,typecode=MV2.float32) + 45
@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
 g.author = "F Couvreux"
 g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
 g.case = "AYOTTE_00WC" 
-g.startDate = "20091211100000" 
-g.endDate = "20091211160000" 
+g.startDate = "20091211000000" 
+g.endDate =   "20091211060000" 
 g.qadvh = 0 
 g.tadvh = 0 
 g.qadvv = 0 
diff --git a/CASES/AYOTTE/convert_AYOTTE_A03SC.py b/CASES/AYOTTE/convert_AYOTTE_A03SC.py
index 70b648e..01794e6 100644
--- a/CASES/AYOTTE/convert_AYOTTE_A03SC.py
+++ b/CASES/AYOTTE/convert_AYOTTE_A03SC.py
@@ -18,7 +18,7 @@ f.close()
 time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
 time.designateTime()
 time.id = 'time'
-time.units = 'seconds since 2009-12-11 10:00:00'
+time.units = 'seconds since 2009-12-11 00:00:00'
 time.calendar = 'gregorian'
 
 lat = MV2.zeros(1,typecode=MV2.float32) + 45
@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
 g.author = "F Couvreux"
 g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
 g.case = "AYOTTE_03SC" 
-g.startDate = "20091211100000" 
-g.endDate = "20091211160000" 
+g.startDate = "20091211000000" 
+g.endDate =   "20091211060000" 
 g.qadvh = 0 
 g.tadvh = 0 
 g.qadvv = 0 
diff --git a/CASES/AYOTTE/convert_AYOTTE_A05SC.py b/CASES/AYOTTE/convert_AYOTTE_A05SC.py
index 8e91241..493f760 100644
--- a/CASES/AYOTTE/convert_AYOTTE_A05SC.py
+++ b/CASES/AYOTTE/convert_AYOTTE_A05SC.py
@@ -18,7 +18,7 @@ f.close()
 time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
 time.designateTime()
 time.id = 'time'
-time.units = 'seconds since 2009-12-11 10:00:00'
+time.units = 'seconds since 2009-12-11 00:00:00'
 time.calendar = 'gregorian'
 
 lat = MV2.zeros(1,typecode=MV2.float32) + 45
@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
 g.author = "F Couvreux"
 g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
 g.case = "AYOTTE_05SC" 
-g.startDate = "20091211100000" 
-g.endDate = "20091211160000" 
+g.startDate = "20091211000000" 
+g.endDate =   "20091211060000" 
 g.qadvh = 0 
 g.tadvh = 0 
 g.qadvv = 0 
diff --git a/CASES/AYOTTE/convert_AYOTTE_A05WC.py b/CASES/AYOTTE/convert_AYOTTE_A05WC.py
index a9be406..5763359 100644
--- a/CASES/AYOTTE/convert_AYOTTE_A05WC.py
+++ b/CASES/AYOTTE/convert_AYOTTE_A05WC.py
@@ -18,7 +18,7 @@ f.close()
 time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
 time.designateTime()
 time.id = 'time'
-time.units = 'seconds since 2009-12-11 10:00:00'
+time.units = 'seconds since 2009-12-11 00:00:00'
 time.calendar = 'gregorian'
 
 lat = MV2.zeros(1,typecode=MV2.float32) + 45
@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
 g.author = "F Couvreux"
 g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
 g.case = "AYOTTE_05WC" 
-g.startDate = "20091211100000" 
-g.endDate = "20091211160000" 
+g.startDate = "20091211000000" 
+g.endDate =   "20091211060000" 
 g.qadvh = 0 
 g.tadvh = 0 
 g.qadvv = 0 
diff --git a/CASES/AYOTTE/convert_AYOTTE_A24F.py b/CASES/AYOTTE/convert_AYOTTE_A24F.py
index 3fc2662..deb2931 100644
--- a/CASES/AYOTTE/convert_AYOTTE_A24F.py
+++ b/CASES/AYOTTE/convert_AYOTTE_A24F.py
@@ -18,7 +18,7 @@ f.close()
 time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
 time.designateTime()
 time.id = 'time'
-time.units = 'seconds since 2009-12-11 10:00:00'
+time.units = 'seconds since 2009-12-11 00:00:00'
 time.calendar = 'gregorian'
 
 lat = MV2.zeros(1,typecode=MV2.float32) + 45
@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
 g.author = "F Couvreux"
 g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
 g.case = "AYOTTE_24F" 
-g.startDate = "20091211100000" 
-g.endDate = "20091211160000" 
+g.startDate = "20091211000000" 
+g.endDate =   "20091211060000" 
 g.qadvh = 0 
 g.tadvh = 0 
 g.qadvv = 0 
diff --git a/CASES/AYOTTE/convert_AYOTTE_A24SC.py b/CASES/AYOTTE/convert_AYOTTE_A24SC.py
index 287d0b1..961adea 100644
--- a/CASES/AYOTTE/convert_AYOTTE_A24SC.py
+++ b/CASES/AYOTTE/convert_AYOTTE_A24SC.py
@@ -18,7 +18,7 @@ f.close()
 time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
 time.designateTime()
 time.id = 'time'
-time.units = 'seconds since 2009-12-11 10:00:00'
+time.units = 'seconds since 2009-12-11 00:00:00'
 time.calendar = 'gregorian'
 
 lat = MV2.zeros(1,typecode=MV2.float32) + 45
@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
 g.author = "F Couvreux"
 g.modifications = "2017-07-17: R. Roehrig put all fields on the same vertical and time axes"
 g.case = "AYOTTE_24SC" 
-g.startDate = "20091211100000" 
-g.endDate = "20091211160000" 
+g.startDate = "20091211000000" 
+g.endDate =   "20091211060000" 
 g.qadvh = 0 
 g.tadvh = 0 
 g.qadvv = 0 
diff --git a/CASES/BOMEX/BOMEX_driver_MPL_RR.nc b/CASES/BOMEX/BOMEX_driver_MPL_RR.nc
index d9ad6f5..6f92a24 100644
Binary files a/CASES/BOMEX/BOMEX_driver_MPL_RR.nc and b/CASES/BOMEX/BOMEX_driver_MPL_RR.nc differ
diff --git a/CASES/BOMEX/convert.py b/CASES/BOMEX/convert.py
index 2fd0eb8..c97aa5b 100644
--- a/CASES/BOMEX/convert.py
+++ b/CASES/BOMEX/convert.py
@@ -59,6 +59,13 @@ data['sfc_lat_flx'].id = 'sfc_lat_flx'
 data['sfc_lat_flx'].units = 'W/m2'
 data['sfc_lat_flx'].title = 'Surface latent heat flux'
 
+data['ustar'] = data['sfc_lat_flx']*0.+0.28
+data['ustar'].id = 'ustar'
+data['ustar'].units = 'm s-1'
+data['ustar'].title = 'usar'
+
+
+
 for ilev in range(0,nlev):
   if lev[ilev] <= 300:
       data['qadvh'][:,ilev,:,:] = -1.2e-8
@@ -78,7 +85,7 @@ data['theta'].id = 'theta'
 
 g = cdms2.open('BOMEX_driver_MPL_RR.nc','w')
 
-for var in ['height','pressure','ps','temp','theta','qv','u','v','w','trad','thrad','qadvh','ug','vg','sfc_sens_flx','sfc_lat_flx','ts']:
+for var in ['height','pressure','ps','temp','theta','qv','u','v','w','trad','thrad','qadvh','ug','vg','sfc_sens_flx','sfc_lat_flx','ts','ustar']:
     if len(data[var].shape) == 4:
         data[var].setAxis(1,lev)
     data[var].setAxis(0,time)
@@ -89,7 +96,7 @@ g.author = "MP Lefebvre (20170628), R. Roehrig (20180404)" ;
 g.version = "20180404" ;
 g.case = "BOMEX" ;
 g.startDate = "19690624000000" ;
-g.endDate = "19690624060000" ;
+g.endDate = "19690624230000" ;
 g.comment = """Forcing and initial confitions for BOMEX case
 Large-scale subsidence w applied to qt, thetal, u, v
 Radiative cooling dtheta/dt
@@ -110,11 +117,11 @@ g.nudging_v = 0
 g.nudging_t = 0
 g.nudging_q = 0
 g.zorog = 0.
-g.z0 = 0.001019
+#g.z0 = 0.001019
 #g.ustar = 0.28
 g.surfaceType = "ocean"
 g.surfaceForcing = "surfaceFlux"
-g.surfaceForcingWind = "z0"
+g.surfaceForcingWind = "ustar"
 
 g.close()
 
diff --git a/CASES/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc b/CASES/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc
index 4d58f73..b47227b 100644
Binary files a/CASES/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc and b/CASES/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc differ
diff --git a/CASES/CINDY-DYNAMO/NSA3a/cindy_nsa3a.nc b/CASES/CINDY-DYNAMO/NSA3a/cindy_nsa3a.nc
index d8f54bb..f253c7b 100644
Binary files a/CASES/CINDY-DYNAMO/NSA3a/cindy_nsa3a.nc and b/CASES/CINDY-DYNAMO/NSA3a/cindy_nsa3a.nc differ
diff --git a/CASES/CINDY-DYNAMO/NSA3a/convert2nc.py b/CASES/CINDY-DYNAMO/NSA3a/convert2nc.py
index e00c49c..75ccd3e 100644
--- a/CASES/CINDY-DYNAMO/NSA3a/convert2nc.py
+++ b/CASES/CINDY-DYNAMO/NSA3a/convert2nc.py
@@ -457,7 +457,7 @@ data['vqs'   ] = data['vqs'] / 1000. * -1
 data['flat'  ] = data['flat'] /3.45*100.
 data['sens'  ] = data['sens'] /3.45*100.
 data['Qrad'  ] = data['Qrad'] /3.45*100.
-data['Qrad_CERES'] = data['Qrad'] /3.45*100.
+data['Qrad_CERES'] = data['Qrad_CERES'] /3.45*100.
 
 data['advTs' ] = data['hTs'] + data['vTs']
 data['advqs' ] = data['hqs'] + data['vqs']
diff --git a/CASES/CINDY-DYNAMO/NSA3a/convertDEPHY2_flux.py b/CASES/CINDY-DYNAMO/NSA3a/convertDEPHY2_flux.py
index 2135391..55fb0b3 100644
--- a/CASES/CINDY-DYNAMO/NSA3a/convertDEPHY2_flux.py
+++ b/CASES/CINDY-DYNAMO/NSA3a/convertDEPHY2_flux.py
@@ -97,6 +97,7 @@ g.z0 = 0.01
 g.ustar = 0.
 g.surfaceType = 'ocean'
 g.surfaceForcing = 'surfaceFlux'
+g.surfaceForcingWind = 'z0'
 
 g.close()
 
diff --git a/CASES/EMS_cases.py b/CASES/EMS_cases.py
index 39f2929..daf841a 100644
--- a/CASES/EMS_cases.py
+++ b/CASES/EMS_cases.py
@@ -110,8 +110,8 @@ case = 'FIRE'
 cases.append(case)
 subcases[case] = ['REF']
 data_input[case] = {}
-#data_input[case]['REF'] = rep0 + '/FIRE/Fire-I_driver_RR.nc'
-data_input[case]['REF'] = rep0 + '/FIRE/Fire-I_driver_RR_v3.nc'
+#data_input[case]['REF'] = rep0 + '/FIRE/Fire-I_driver_RR_v3.nc'
+data_input[case]['REF'] = rep0 + '/FIRE/Fire-I_driver_RR.nc'
 
 # DYCOMS Case
 case = 'DYCOMS'
@@ -120,6 +120,22 @@ subcases[case] = ['REF']
 data_input[case] = {}
 data_input[case]['REF'] = rep0 + '/DYCOMS/DYCOMS_driver_FC_RR.nc'
 
+# ASTEX cases
+case = 'ASTEX'
+cases.append(case)
+subcases[case] = ['EUCLIPSE']
+data_input[case] = {}
+data_input[case]['EUCLIPSE'] = rep0 + '/ASTEX/ASTEX_GASS-EUCLIPSE_driver_RR.nc'
+
+# SANDU composite cases
+case = 'SANDU'
+cases.append(case)
+subcases[case] = ['REF','FAST','SLOW']
+data_input[case] = {}
+data_input[case]['REF'] = rep0 + '/SANDU/Composite_REF_driver_RR.nc'
+data_input[case]['FAST'] = rep0 + '/SANDU/Composite_FAST_driver_RR.nc'
+data_input[case]['SLOW'] = rep0 + '/SANDU/Composite_SLOW_driver_RR.nc'
+
 ####################################
 #### Deep convection cases
 
@@ -151,9 +167,10 @@ data_input[case]['REF'] = rep0 + '/AMMA/AMMA_20060710_setupI_driver_RR.nc'
 case = 'CINDY-DYNAMO'
 cases.append(case)
 #subcases[case] = ['NSA3a','NSA3aflux','SSA3a']
-subcases[case] = ['NSA3a']
-subcases[case] = ['Revelle-ARM-CSU-13Nov']
-subcases[case] = ['Revelle-PE-13Nov']
+#subcases[case] = ['NSA3a']
+subcases[case] = ['NSA3aflux']
+#subcases[case] = ['Revelle-ARM-CSU-13Nov']
+#subcases[case] = ['Revelle-PE-13Nov']
 data_input[case] = {}
 data_input[case]['NSA3a'] = rep0 + '/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3a_driver_RR.nc'
 data_input[case]['NSA3aflux'] = rep0 + '/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc'
diff --git a/CASES/FIRE/Fire-I_driver_RR.nc b/CASES/FIRE/Fire-I_driver_RR.nc
index 43356b5..0bb9b29 100644
Binary files a/CASES/FIRE/Fire-I_driver_RR.nc and b/CASES/FIRE/Fire-I_driver_RR.nc differ
diff --git a/CASES/FIRE/convert_v3.py b/CASES/FIRE/convert_v3.py
index badf324..c9edf39 100644
--- a/CASES/FIRE/convert_v3.py
+++ b/CASES/FIRE/convert_v3.py
@@ -148,12 +148,9 @@ for ilev in range(0,nlev):
     elif lev[ilev] <= 2000:
         data['thl'][:,ilev,:,:] = data['thl'][:,ilev,:,:] + 299.5 + 7.5e-3*(lev[ilev]-595)
         data['qt'][:,ilev,:,:] = data['qt'][:,ilev,:,:] + 0.0066 - 3.e-6*(lev[ilev]-595)
-        data['thladvh'][:,ilev,:,:] = data['thladvh'][:,ilev,:,:] -7.5e-8*max(lev[ilev],500.)
-        data['qtadvh'][:,ilev,:,:] = data['qtadvh'][:,ilev,:,:] +3.e-11*max(lev[ilev],500.)
-        data['w'][:,ilev,:,:] = data['w'][:,ilev,:,:] - 1.e-5*lev[ilev]
     else:
         data['thl'][:,ilev,:,:] = thstd2[ilev]+(299.5 + 7.5e-3*(2000-595)-thstd2[ilev])*math.exp(-(lev[ilev]-2000)/3000.)
-        data['qt'][:,ilev,:,:] = (0.0066 - 3.e-6*(2000.-595.))*math.exp(-(lev[ilev]-2000)/3000.)
+        data['qt'][:,ilev,:,:] = 0. #(0.0066 - 3.e-6*(2000.-595.))*math.exp(-(lev[ilev]-2000)/3000.)
 
 kappa = 2./7.
 p0 = 100000.
diff --git a/CASES/FIRE/images/height.png b/CASES/FIRE/images/height.png
index afad045..e8196fe 100644
Binary files a/CASES/FIRE/images/height.png and b/CASES/FIRE/images/height.png differ
diff --git a/CASES/FIRE/images/pressure.png b/CASES/FIRE/images/pressure.png
index 8ea230b..19f75f9 100644
Binary files a/CASES/FIRE/images/pressure.png and b/CASES/FIRE/images/pressure.png differ
diff --git a/CASES/FIRE/images/ql.png b/CASES/FIRE/images/ql.png
new file mode 100644
index 0000000..afeeef0
Binary files /dev/null and b/CASES/FIRE/images/ql.png differ
diff --git a/CASES/FIRE/images/qt.png b/CASES/FIRE/images/qt.png
index 3fd32bc..a78e554 100644
Binary files a/CASES/FIRE/images/qt.png and b/CASES/FIRE/images/qt.png differ
diff --git a/CASES/FIRE/images/qtadvh.png b/CASES/FIRE/images/qtadvh.png
index 18eff78..045765f 100644
Binary files a/CASES/FIRE/images/qtadvh.png and b/CASES/FIRE/images/qtadvh.png differ
diff --git a/CASES/FIRE/images/qv.png b/CASES/FIRE/images/qv.png
index c5bb47c..24c9c0e 100644
Binary files a/CASES/FIRE/images/qv.png and b/CASES/FIRE/images/qv.png differ
diff --git a/CASES/FIRE/images/rh.png b/CASES/FIRE/images/rh.png
new file mode 100644
index 0000000..27d11b8
Binary files /dev/null and b/CASES/FIRE/images/rh.png differ
diff --git a/CASES/FIRE/images/tadvh.png b/CASES/FIRE/images/tadvh.png
index c9fcf48..9987717 100644
Binary files a/CASES/FIRE/images/tadvh.png and b/CASES/FIRE/images/tadvh.png differ
diff --git a/CASES/FIRE/images/temp.png b/CASES/FIRE/images/temp.png
index 67a4436..dad5e38 100644
Binary files a/CASES/FIRE/images/temp.png and b/CASES/FIRE/images/temp.png differ
diff --git a/CASES/FIRE/images/theta.png b/CASES/FIRE/images/theta.png
new file mode 100644
index 0000000..67532fd
Binary files /dev/null and b/CASES/FIRE/images/theta.png differ
diff --git a/CASES/FIRE/images/thl.png b/CASES/FIRE/images/thl.png
index a5262f5..2fd71b6 100644
Binary files a/CASES/FIRE/images/thl.png and b/CASES/FIRE/images/thl.png differ
diff --git a/CASES/FIRE/images/thladvh.png b/CASES/FIRE/images/thladvh.png
index dc9ee9a..8445ade 100644
Binary files a/CASES/FIRE/images/thladvh.png and b/CASES/FIRE/images/thladvh.png differ
diff --git a/CASES/FIRE/images/ths.png b/CASES/FIRE/images/ths.png
new file mode 100644
index 0000000..e2e9043
Binary files /dev/null and b/CASES/FIRE/images/ths.png differ
diff --git a/CASES/FIRE/images/thv.png b/CASES/FIRE/images/thv.png
new file mode 100644
index 0000000..6c8bf7e
Binary files /dev/null and b/CASES/FIRE/images/thv.png differ
diff --git a/CASES/FIRE/images/u.png b/CASES/FIRE/images/u.png
index 25f5b01..df64a38 100644
Binary files a/CASES/FIRE/images/u.png and b/CASES/FIRE/images/u.png differ
diff --git a/CASES/FIRE/images/ug.png b/CASES/FIRE/images/ug.png
index 79e4499..4f5d881 100644
Binary files a/CASES/FIRE/images/ug.png and b/CASES/FIRE/images/ug.png differ
diff --git a/CASES/FIRE/images/v.png b/CASES/FIRE/images/v.png
index 39bb720..1c2fe55 100644
Binary files a/CASES/FIRE/images/v.png and b/CASES/FIRE/images/v.png differ
diff --git a/CASES/FIRE/images/vg.png b/CASES/FIRE/images/vg.png
index fe4a642..ee8e828 100644
Binary files a/CASES/FIRE/images/vg.png and b/CASES/FIRE/images/vg.png differ
diff --git a/CASES/FIRE/images/w.png b/CASES/FIRE/images/w.png
index cb406a7..a5bf865 100644
Binary files a/CASES/FIRE/images/w.png and b/CASES/FIRE/images/w.png differ
diff --git a/CASES/FIRE/qtadvh.gif b/CASES/FIRE/qtadvh.gif
deleted file mode 100644
index 687e30d..0000000
Binary files a/CASES/FIRE/qtadvh.gif and /dev/null differ
diff --git a/CASES/FIRE/thladvh.gif b/CASES/FIRE/thladvh.gif
deleted file mode 100644
index d516cfa..0000000
Binary files a/CASES/FIRE/thladvh.gif and /dev/null differ
diff --git a/CASES/RICO/convert.py b/CASES/RICO/convert.py
index 3fa9deb..85dd2ef 100644
--- a/CASES/RICO/convert.py
+++ b/CASES/RICO/convert.py
@@ -49,8 +49,17 @@ tmp.setAxis(2,lat)
 tmp.setAxis(3,lon)
 data[var] = tmp
 
+nlev,nlat,nlon = data['temp'].shape
 
-for var in ['temp','qv','u','v','height','pressure']:
+data['tke'] = data['temp']*0.
+for ilev in range(0,nlev):
+    data['tke'][ilev,0,0] = max(0,1-data['height'][ilev,0,0]/4000.) 
+
+data['tke'].id = 'tke'
+data['tke'].title = 'TKE'
+data['tke'].units = 'm2 s-2'
+
+for var in ['temp','qv','u','v','height','pressure','tke']:
   nlev,nlat,nlon = data[var].shape	
   tmp = data[var].reshape((1,nlev,nlat,nlon))
   for att in data[var].listattributes():
@@ -64,7 +73,7 @@ for var in ['temp','qv','u','v','height','pressure']:
   data[var] = tmp
 
 g = cdms2.open('rico_driver_RR.nc','w')
-for var in f.listvariables():
+for var in f.listvariables() + ['tke',]:
   if len(data[var].shape) == 4:	
     data[var].setAxis(1,lev)
     data[var].setAxis(2,lat)
@@ -87,13 +96,14 @@ g.author = 'R. Roehrig'
 
 g.case = 'RICO'
 g.startDate = '20041216000000'
-g.endDate =   '20041218210000'
+g.endDate =   '20041217000000'
+#g.endDate =   '20041218210000'
 
 g.qadvh = 1
 g.tadvh = 1
 g.tadvv = 0
 g.qadvv = 0
-g.trad = 0 #1 ????
+g.trad = "adv" #0 #1 ????
 
 g.forc_omega = 1
 g.forc_w = 0
diff --git a/CASES/RICO/rico_driver_RR.nc b/CASES/RICO/rico_driver_RR.nc
index 981b320..2be6ed1 100644
Binary files a/CASES/RICO/rico_driver_RR.nc and b/CASES/RICO/rico_driver_RR.nc differ
diff --git a/Examples/config/config_41t1_AROME_OPER.py b/Examples/config/config_41t1_AROME_OPER.py
index 13c027b..e49408e 100644
--- a/Examples/config/config_41t1_AROME_OPER.py
+++ b/Examples/config/config_41t1_AROME_OPER.py
@@ -5,7 +5,7 @@ rep0 = os.getenv('REP_MUSC')
 config = 'AROME_OPER'
 cycle = '41t1_op1.11_MUSC'
 MASTER = '/home/roehrig/pack/' + cycle + '/bin/MASTERODB'
-#PGD = '/home/roehrig/pack/' + cycle + '/bin/PGD'
-#PREP = '/home/roehrig/pack/' + cycle + '/bin/PREP'
+PGD = '/home/roehrig/pack/' + cycle + '/bin/PGD'
+PREP = '/home/roehrig/pack/' + cycle + '/bin/PREP'
 namATMref = rep0 + '/namelist/AROME/namarp_41t1_AROME_HTUNE'
 #namSFXref = rep0 + '/namelist/SURFEX/nam.sfx.tl127.CMIP6.v631'
diff --git a/Examples/config/config_46t1_AROME_EMI.py b/Examples/config/config_46t1_AROME_EMI.py
deleted file mode 100644
index a961016..0000000
--- a/Examples/config/config_46t1_AROME_EMI.py
+++ /dev/null
@@ -1,11 +0,0 @@
-import os
-
-rep0 = os.getenv('REP_MUSC')
-
-config = 'AROME_EMI'
-cycle = '46t1_Honnert'
-MASTER = '/home/roehrig/pack/' + cycle + '/bin/MASTERODB'
-#PGD = '/home/roehrig/pack/' + cycle + '/bin/PGD'
-#PREP = '/home/roehrig/pack/' + cycle + '/bin/PREP'
-namATMref = rep0 + '/namelist/AROME/namarp_46t1_AROME_EMI'
-#namSFXref = rep0 + '/namelist/SURFEX/nam.sfx.tl127.CMIP6.v631'
diff --git a/Examples/config/config_arp631_CMIP6.py b/Examples/config/config_arp631_CMIP6.py
index bff28f7..84da07a 100644
--- a/Examples/config/config_arp631_CMIP6.py
+++ b/Examples/config/config_arp631_CMIP6.py
@@ -4,8 +4,8 @@ rep0 = os.getenv('REP_MUSC')
 
 config = 'CMIP6'
 cycle = 'arp631'
-MASTER = '/home/common/pack/arp603_export.01.GFORTRAN610.cx/bin/MASTER'
-PGD = '/home/common/pack/arp603_export.01.GFORTRAN610.cx/bin/PGD'
-PREP = '/home/common/pack/arp603_export.01.GFORTRAN610.cx/bin/PREP'
+MASTER = '/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/bin//MASTERODB'
+PGD = '/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/bin/PGD'
+PREP = '/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/bin/PREP'
 namATMref = rep0 + '/namelist/ARPCLIMAT/nam.atm.tl127l91r.CMIP6.v631'
 namSFXref = rep0 + '/namelist/SURFEX/nam.sfx.tl127.CMIP6.v631'
diff --git a/Examples/configsim.py b/Examples/configsim.py
index 92a63f4..79b2e60 100644
--- a/Examples/configsim.py
+++ b/Examples/configsim.py
@@ -1,9 +1,8 @@
 import sys
 import EMS_cases as CC
 
-# model : ARPCLIMAT, AROME, AROME46t1, ARPPNT
+# model : ARPCLIMAT, AROME, ARPPNT
 #model = 'AROME'
-#model = 'AROME46t1'
 #model = 'ARPPNT'
 model = 'ARPCLIMAT'
 
@@ -20,7 +19,7 @@ if model in ['ARPCLIMAT',]:
   nlev = 91
   # Model time step in seconds
   timestep = 300
-elif model in ['AROME','AROME46t1',]:
+elif model in ['AROME',]:
   # Number of vertical level
   nlev= 90
   # Model time step in seconds
diff --git a/Examples/namelist/AROME/namarp_46t1_AROME_EMI b/Examples/namelist/AROME/namarp_46t1_AROME_EMI
deleted file mode 100644
index f8cbdd4..0000000
--- a/Examples/namelist/AROME/namarp_46t1_AROME_EMI
+++ /dev/null
@@ -1,607 +0,0 @@
- &NACIETEO
- /
- &NACOBS
- /
- &NACTAN
- /
- &NACTEX
- /
- &NACVEG
- /
- &NADOCK
- /
- &NAEAEM7
- /
- &NAEAER
- /
- &NAECOAPHY
- /
- &NAEPHLI
- /
- &NAEPHY
- /
- &NAERAD
-   LRRTM=.FALSE.,
-   LSRTM=.FALSE.,
-   NMCICA=0,
-   NRADFR=-1,
-   NSW=6,
-   RLWINHF=0.9,
- /
- &NAERCLI
- /
- &NAETLDIAG
- /
- &NAEVOL
- /
- &NAIMPO
- /
- &NALORI
- /
- &NAMACV
- /
- &NAMAERDET
- /
- &NAMAFN
- /
- &NAMARG
-   CNMEXP='ARPE',
-   NCONF=1,
-   LELAM=.TRUE.,
-   LECMWF=.FALSE.,
-   LSLAG=.TRUE.,
-   NSUPERSEDE=1,
- /
- &NAMARPHY
-   LMPA=.TRUE.,
-   LMICRO=.TRUE.,
-   LTURB=.TRUE.,
-   LMSE=.FALSE.,
-   LKFBCONV=.FALSE.,
-   LKFBD=.FALSE.,
-   LKFBS=.FALSE.,
-   LMFSHAL=.TRUE.,
- /
- &NAMCA
- /
- &NAMCAPE
- /
- &NAMCFU
-   LCUMFU=.FALSE.,
- /
- &NAMCHEM
- /
- &NAMCHET
- /
- &NAMCHK
- /
- &NAMCLA
- /
- &NAMCLDP
- /
- &NAMCLI
- /
- &NAMCLOP15
- /
- &NAMCLTC
- /
- &NAMCOK
- /
- &NAMCOM
- /
- &NAMCOMPO
- /
- &NAMCOSJO
- /
- &NAMCT0
-   LAROME=.TRUE.,
-   LREGETA=.TRUE.,
-   LSPRT=.TRUE.,
-   CNPPATH='.',
-   LFDBOP=.FALSE.,
-   LFBDAP=.TRUE.,
-   LTWOTL=.TRUE.,
-   LSFORC=.TRUE.,
-   LSFORCS=.TRUE.,
-   NFRHIS=1,
-   NFRPOS=1,
-   NFRSDI=1,
-   NHISTS(0)=-30,
-   NHISTS(1)=0,
-   NHISTS(2)=-1,
-   NHISTS(3)=-2,
-   NHISTS(4)=-3,
-   NHISTS(5)=-4,
-   NHISTS(6)=-5,
-   NHISTS(7)=-6,
-   NHISTS(8)=-7,
-   NHISTS(9)=-8,
-   NHISTS(10)=-9,
-   NHISTS(11)=-10,
-   NHISTS(12)=-11,
-   NHISTS(13)=-12,
-   NHISTS(14)=-13,
-   NHISTS(15)=-14,
-   NHISTS(16)=-15,
-   NHISTS(17)=-16,
-   NHISTS(18)=-17,
-   NHISTS(19)=-18,
-   NHISTS(20)=-19,
-   NHISTS(21)=-20,
-   NHISTS(22)=-21,
-   NHISTS(23)=-22,
-   NHISTS(24)=-23,
-   NHISTS(25)=-24,
-   NHISTS(26)=-25,
-   NHISTS(27)=-26,
-   NHISTS(28)=-27,
-   NHISTS(29)=-28,
-   NHISTS(30)=-29,
-   LGRIB_API=.FALSE.,
-   LALLOPR=.FALSE.,
-   NUNDEFLD=-99999999,
- /
- &NAMCT1
-   LRFILAF=.FALSE.,
-   N1POS=0,
-   N1RES=0,
-   N1SFXHIS=0,
- /
- &NAMCUMF
- /
- &NAMCUMFS
- /
- &NAMCVER
- /
- &NAMCVMNH
- /
- &NAMDDH
- /
- &NAMDFI
- /
- &NAMDIM
-   NPROMA=-4,
- /
- &NAMDIMO
- /
- &NAMDIM_TRAJ
- /
- &NAMDPHY
- /
- &NAMDYN
-   NCOMP_CVGQ=1,
-   BETADT=1.,
-   LADVF=.FALSE.,
-   LIMPF=.FALSE.,
-   LQMT=.FALSE.,
-   LQMPD=.FALSE.,
-   LQMVD=.FALSE.,
-   NSITER=0,
-   NSPDLAG=3,
-   NSVDLAG=3,
-   NTLAG=3,
-   NVLAG=3,
-   NWLAG=3,
-   RCMSLP0=0.,
-   REPS1=0.,
-   REPS2=0.,
-   REPSM1=0.,
-   REPSM2=0.,
-   REPSP1=0.,
-   REXPDH=4.,
-   SIPR=101325.,
-   SITR=350.,
-   SITRA=50.,
-   VESL=0.,
-   XIDT=0.,
-   VMAX1=100.,
-   VMAX2=120.,
- /
- &NAMDYNA
-   NDLNPR=1,
-   LNESC=.FALSE.,
-   LNESCT=.FALSE.,
-   LNESCV=.FALSE.,
-   LSETTLS=.TRUE.,
-   LSETTLST=.TRUE.,
-   LSETTLSV=.TRUE.,
-   LPC_FULL=.FALSE.,
- /
- &NAMDYNCORE
- /
- &NAMEMIS_CONF
- /
- &NAMENKF
- /
- &NAMENSCOV
- /
- &NAMFA
-   NSTRON=0,
- /
- &NAMFAINIT
- /
- &NAMFPC
- /
- &NAMFPD
- /
- &NAMFPDY2
- /
- &NAMFPDYF
- /
- &NAMFPDYH
- /
- &NAMFPDYI
- /
- &NAMFPDYP
- /
- &NAMFPDYS
- /
- &NAMFPDYT
- /
- &NAMFPDYV
- /
- &NAMFPF
- /
- &NAMFPG
- /
- &NAMFPIOS
- /
- &NAMFPMOVE
- /
- &NAMFPOBJ
- /
- &NAMFPPHY
- /
- &NAMFPSC2
- /
- &NAMFPSC2_DEP
- /
- &NAMGEM
- /
- &NAMGFL
-   YQ_NL%LQM=.FALSE.,
-   YQ_NL%NREQIN=1,
-   YQ_NL%NCOUPLING=0,
-   YL_NL%NREQIN=0,
-   YL_NL%NCOUPLING=0,
-   YI_NL%NREQIN=0,
-   YI_NL%NCOUPLING=0,
-   YS_NL%NREQIN=0,
-   YS_NL%NCOUPLING=0,
-   YR_NL%NREQIN=0,
-   YR_NL%NCOUPLING=0,
-   YG_NL%NREQIN=0,
-   YG_NL%NCOUPLING=0,
-   YTKE_NL%NREQIN=-1,
-   YTKE_NL%NCOUPLING=0,
-   YA_NL%NCOUPLING=0,
-   YLRAD_NL%LGP=.TRUE.,
-   YLRAD_NL%NCOUPLING=0,
-   YIRAD_NL%LGP=.TRUE.,
-   YIRAD_NL%NCOUPLING=0,
-   YSRC_NL%NCOUPLING=0,
-   NGFL_FORC=14,
-   NGFL_EZDIAG=23,
- /
- &NAMGRIB
- /
- &NAMGWD
- /
- &NAMGWDIAG
- /
- &NAMGWWMS
- /
- &NAMIAU
- /
- &NAMICE
- /
- &NAMINI
-   LDFI=.FALSE.,
- /
- &NAMINTFLEX
- /
- &NAMIOMI
- /
- &NAMIOS
- /
- &NAMIO_SERV
- /
- &NAMJBCODES
- /
- &NAMJG
- /
- &NAMLCZ
- /
- &NAMLIMA
- /
- &NAMLSFORC
-   LMUSCLFA=.FALSE.,
-   LGEOST_UV_FRC=.TRUE.,
-   RCORIO_FORC=0.000085,
-   RZ0_FORC=0.035,
-   NGEOST_U_DEB=1,
-   NGEOST_U_NUM=1,
-   NGEOST_V_DEB=2,
-   NGEOST_V_NUM=1,
-   LT_ADV_FRC=.TRUE.,
-   NT_ADV_DEB=3,
-   NT_ADV_NUM=6,
-   LQV_ADV_FRC=.TRUE.,
-   NQV_ADV_DEB=9,
-   NQV_ADV_NUM=6,
-   LSW_FRC=.FALSE.,
-   NSH_FORC_DEB=1,
-   NSH_FORC_NUM=7,
-   NLH_FORC_DEB=8,
-   NLH_FORC_NUM=7,
-   NL_T_ADV_TIME(1)=0,
-   NL_T_ADV_TIME(2)=10800,
-   NL_T_ADV_TIME(3)=21600,
-   NL_T_ADV_TIME(4)=32400,
-   NL_T_ADV_TIME(5)=43200,
-   NL_T_ADV_TIME(6)=52200,
-   NL_QV_ADV_TIME(1)=0,
-   NL_QV_ADV_TIME(2)=10800,
-   NL_QV_ADV_TIME(3)=21600,
-   NL_QV_ADV_TIME(4)=32400,
-   NL_QV_ADV_TIME(5)=43200,
-   NL_QV_ADV_TIME(6)=52200,
-   NL_SH_ADV_TIME(1)=0,
-   NL_SH_ADV_TIME(2)=14400,
-   NL_SH_ADV_TIME(3)=23400,
-   NL_SH_ADV_TIME(4)=27000,
-   NL_SH_ADV_TIME(5)=36000,
-   NL_SH_ADV_TIME(6)=45000,
-   NL_SH_ADV_TIME(7)=52200,
-   NL_LH_ADV_TIME(1)=0,
-   NL_LH_ADV_TIME(2)=14400,
-   NL_LH_ADV_TIME(3)=23400,
-   NL_LH_ADV_TIME(4)=27000,
-   NL_LH_ADV_TIME(5)=36000,
-   NL_LH_ADV_TIME(6)=45000,
-   NL_LH_ADV_TIME(7)=52200,
- /
- &NAMMARS
- /
- &NAMMCC
- /
- &NAMMCUF
- /
- &NAMMETHOX
- /
- &NAMMKODB
- /
- &NAMMODERR
- /
- &NAMMTS
- /
- &NAMMWAVE
- /
- &NAMNORGWD
- /
- &NAMNPROF
- /
- &NAMNUD
- /
- &NAMOBS
- /
- &NAMOOPS
- /
- &NAMOPH
-   LINC=.TRUE.,
-   CFNHWF='ECHIS',
- /
- &NAMOPTCMEM
- /
- &NAMPAR0
-   MBX_SIZE=__MBX_SIZE__,
-   NOUTPUT=1,
-   NPROC=__NTASKS__,
-   MP_TYPE=__MP_TYPE__,
-   LOPT_SCALAR=__LOPT_SCALAR__,
-   NPRINTLEV=1,
- /
- &NAMPAR1
-   L_GATHERV_WRGP=.FALSE.,
-   LEQ_REGIONS=.FALSE.,
-   LSPLIT=.FALSE.,
-   LSPLITOUT=.FALSE.,
-   NSTRIN=__NTASKS__,
-   NSTROUT=__NTASKS__,
-   NCOMBFLEN=__NCOMBFLEN__,
- /
- &NAMPARAR
-   NPTP=1,
-   NPRINTFR=10000,
-   LOSUBG_COND=.TRUE.,
-   LOSIGMAS=.TRUE.,
-   LOSEDIC=.TRUE.,
-   VSIGQSAT=0.02,
-   LFPREC3D=.FALSE.,
-   XALP_PERT= 0.3 , 
-   XABUO=1,
-   XBENTR=1,
-   XBDETR=0,
-   XCMF=0.065,
-   XENTR_MF=0.035,
-   XCRAD_MF=50,
-   XENTR_DRY=0.55,
-   XDETR_DRY=10, 
-   XDETR_LUP=1,
-   XKCF_MF=2.75,
-   XPRES_UV=0.5,
-   XFRAC_UP_MAX=0.33,
-   XLINI=0.,
-   XCTD=1.2,
-   XCTP=4.65,
-   XCED=0.85,
-   XCEP=2.11,
-   XCET=0.40,
-   XALPSBL=4.63,
-   XPHI_LIM=3., /
- &NAMPHMSE
-   LPGDFWR=.FALSE.,
- /
- &NAMPHY
-   LMPHYS=.TRUE.,
-   LRAYFM=.FALSE.,
- /
- &NAMPHY0
-   REFLKUO=5000.,
-   REFLRHC=25000.,
- /
- &NAMPHY1
- /
- &NAMPHY2
- /
- &NAMPHY3
- /
- &NAMPHYDS
-   NSFORC=14,
- /
- &NAMPPC
- /
- &NAMPPVI
- /
- &NAMPRE
- /
- &NAMRAD15
- /
- &NAMRADCMEM
- /
- &NAMRCF
- /
- &NAMRCOEF
- /
- &NAMRES
- /
- &NAMRGRI
- /
- &NAMRINC
- /
- &NAMRIP
-   CSTOP='t60',
-   TSTEP=60.,
- /
- &NAMRIP0
- /
- &NAMRLX
- /
- &NAMSATS
- /
- &NAMSCC
- /
- &NAMSCEN
- /
- &NAMSCM
- /
- &NAMSEKF
- /
- &NAMSENS
- /
- &NAMSIMPHL
- /
- &NAMSPNG
- /
- &NAMSPP
- /
- &NAMSPSDT
- /
- &NAMSTA
- /
- &NAMSTOPH
- /
- &NAMSWE
- /
- &NAMTESTVAR
- /
- &NAMTHLIM
- /
- &NAMTOPH
-   ETCVIM=5000.,
-   ETNEBU=5000.,
-   ETPLUI=5000.,
-   XDRMTK=2.0D-8,
-   XDRMTP=800.,
-   XDRMTX=4.0D-7,
-   XDRMUK=1.0D-7,
-   XDRMUP=800.,
-   XDRMUX=0.000002,
- /
- &NAMTRAJP
- /
- &NAMTRANS
- /
- &NAMTRANS0
- /
- &NAMVAR
- /
- &NAMVARBC
- /
- &NAMVARBC_AIREP
- /
- &NAMVARBC_ALLSKY
- /
- &NAMVARBC_GBRAD
- /
- &NAMVARBC_RAD
- /
- &NAMVARBC_SFCOBS
- /
- &NAMVARBC_TCWV
- /
- &NAMVARBC_TO3
- /
- &NAMVAREPS
- /
- &NAMVDF
- /
- &NAMVDOZ
- /
- &NAMVOLCANO
- /
- &NAMVRTL
- /
- &NAMVV0
- /
- &NAMVV1
- /
- &NAMVWRK
- /
- &NAMWAVELETJB
- /
- &NAMXFU
-   LXFU=.FALSE.,
- /
- &NAM_CANAPE
- /
- &NAM_DISTRIBUTED_VECTORS
- /
- &NAPHLC
- /
- &NEMCT0
-   LEQLIMSAT=.TRUE.,
- /
- &NEMDIM
- /
- &NEMDYN
- /
- &NEMELBC0A
-   NBICOP=2,
-   NBICOT=2,
-   NBICOU=2,
-   NECRIPL=1,
- /
- &NEMELBC0B
-   TEFRCL=0.,
- /
- &NEMFPEZO
- /
- &NEMGEO
- /
- &NEMJK
- /
- &NEMVAR
- /
- &NEMWAVELET
- /
diff --git a/Examples/post/config_ASTEX.py b/Examples/post/config_ASTEX.py
new file mode 100644
index 0000000..5a67a9a
--- /dev/null
+++ b/Examples/post/config_ASTEX.py
@@ -0,0 +1,36 @@
+#saveall = True
+saveall = False
+
+#var2save = ['pf','zf','theta','temp','qv','u','v','wap','ql','qi','qr','qsn','rneb','cc','prw','rain','lhf','shf','tsurf','hur','Q1','Q2','qlc','qic','qrc','qsnc','tke','w_up','Mf','alpha_up','ustar','z0']
+var2save = ['pf','zf','theta','temp','qv','u','v','wap','ql','qi','qr','qsn','rneb','cc','prw','rain','lhf','shf','tsurf','hur','Q1','Q2','qlc','qic','qrc','qsnc','tke','w_up','Mf','alpha_up','ustar','z0','dTv_up','T_up','qv_up','eps_u','det_u','B_up','eps_u_org','eps_u_tur','det_u_org','det_u_tur']
+
+convert2p = False
+convert2z = True
+#convert2z = False
+
+convertkday = False
+convertpday = False
+convertzday = False
+
+convertk1h = False
+convertp1h = False
+convertz1h = False
+
+convertk3h = False # not coded for True
+convertp3h = False
+convertz3h = False # not coded for True
+
+# Pour convert2p, niveau en hPa
+levout = []
+for i in range(1,41):
+  levout.append(i*25.)
+levout.reverse()
+
+# Pour convert2z, niveau en m
+levoutz = []
+for i in range(0,401):
+  levoutz.append(i*50.)
+levoutz.reverse()
+
+# Niveau de print (0, 1 ou 2)
+verbose = 2
diff --git a/Examples/post/config_SANDU.py b/Examples/post/config_SANDU.py
new file mode 100644
index 0000000..5a67a9a
--- /dev/null
+++ b/Examples/post/config_SANDU.py
@@ -0,0 +1,36 @@
+#saveall = True
+saveall = False
+
+#var2save = ['pf','zf','theta','temp','qv','u','v','wap','ql','qi','qr','qsn','rneb','cc','prw','rain','lhf','shf','tsurf','hur','Q1','Q2','qlc','qic','qrc','qsnc','tke','w_up','Mf','alpha_up','ustar','z0']
+var2save = ['pf','zf','theta','temp','qv','u','v','wap','ql','qi','qr','qsn','rneb','cc','prw','rain','lhf','shf','tsurf','hur','Q1','Q2','qlc','qic','qrc','qsnc','tke','w_up','Mf','alpha_up','ustar','z0','dTv_up','T_up','qv_up','eps_u','det_u','B_up','eps_u_org','eps_u_tur','det_u_org','det_u_tur']
+
+convert2p = False
+convert2z = True
+#convert2z = False
+
+convertkday = False
+convertpday = False
+convertzday = False
+
+convertk1h = False
+convertp1h = False
+convertz1h = False
+
+convertk3h = False # not coded for True
+convertp3h = False
+convertz3h = False # not coded for True
+
+# Pour convert2p, niveau en hPa
+levout = []
+for i in range(1,41):
+  levout.append(i*25.)
+levout.reverse()
+
+# Pour convert2z, niveau en m
+levoutz = []
+for i in range(0,401):
+  levoutz.append(i*50.)
+levoutz.reverse()
+
+# Niveau de print (0, 1 ou 2)
+verbose = 2
diff --git a/UTIL/Init_Forc/AROME46t1/L60.dta b/UTIL/Init_Forc/AROME46t1/L60.dta
deleted file mode 100755
index 04af4ee..0000000
--- a/UTIL/Init_Forc/AROME46t1/L60.dta
+++ /dev/null
@@ -1,61 +0,0 @@
-0.000000 0.0000000000
-271.828183 0.0000000000
-973.188280 0.0000000000
-2030.384267 0.0000000000
-3319.226030 0.0000000000
-4795.396231 0.0000000000
-6433.281895 0.0000000000
-8215.601394 0.0000000000
-10096.132563 0.0003309675
-11988.307779 0.0017502454
-13834.682123 0.0047467200
-15583.858088 0.0097630763
-17187.794886 0.0172188647
-18602.008555 0.0275061852
-19786.497669 0.0409789128
-20706.971826 0.0579393888
-21336.176625 0.0786244617
-21655.154375 0.1031923737
-21654.293789 0.1317118797
-21349.398517 0.1630387143
-20799.963249 0.1956652968
-20063.043810 0.2291058092
-19186.977397 0.2629653973
-18211.807506 0.2969317553
-17170.190348 0.3307628186
-16088.493072 0.3642733463
-14987.896852 0.3973221613
-13885.397395 0.4298010406
-12794.651871 0.4616256930
-11726.658425 0.4927289008
-10690.276989 0.5230556870
-9692.612455 0.5525602477
-8739.286691 0.5812043462
-7834.626887 0.6089568564
-6981.796027 0.6357941683
-6182.888017 0.6617012022
-5439.005999 0.6866728253
-4750.338217 0.7107155105
-4116.241919 0.7338491181
-3535.342466 0.7561087224
-3005.652443 0.7775464304
-2524.714255 0.7982331608
-2089.769666 0.8182603537
-1705.297418 0.8373613875
-1374.651994 0.8552205742
-1093.095953 0.8718800642
-855.930809 0.8873812719
-658.559613 0.9017642034
-496.535186 0.9150669112
-365.596754 0.9273250455
-261.697342 0.9385714693
-181.023925 0.9488359088
-120.012010 0.9581446011
-75.356071 0.9665198957
-44.017046 0.9739797401
-23.227928 0.9805369262
-10.498339 0.9861978406
-3.618836 0.9909600628
-0.665238 0.9948065724
-0.000000 0.9976807303
-0.000000 1.0000000000
diff --git a/UTIL/Init_Forc/AROME46t1/L90.dta b/UTIL/Init_Forc/AROME46t1/L90.dta
deleted file mode 100755
index 1386c6b..0000000
--- a/UTIL/Init_Forc/AROME46t1/L90.dta
+++ /dev/null
@@ -1,91 +0,0 @@
-      0.      0.
-      2718.281829      0.0000000000
-      3747.089291      0.0000000000
-      4915.587160      0.0000000000
-      6184.629456      0.0000000000
-      7511.826567      0.0000000000
-      8869.101344      0.0000000000
-     10030.304356      0.0020808742
-     10981.652856      0.0063342307
-     11785.441359      0.0121732181
-     12467.115388      0.0193986154
-     13036.996600      0.0278371306
-     13504.534974      0.0373529653
-     13878.638942      0.0478429390
-     14167.467732      0.0592352126
-     14378.164793      0.0714873482
-     14516.624747      0.0845746582
-     14587.358345      0.0983741718
-     14595.755313      0.1128383503
-     14546.696521      0.1279315334
-     14444.613314      0.1436185400
-     14293.673022      0.1598595007
-     14097.987345      0.1766044735
-     13861.830406      0.1937879788
-     13589.853257      0.2113235966
-     13287.281608      0.2290987842
-     12960.083871      0.2469701004
-     12612.251710      0.2649022016
-     12247.287675      0.2828675957
-     11868.245840      0.3008456607
-     11477.778900      0.3188216081
-     11078.188746      0.3367854211
-     10671.478183      0.3547307961
-     10259.401904      0.3726541060
-      9843.515363      0.3905533994
-      9425.220462      0.4084274461
-      9005.807300      0.4262748343
-      8586.491397      0.4440931265
-      8168.695589      0.4618674416
-      7753.760647      0.4795830255
-      7342.954609      0.4972249800
-      6937.480580      0.5147780123
-      6538.483021      0.5322262004
-      6147.052425      0.5495527773
-      5764.228347     0.5667399335
-      5391.000788      0.5837686388
-      5028.309984      0.6006184839
-      4677.044680      0.6172675404
-      4338.039010      0.6336922407
-      4012.068233      0.6498672716
-      3699.843282      0.6657654933
-      3402.004748      0.6813578657
-      3119.007629      0.6966193450
-      2851.141239      0.7115283190
-      2598.537627      0.7260667007
-      2361.182186      0.7402199922
-      2138.926037      0.7539773233
-      1931.499783      0.7673314668
-      1738.528216      0.7802788340
-      1559.545611      0.7928194542
-      1394.011240      0.8049569410
-      1241.324890      0.8166984434
-      1100.841912      0.8280546004
-       971.887912      0.8390394770
-       853.772700      0.8496705050
-       746.106511      0.8599386316
-       648.446293      0.8698369440
-       560.305239      0.8793606592
-       481.162282      0.8885071083
-       410.471379      0.8972757162
-       347.670445      0.9056679778
-       292.189811      0.9136874321
-       243.460098      0.9213396338
-       200.919421      0.9286321259
-       164.019880      0.9355744104
-       132.233270      0.9421779224
-       105.056050      0.9484559990
-        82.013496      0.9544238611
-        62.744832      0.9600729770
-        46.885714      0.9653949126
-        34.071514      0.9703813221
-        23.940739      0.9750239392
-        16.138537      0.9793145669
-        10.320302      0.9832450676
-         6.155336      0.9868073535
-         3.330576      0.9899933762
-         1.554347      0.9927951169
-         0.560130      0.9952045769
-         0.110328      0.9972137692
-         0.000000      0.9988147073
-         0.000000      1.0000000000
diff --git a/UTIL/Init_Forc/AROME46t1/prepare_nam1D.py b/UTIL/Init_Forc/AROME46t1/prepare_nam1D.py
deleted file mode 100644
index f7fc495..0000000
--- a/UTIL/Init_Forc/AROME46t1/prepare_nam1D.py
+++ /dev/null
@@ -1,410 +0,0 @@
-import cdms2
-import MV2
-import os
-import interpvertp
-import config
-import math
-
-cdms2.setNetcdfShuffleFlag(0)
-cdms2.setNetcdfDeflateFlag(0)
-cdms2.setNetcdfDeflateLevelFlag(0)
-
-lforc = config.lforc
-lnam1D = config.lnam1D
-#ASCII2FA=config.ASCII2FA
-
-nlev_out = config.nlev
-
-#dirout = 'files_L' + str(nlev_out) + '_' + str(int(config.dt)) + 's/'
-
-#---------------------------------------------------------------
-# Lecture des donnees d'entree
-#---------------------------------------------------------------
-
-var2read = ['pressure','temp','qv','u','v','ps']
-var2interpol = ['temp','qv','u','v']
-
-data_in = {}
-
-f = cdms2.open('data_input.nc')
-
-lat = f['temp'].getLatitude()[0]
-lon = f['temp'].getLongitude()[0]
-
-t0 = f['temp'].getAxis(0)[0]
-units0 = f['temp'].getAxis(0).units
-
-attributes = {}
-for att in ['tadvh','qdvh','qtadvh','uadvh','vadvh','tadvv','qadvv','qtadvv','uadvv','vadvv','tadv','qadv','uadv','vadv','trad','forc_omega','forc_w','forc_geo','nudging_t','nudging_q','nudging_u','nudging_v','surfaceForcing','z0','ustar']:
-  attributes[att] = 0
-
-for att in f.listglobal():
-  attributes[att] = f.getglobal(att)	
-
-LRAYFM = True
-
-zorog = float(attributes['zorog'])
-
-startDate = str(f.startDate)
-year = int(startDate[0:4])
-month = int(startDate[4:6])
-day = int(startDate[6:8])
-hour = int(startDate[8:10])
-minute = int(startDate[10:12])
-
-nb_f=0
-nb_fs=0
-
-if attributes['tadv'] == 1:
-  var2read.append('tadv')	
-  var2interpol.append('tadv')
-  time = f('tadv').getTime()
-  nb_f=nb_f+1
-if attributes['qadv'] == 1:
-  var2read.append('qadv')	
-  var2interpol.append('qadv')
-  nb_f=nb_f+1
-if attributes['tadvh'] == 1:
-  var2read.append('tadvh')	
-  var2interpol.append('tadvh')
-  time = f('tadvh').getTime()
-  nb_f=nb_f+1
-if attributes['qadvh'] == 1:
-  var2read.append('qadvh')	
-  var2interpol.append('qadvh')
-  nb_f=nb_f+1
-if attributes['qtadvh'] == 1:
-  var2read.append('qtadvh')	
-  var2interpol.append('qtadvh')
-  nb_f=nb_f+1
-if attributes['uadvh'] == 1:
-  var2read.append('uadvh')	
-  var2interpol.append('uadvh')
-  nb_f=nb_f+1
-if attributes['vadvh'] == 1:
-  var2read.append('vadvh')	
-  var2interpol.append('vadvh')
-  nb_f=nb_f+1
-if attributes['tadvv'] == 1:
-  var2read.append('tadvv')	
-  var2interpol.append('tadvv')
-  nb_f=nb_f+1
-if attributes['qadvv'] == 1:
-  var2read.append('qadvv')	
-  var2interpol.append('qadvv')
-  nb_f=nb_f+1
-if attributes['uadvv'] == 1:
-  var2read.append('uadvv')	
-  var2interpol.append('uadvv')
-  nb_f=nb_f+1
-if attributes['vadvv'] == 1:
-  var2read.append('vadvv')	
-  var2interpol.append('vadvv')
-  nb_f=nb_f+1
-if attributes['trad'] == 'adv':
-  LRAYFM = False  	
-if attributes['trad'] == 1:
-  LRAYFM = False	
-  var2read.append('trad')	
-  var2interpol.append('trad')
-  nb_f=nb_f+1
-if attributes['forc_omega'] == 1:
-  var2read.append('omega')	
-  var2interpol.append('omega')
-  time = f('omega').getTime()
-  nb_f=nb_f+1
-if attributes['forc_w'] == 1:
-  var2read.append('w')	
-  var2interpol.append('w')
-  time = f('w').getTime()
-  nb_f=nb_f+1
-if attributes['forc_geo'] == 1:
-  var2read.append('ug')	
-  var2interpol.append('ug')
-  var2read.append('vg')	
-  var2interpol.append('vg')
-  time = f('ug').getTime()
-  nb_f=nb_f+2
-
-if attributes['surfaceForcing'] == "surfaceFlux" :
-  var2read.append('sfc_sens_flx')	
-  var2read.append('sfc_lat_flx')	
-  time_sfc = f('sfc_lat_flx').getAxis(0)
-  nt_sfc = time_sfc.shape[0]
-  nb_fs=nb_fs+2
-
-if attributes['ustar'] > 0. :
-  nb_fs=nb_fs+1
-
-if attributes['nudging_u'] > 0.:
-  var2read.append('u')
-  var2interpol.append('u')
-  nb_f=nb_f+1
-
-if attributes['nudging_v'] > 0.:
-  var2read.append('v')
-  var2interpol.append('v')
-  nb_f=nb_f+1
-
-if attributes['nudging_t'] > 0.:
-  var2read.append('temp')
-  var2interpol.append('temp')
-  time = f('temp').getTime()
-  nb_f=nb_f+1
-
-if attributes['nudging_q'] > 0.:
-  var2read.append('qv')
-  var2interpol.append('qv')
-  nb_f=nb_f+1
-
-var2read = set(var2read)
-var2interpol = set(var2interpol)
-
-print 'var2read =', var2read
-print 'var2interpol =', var2interpol
-
-for var in var2read:
-  data_in[var] = f(var,squeeze=1)	
-#  data_in[var] = f(var)
-
-#time = f('omega').getTime()
-#f.close()
-
-#if len(data_in['w']).shape) == 1:
-#time = f('w').getTime()	
-#else:
-#  time = data_in['w'].getTime()
-nt = time.shape[0]
-lev_in = data_in['pressure'].getLevel()
-nlev_in = lev_in.shape[0]
-
-if attributes['trad'] == 1:
-  if attributes['tadvh'] == 1:	
-    data_in['tadvh'] = data_in['tadvh'] + data_in['trad']
-
-pres = data_in['pressure']
-if len(data_in['pressure'].shape) == 1:
-  pres = MV2.zeros((nt,nlev_in),typecode=MV2.float)
-  for it in range(0,nt):
-    pres[it,:] = data_in['pressure'][:]	 
-  pres0  = MV2.zeros((1,nlev_in),typecode=MV2.float)
-  pres0[0,:] = data_in['pressure'][:]
-
-#---------------------------------------------------------------
-# Calcul des niveaux pressions aux interfaces
-#---------------------------------------------------------------
-
-vah = MV2.zeros((nlev_out+1),typecode=MV2.float32)
-vbh = MV2.zeros((nlev_out+1),typecode=MV2.float32)
-
-f = open('L' + str(nlev_out) + '.dta')
-
-for ilev in range(0,nlev_out+1):
-  line = f.readline().split()
-  vah[ilev] = float(line[0])
-  vbh[ilev] = float(line[1])
-
-f.close()
-
-ppf = MV2.zeros((nt,nlev_out+1),typecode=MV2.float32)
-
-for ilev in range(0,nlev_out+1):
-  if data_in['ps'].shape is (): #nt == 1:
-    ppf[:,ilev] = vah[ilev] + vbh[ilev]*data_in['ps']	  
-  else:
-    ppf[:,ilev] = vah[ilev] + vbh[ilev]*data_in['ps'][:]
-
-#---------------------------------------------------------------
-# Calcul des niveaux pressions au milieu des couches
-#---------------------------------------------------------------
-
-pph = MV2.zeros((nt,nlev_out),typecode=MV2.float32)
-pph0 = MV2.zeros((1,nlev_out),typecode=MV2.float32)
-
-ppf = MV2.where(ppf < 0.1,0.1,ppf)
-
-for ilev in range(0,nlev_out):
-  pph[:,ilev] = (ppf[:,ilev+1]*MV2.log(ppf[:,ilev+1])-ppf[:,ilev]*MV2.log(ppf[:,ilev]))/(ppf[:,ilev+1]-ppf[:,ilev]) - 1.
-  pph0[0,ilev] = (ppf[0,ilev+1]*MV2.log(ppf[0,ilev+1])-ppf[0,ilev]*MV2.log(ppf[0,ilev]))/(ppf[0,ilev+1]-ppf[0,ilev]) - 1.
-
-pph = MV2.exp(pph)	  
-pph0 = MV2.exp(pph0)
-
-#---------------------------------------------------------------
-# Interpolation verticale vers les niveaux modeles (pph)
-#---------------------------------------------------------------
-
-data_out = {}
-missing = {}
-for var in var2interpol:
-  if len(data_in[var].shape) == 2 :
-    data_out[var],missing[var] = interpvertp.interpvertp(pres,pph,data_in[var])
-  else:
-    tmp = data_in[var].reshape((1,nlev_in))
-    data_out[var],missing[var] = interpvertp.interpvertp(pres0,pph0,tmp)
-
-#---------------------------------------------------------------
-# Ecriture du fichier pour etat initial ARPEGE
-#---------------------------------------------------------------
-
-if lnam1D:
-
-  g = open('nam1D_L' + str(nlev_out),'w')
-
-  print >>g, '&NAM1D'
-  print >>g, '  LMAP    = .FALSE.,'
-  print >>g, '  IFLEV   = ' + str(int(nlev_out)) + ','
-  print >>g, '  ZDELY   = 250000.,'
-  print >>g, '  LNHDYN  = .FALSE.,'
-  print >>g, '  LALAPHYS= .TRUE.,'
-  print >>g, '  LREASUR = .TRUE.,'
-  print >>g, '  NFORC   ='+str(int(nb_f*nt))+ ','  
-  print >>g, '  NFORCS  ='+str(int(nb_fs*nt_sfc))+ ','  
-  print >>g, '  LQCGRP  = .FALSE.,'
-  print >>g, '  LQIGRP  = .FALSE.,'
-  print >>g, '  LQRGRP  = .FALSE.,'
-  print >>g, '  LQSGRP  = .FALSE.,'
-  print >>g, '  LQGGRP  = .FALSE.,'
-  print >>g, '  LCFGRP  = .FALSE.,'
-  print >>g, '  LSRCGRP = .FALSE.,'
-  print >>g, '  LTKEGRP = .FALSE.,'
-  print >>g, '  IYEAR   = ' + str(int(year)) + ','
-  print >>g, '  IMONTH  = ' + str(int(month)) + ','
-  print >>g, '  IDAY    = ' + str(int(day)) + ','
-  print >>g, '  IHH     = ' + str(int(hour)) + ','
-  print >>g, '  IMIN    = ' + str(int(minute)) + ','
-  print >>g, '/'
-
-  print >>g, 'ETA'
-
-  print >>g, 'vah'
-  for ilev in range(0,nlev_out+1):
-    print >>g, vah[ilev]	
-
-  print >>g, 'vbh'
-  for ilev in range(0,nlev_out+1):
-    print >>g, vbh[ilev]	
-
-  print >>g, 'ATMOSPHERE'
-  print >>g, 'zorog'
-  print >>g, zorog
-  print >>g, 'ps (Pa)'
-  if data_in['ps'].shape is ():
-    tmp=MV2.log(data_in['ps']  )
-  else:	  
-    tmp=MV2.log(data_in['ps'][0])
-  print >>g, tmp
-
-  print >>g, 'U'
-  for ilev in range(0,nlev_out):
-    print >>g, data_out['u'][0,ilev]
-
-  print >>g, 'V'
-  for ilev in range(0,nlev_out):
-    print >>g, data_out['v'][0,ilev]
-
-  print >>g, 'T'
-  for ilev in range(0,nlev_out):
-    print >>g, data_out['temp'][0,ilev]
-
-  print >>g, 'QV'
-  for ilev in range(0,nlev_out):
-    print >>g, max(0.,data_out['qv'][0,ilev])
-
-  print >>g, ' FORCING'
-  if nt == 1:
-    dt = 0.
-  else:  
-    dt = time[1]-time[0]
-  if attributes['tadv'] == 1:
-    for it in range(0,nt): 
-      print >>g,' T ADV ',int(it*dt) ,'s'
-      for ilev in range(0,nlev_out):
-        print >>g, data_out['tadv'][it,ilev]
-  elif attributes['tadvh'] == 1:
-    for it in range(0,nt): 
-      print >>g,' T ADV ',int(it*dt) ,'s'
-      for ilev in range(0,nlev_out):
-        print >>g, data_out['tadvh'][it,ilev]
-  if attributes['qadv'] == 1:
-    for it in range(0,nt): 
-      print >>g,' Qv ADV ',int(it*dt) ,'s'
-      for ilev in range(0,nlev_out):
-        print >>g, data_out['qadv'][it,ilev]	
-  elif attributes['qadvh'] == 1:
-    for it in range(0,nt): 
-      print >>g,' Qv ADV ',int(it*dt) ,'s'
-      for ilev in range(0,nlev_out):
-        print >>g, data_out['qadvh'][it,ilev]	        
-  if attributes['forc_geo'] == 1:
-    for it in range(0,nt): 
-      print >>g,' PFUG ',int(it*dt) ,'s'
-      for ilev in range(0,nlev_out):
-        print >>g, data_out['ug'][it,ilev]
-    for it in range(0,nt): 
-      print >>g,' PFVG ',int(it*dt),'s'
-      for ilev in range(0,nlev_out):
-        print >>g, data_out['vg'][it,ilev]
-  if attributes['forc_w'] == 1:
-    for it in range(0,nt): 
-      print >>g,' W ',int(it*dt),'s'
-      for ilev in range(0,nlev_out):
-        print >>g, data_out['w'][it,ilev]
-  if attributes['surfaceForcing'] == "surfaceFlux" :
-    print >>g, 'SURF.FORC'
-    for it in range(0,nt_sfc):
-      print >>g, 'FCS'
-      print >>g, data_in['sfc_sens_flx'][it]
-    for it in range(0,nt_sfc):
-      print >>g, 'FLE'
-      print >>g, data_in['sfc_lat_flx'][it]
-  if attributes['ustar'] >0. :
-    for it in range(0,nt_sfc):
-      print >>g, 'USTAR'
-      print >>g, str(float(attributes['ustar']))
-
-  for var in config.variablesAux.keys():
-    print >>g, var
-    if var == 'SURFZ0.FOIS.G' and attributes['z0']>0. :
-        print >>g, str(9.80665*float(attributes['z0']))
-    elif var == 'SURFGZ0.THERM'  and attributes['z0']>0. :
-        print >>g, str(9.80665*float(attributes['z0'])/10.)
-    else:
-        print >>g, ' ' + str(config.variablesAux[var])
-
-  print >>g, 'STOP'
-
-#  os.system('cp nam1D_L' + str(nlev_out) + ' nam1D')
-#  os.system(ASCII2FA + ' > ascii2fa_' + str(nlev_out) + '.log 2>&1')
-#  os.system('rm -f nam1D')
-#  os.system('mv 1D.file initfile_L' + str(nlev_out))
-
-
-  g.close()
-
-  g = cdms2.open('init_L'+ str(nlev_out) + '.nc','w')
-  levAxis = pph[0,:] #/100.
-  levAxis = cdms2.createAxis(levAxis)
-  levAxis.designateLevel()
-  levAxis.id = 'level'
-  levAxis.units = 'Pa'
-  ntAxis = time_sfc[:]
-  ntAxis = cdms2.createAxis(ntAxis)
-  ntAxis.designateLevel()
-  ntAxis.id = 'time'
-  ntAxis.units = 's'
-
-  for var in ['u','v','temp','qv']:
-    tmp = MV2.array(data_out[var][0,:],typecode=MV2.float32)
-    tmp.setAxis(0,levAxis)
-    tmp.id = var
-    g.write(tmp)
-
-  for var in ['sfc_sens_flx','sfc_lat_flx']:
-    tmp = MV2.array(data_in[var][:],typecode=MV2.float32)
-    tmp.setAxis(0,ntAxis)
-    tmp.id = var
-    g.write(tmp)
-  #
-  g.close()
-
diff --git a/UTIL/Init_Forc/AROME46t1/prepare_profile.sh b/UTIL/Init_Forc/AROME46t1/prepare_profile.sh
deleted file mode 100755
index 2f8eb47..0000000
--- a/UTIL/Init_Forc/AROME46t1/prepare_profile.sh
+++ /dev/null
@@ -1,82 +0,0 @@
-#!/bin/sh
-
-cat << EOF > tmp.py
-import os
-
-g = open('tmp.sh','w')
-print >> g, '#!/bin/sh'
-print >> g, "export ASCII2FA=" + os.getenv('REP_EMS') + "/UTIL/Tools/ASCII2FA_GMAP/bin/ascii2fa"
-g.close()
-EOF
-
-
-cdat tmp.py
-chmod u+x tmp.sh
-. ./tmp.sh
-
-rm -f tmp.py tmp.sh
-
-cat << EOF > config.py
-
-#zorog = 0.
-
-nlev = $1
-
-
-lforc = True
-lnam1D = True
-
-variablesAux = {}
-variablesAux['SURFAEROS.SEA']=6.2E-3
-variablesAux['SURFAEROS.LAND']=2.2E-2
-variablesAux['SURFAEROS.SOOT']=1.53E-3
-variablesAux['SURFAEROS.DESERT']=2.6E-2
-variablesAux['SURFA.OF.OZONE']=7.1E-2
-variablesAux['SURFB.OF.OZONE']=3166.
-variablesAux['SURFC.OF.OZONE']=3.
-variablesAux['SURFTEMPERATURE']=292.
-variablesAux['SURFRESERV.NEIGE']=0.     
-variablesAux['SURFRESERV.EAU']=10.      
-variablesAux['SURFZ0.FOIS.G']=0.1
-variablesAux['SURFALBEDO']=0.07      
-variablesAux['SURFEMISSIVITE']=0.98          
-variablesAux['SURFET.GEOPOTENT']=0.0
-variablesAux['SURFVAR.GEOP.ANI']=0.0
-variablesAux['SURFVAR.GEOP.DIR']=0.0
-variablesAux['SURFIND.TERREMER']=0.0
-variablesAux['PROFTEMPERATURE']=292.
-variablesAux['PROFRESERV.EAU']=8000.0   
-variablesAux['PROFRESERV.GLACE']=0.0
-variablesAux['SURFRESERV.INTER']=0.0
-variablesAux['SURFRESERV.GLACE']=0.0 
-variablesAux['SURFIND.VEG.DOMI']=1.0  
-variablesAux['SURFRESI.STO.MIN']=50.
-variablesAux['SURFPROP.ARGILE']=3.944         
-variablesAux['SURFPROP.SABLE']=85.09        
-variablesAux['SURFEPAIS.SOL']=8.0
-variablesAux['SURFIND.FOLIAIRE']=1.0
-variablesAux['SURFRES.EVAPOTRA']=1.
-variablesAux['SURFGZ0.THERM']=0.1
-variablesAux['SURFPROP.VEGETAT']=0.
-variablesAux['SURFALBEDO NEIGE']=0.65
-variablesAux['SURFDENSIT.NEIGE']=0.30
-variablesAux['SURFALBEDO.SOLNU']=0.75
-variablesAux['SURFALBEDO.VEG']=0.1
-variablesAux['SURFALBEDO.COMPL']=0.1
-variablesAux['SURFZ0REL.FOIS.G']=0.1
-
-EOF
-
-
-cdat prepare_nam1D.py
-
-cp nam1D_L$1 nam1D
-
-$ASCII2FA > ascii2fa_$1.log 2>&1
-
-rm -f nam1D
-
-mv 1D.file initfile_L$1
-
-
-
diff --git a/UTIL/Init_Forc/ARPCLIMAT/L191.dta b/UTIL/Init_Forc/ARPCLIMAT/L191.dta
index 1ba7f36..76ead82 120000
--- a/UTIL/Init_Forc/ARPCLIMAT/L191.dta
+++ b/UTIL/Init_Forc/ARPCLIMAT/L191.dta
@@ -1 +1 @@
-../../../CASES/FIRE/L191.dta
\ No newline at end of file
+/Users/romainroehrig/Tools/EMS/CASES/FIRE/L191.dta
\ No newline at end of file
diff --git a/UTIL/Init_Forc/ARPCLIMAT/interpvertp.so b/UTIL/Init_Forc/ARPCLIMAT/interpvertp.so
index 6ba9413..f83c6d1 100755
Binary files a/UTIL/Init_Forc/ARPCLIMAT/interpvertp.so and b/UTIL/Init_Forc/ARPCLIMAT/interpvertp.so differ
diff --git a/UTIL/Init_Forc/ARPCLIMAT/prepare_nam1D.py b/UTIL/Init_Forc/ARPCLIMAT/prepare_nam1D.py
index 4782761..459b461 100644
--- a/UTIL/Init_Forc/ARPCLIMAT/prepare_nam1D.py
+++ b/UTIL/Init_Forc/ARPCLIMAT/prepare_nam1D.py
@@ -21,8 +21,8 @@ dirout = 'files_L' + str(nlev_out) + '_' + str(int(config.dt)) + 's/'
 # Lecture des donnees d'entree
 #---------------------------------------------------------------
 
-var2read = ['pressure','temp','qv','u','v','ps']
-var2interpol = ['temp','qv','u','v','theta']
+var2read = ['pressure','temp','qv','ql','qi','tke','u','v','ps']
+var2interpol = ['temp','qv','ql','qi','tke','u','v','theta']
 
 data_in = {}
 
@@ -132,7 +132,10 @@ print 'var2read =', var2read
 print 'var2interpol =', var2interpol
 
 for var in var2read:
-  data_in[var] = f(var,squeeze=1)	
+    if var in f.listvariables():
+        data_in[var] = f(var,squeeze=1)	
+    else:
+        data_in[var] = f('temp',squeeze=1)*0.
 #  data_in[var] = f(var)
 
 
@@ -183,6 +186,9 @@ if len(data_in['pressure'].shape) == 1:
     pres[it,:] = data_in['pressure'][:]	 
   pres0  = MV2.zeros((1,nlev_in),typecode=MV2.float)
   pres0[0,:] = data_in['pressure'][:]
+else:
+  pres0 = MV2.zeros((1,nlev_in),typecode=MV2.float)
+  pres0[0,:] = data_in['pressure'][0,:]
 
 #---------------------------------------------------------------
 # Calcul des niveaux pressions aux interfaces
@@ -255,14 +261,14 @@ if lnam1D:
   print >>g, '  LALAPHYS= .TRUE.,'
   print >>g, '  LREASUR = .TRUE.,'
   print >>g, '  NFORC   = 0,'
-  print >>g, '  LQCGRP  = .FALSE.,'
-  print >>g, '  LQIGRP  = .FALSE.,'
+  print >>g, '  LQCGRP  = .TRUE.,'
+  print >>g, '  LQIGRP  = .TRUE.,'
   print >>g, '  LQRGRP  = .FALSE.,'
   print >>g, '  LQSGRP  = .FALSE.,'
   print >>g, '  LQGGRP  = .FALSE.,'
   print >>g, '  LCFGRP  = .FALSE.,'
   print >>g, '  LSRCGRP = .FALSE.,'
-  print >>g, '  LTKEGRP = .FALSE.,'
+  print >>g, '  LTKEGRP = .TRUE.,'
   print >>g, '  IYEAR   = ' + str(int(year)) + ','
   print >>g, '  IMONTH  = ' + str(int(month)) + ','
   print >>g, '  IDAY    = ' + str(int(day)) + ','
@@ -311,6 +317,19 @@ if lnam1D:
   for ilev in range(0,nlev_out):
     print >>g, max(0.,data_out['qv'][0,ilev])
 
+  print >>g, 'CLOUD_WATER'
+  for ilev in range(0,nlev_out):
+    print >>g, max(0.,data_out['ql'][0,ilev])
+
+  print >>g, 'ICE_CRYSTAL'
+  for ilev in range(0,nlev_out):
+    print >>g, max(0.,data_out['qi'][0,ilev])
+
+  print >>g, 'TKE'
+  for ilev in range(0,nlev_out):
+    print >>g, max(0.,data_out['tke'][0,ilev])
+
+
   print >>g, 'FORCING'
 
   for var in config.variablesAux.keys():
diff --git a/UTIL/Init_Forc/ARPCLIMAT/prepare_profile.sh b/UTIL/Init_Forc/ARPCLIMAT/prepare_profile.sh
index 1c47745..5c4dc61 100755
--- a/UTIL/Init_Forc/ARPCLIMAT/prepare_profile.sh
+++ b/UTIL/Init_Forc/ARPCLIMAT/prepare_profile.sh
@@ -1,10 +1,14 @@
 #!/bin/sh
 
+source activate myuvcdat
+alias cdat='python'
+
 cat << EOF > tmp.py
 import os
 
 g = open('tmp.sh','w')
 print >> g, '#!/bin/sh'
+print >> g, 'export OMP_NUM_THREADS=1'
 print >> g, "export ASCII2FA=" + os.getenv('REP_EMS') + "/UTIL/Tools/ASCII2FA/bin/ascii2fa"
 g.close()
 EOF
diff --git a/UTIL/Init_Forc/ARPPNT/L91.dta b/UTIL/Init_Forc/ARPPNT/L91.dta
deleted file mode 100644
index c973e78..0000000
--- a/UTIL/Init_Forc/ARPPNT/L91.dta
+++ /dev/null
@@ -1,92 +0,0 @@
-0.0 0.0
-2.00004 0.0
-3.980832 0.0
-7.387186 0.0
-12.908319 0.0
-21.413612 0.0
-33.952858 0.0
-51.746601 0.0
-76.167656 0.0
-108.715561 0.0
-150.986023 0.0
-204.637451 0.0
-271.356506 0.0
-352.824493 0.0
-450.685791 0.0
-566.519226 0.0
-701.813354 0.0
-857.945801 0.0
-1036.166504 0.0
-1237.585449 0.0
-1463.16394 0.0
-1713.709595 0.0
-1989.87439 0.0
-2292.155518 0.0
-2620.898438 0.0
-2976.302246 0.0
-3358.425781 0.0
-3767.196045 0.0
-4202.416504 0.0
-4663.776367 0.0
-5150.859863 0.0
-5663.15625 0.0
-6199.839355 0.0
-6759.727051 0.0
-7341.469727 2.724e-07
-7942.92627 1.39116e-05
-8564.624023 5.46672e-05
-9208.305664 0.0001313641
-9873.560547 0.0002788848
-10558.881836 0.0005483841
-11262.484375 0.0010001344
-11982.662109 0.0017010754
-12713.897461 0.0027647193
-13453.225586 0.0042670486
-14192.009766 0.0063221669
-14922.685547 0.0090349903
-15638.053711 0.0125082629
-16329.560547 0.016859578
-16990.623047 0.0221886449
-17613.28125 0.0286103487
-18191.029297 0.0362269096
-18716.96875 0.0451461338
-19184.544922 0.0554742292
-19587.513672 0.0673161894
-19919.796875 0.0807773024
-20175.394531 0.0959640592
-20348.916016 0.1129790097
-20434.158203 0.1319348216
-20426.21875 0.1529335231
-20319.011719 0.1760910898
-20107.03125 0.20152013
-19785.357422 0.2293148786
-19348.775391 0.2595544755
-18798.822266 0.2919934094
-18141.296875 0.3263293803
-17385.595703 0.3622025847
-16544.585938 0.3992047608
-15633.566406 0.4369063377
-14665.645508 0.4750164151
-13653.219727 0.513279736
-12608.383789 0.551458478
-11543.166992 0.589317143
-10471.310547 0.6265588999
-9405.222656 0.662933588
-8356.25293 0.6982235909
-7335.164551 0.7322238088
-6353.920898 0.7646794915
-5422.802734 0.7953847647
-4550.21582 0.824185431
-3743.464355 0.8509504199
-3010.146973 0.8755183816
-2356.202637 0.8977672458
-1784.854614 0.917650938
-1297.656128 0.9351570606
-895.193542 0.9502738118
-576.314148 0.9630070925
-336.772369 0.9734660387
-162.043427 0.9822381139
-54.208336 0.9891529679
-6.575628 0.9942041636
-0.00316 0.9976301193
-0.0 1.0
diff --git a/UTIL/Runs/run_AROME46t1.sh b/UTIL/Runs/run_AROME46t1.sh
deleted file mode 100755
index 033249d..0000000
--- a/UTIL/Runs/run_AROME46t1.sh
+++ /dev/null
@@ -1,239 +0,0 @@
-#!/bin/sh
-
-#------------------------------------------------------------
-# 			INTIALISATION
-#------------------------------------------------------------
-set -x
-
-. ./param
-
-EXP=ARPE
-ADVEC=sli
-
-#       *************************************
-#       * Directories Initialisation        *
-#       *************************************
-
-DIR=`pwd`
-
-OUTPUTDIR=$DIR/Output/LFA/
-OUTPUTDIR0=$DIR/Output/
-
-if [ ! -d $OUTPUTDIR ] ; then
-  mkdir -p $OUTPUTDIR
-fi
-
-TMPDIR=$HOME/tmp/EXEMUSC
-
-if [ ! -d $TMPDIR ] ; then
-  mkdir $TMPDIR
-fi
-
-cd $TMPDIR
-rm -rf $TMPDIR/* || : 
-
-ladate=`date`
-set +x
-echo '------------------------------------------------------------'
-echo 'run execute le ' $ladate
-echo 'cycle =' $cycle 'config = ' $CONFIG
-echo 'Namelist AROME =' $NAMARP
-echo 'Namelist Surfex =' $NAMSFX
-echo 'Executable =' $MASTER
-echo 'Time step =' $TSTEP 'seconds; Run stops at ' $NSTOP
-echo 'Number of levels =' $levels
-echo 'Conditions initiales et forcages =' $INITFILE
-echo 'Conditions pour la surface =' $PREP
-echo 'Dossier des sorties =' $OUTPUTDIR
-echo '------------------------------------------------------------'
-set -x
-#       **********************************
-#       *        Get namelists           *
-#       **********************************
-
-set +x
-echo ''
-echo ' Get the namelist AROME'
-echo ''
-set -x
-
-ln -s $DIR/$NAMARP fort.4
-cat < fort.4
-
-set +x
-echo ''
-echo ' Get the namelist SURFEX'
-echo ''
-set -x
-
-ln -s $DIR/$NAMSFX EXSEG1.nam
-cat < EXSEG1.nam
-
-
-#       **********************************
-#       * Get initial and forcing files  *
-#       **********************************
-
-set +x
-echo ''
-echo ' Get Initial conditions for atmosphere and surface '
-echo ' Get Forcing files '
-echo ''
-set -x
-
-
-ln -s $INITFILE ICMSH${EXP}INIT
-ln -s $FORCING_FILES files
-
-ln -s  $PREP TEST.lfi
-ln -s  $PGD PGD.lfi
-
-
-#       **********************************
-#       *            For SURFEX          *
-#       **********************************
-
-
-ln -s $ecoclimap/ecoclimapII_eu_covers_param.bin ecoclimapII_eu_covers_param.bin
-ln -s $ecoclimap/ecoclimapI_covers_param.bin ecoclimapI_covers_param.bin
-
-#       **********************************
-#       *            Execution           *
-#       **********************************
-
-set +x
-echo ''
-echo ' Get the executable file '
-echo ''
-set -x
-
-ln -s $MASTER MASTER
-chmod 755 MASTER
-
-set +x
-echo ''
-echo ' ALADIN job running '
-echo ''
-set -x
-
-#export DR_HOOK_NOT_MPI=1
-#export DR_HOOK=0
-export DR_HOOK_IGNORE_SIGNALS=-1
-
-ulimit -s unlimited
-
-date
-./MASTER >lola 2>&1
-date
-#rm fort.4
-ls -l
-
-set +x
-echo ''
-echo ' Listing for the not parallelised part: file lola'
-echo ''
-set -x
-
-cat lola
-
-if [ -a NODE.001_01 ]
-then
-  for file in NODE*
-  do
-    set +x
-    echo ''
-    echo ' Listing for the parallelised part: file' $file
-    echo ''
-    set -x
-    cat $file
-  done
-fi
-
-#       **********************************
-#       *     Save model results         *
-#       **********************************
-
-set +x
-echo ''
-echo ' Historic files saving '
-echo ''
-set -x
-
-find $OUTPUTDIR/ -name '*' -exec rm -f {} \;
-find ./ -name 'Out*' -exec mv {} $OUTPUTDIR \;
-find ./ -name 'NODE*' -exec mv {} $OUTPUTDIR \;
-find ./ -name 'lola' -exec mv {} $OUTPUTDIR \;
-
-#rm -f $OUTPUTDIR/*
-#mv Out* NODE* lola $OUTPUTDIR
-
-set +x
-echo ''
-echo ' Present files on the workdir $TMPDIR '
-echo ''
-set -x
-
-ls -l
-
-#       **********************************
-#       *        Nettoyage final         *
-#       *        Final Cleaning          *
-#       **********************************
-
-set +x
-echo ''
-echo ' Final cleaning of the workdir $TMPDIR '
-echo ''
-set -x
-
-set +x
-#rm -rf $TMPDIR/*
-find $TMPDIR/ -name '*' -exec rm -rf {} \;
-set -x
-#       ********************************************
-#       * Copie eventuelle des routines convert2nc *
-#       * Possible copy of convert2nc routines     *
-#       ********************************************
-
-if [ $installpost = True ]
-then
-  cd $OUTPUTDIR0
-  rm -f *.py *.sh *.pyc *.so 
-  set +x
-  echo ''
-  echo ' Install post-processing '
-  echo ''
-  set -x
-
-  files2install='convert2z.so convertp_to_daily.py convertk_to_1hourly.py convertz_to_1hourly.py convert2p.py convertk_to_daily.py convertz_to_daily.py convert2p.so     convertLFA2nc.py lfa2nc_part1.py convert2z.py convertp_to_1hourly.py lfa2nc_part2.py convertp_to_3hourly.py'
-
-  for file in $files2install
-  do
-    ln -s $dirpost/$file
-  done
-  ln -s $dirpost/$configpost config.py
-  ln -s $dirpost/$variablesDict variables.py
-fi
-
-#       ********************************************
-#       * Conversion eventuelle en netcdf          *
-#       * Possible conversion in netcdf            *
-#       ********************************************
-
-if [ $runpost = True ]
-then
-  set +x
-  echo ''
-  echo ' Postprocessing '
-  echo ''
-  set -x
-
-  # seems necessary in some circumstances (deep shells?)
-  unset PYTHONHOME
-  ./convertLFA2nc.py
-
-fi
-
-date
-
-cd $DIR
diff --git a/UTIL/Runs/run_ARPCLIMAT.sh b/UTIL/Runs/run_ARPCLIMAT.sh
index 646b1de..8bfac11 100755
--- a/UTIL/Runs/run_ARPCLIMAT.sh
+++ b/UTIL/Runs/run_ARPCLIMAT.sh
@@ -3,7 +3,7 @@
 #------------------------------------------------------------
 # 			INTIALISATION
 #------------------------------------------------------------
-set -vx
+set -x
 
 . ./param
 
@@ -25,12 +25,12 @@ fi
 
 TMPDIR=$HOME/tmp/EXEMUSC
 
-rm -rf $TMPDIR
-mkdir $TMPDIR
+if [ ! -d $TMPDIR ] ; then
+  mkdir $TMPDIR
+fi
 
 cd $TMPDIR
-
-#find $TMPDIR/ -name '*' -exec rm -rf {} \; || :
+find $TMPDIR -name '*' -exec rm -rf {} \ || :
 #rm -rf $TMPDIR/* || : 
 
 ladate=`date`
@@ -117,11 +117,13 @@ echo ' ALADIN job running '
 echo ''
 set -x
 
+export OMP_NUM_THREADS=1
+
 #export DR_HOOK_NOT_MPI=1
 #export DR_HOOK=0
 export DR_HOOK_IGNORE_SIGNALS=-1
 
-ulimit -s unlimited
+#ulimit -s unlimited
 
 date
 ./MASTER -c001 -vmeteo -maladin -e${EXP} -t$TSTEP -f$NSTOP -a$ADVEC  >lola 2>&1
diff --git a/UTIL/Tools/ASCII2FA/bin/ascii2fa b/UTIL/Tools/ASCII2FA/bin/ascii2fa
index 61c7d98..df05251 100755
Binary files a/UTIL/Tools/ASCII2FA/bin/ascii2fa and b/UTIL/Tools/ASCII2FA/bin/ascii2fa differ
diff --git a/UTIL/Tools/ASCII2FA/src/Makefile b/UTIL/Tools/ASCII2FA/src/Makefile
index a3df309..ed5e0cf 100755
--- a/UTIL/Tools/ASCII2FA/src/Makefile
+++ b/UTIL/Tools/ASCII2FA/src/Makefile
@@ -2,7 +2,7 @@
 
 FC	 =	gfortran
 FFLAGS	 =      -ff2c -fconvert=big-endian -frecord-marker=4 $(M32) -ffixed-form -fdefault-real-8 -DADDRESS64 -DLITTLE_ENDIAN -DHIGHRES
-F90FLAGS =      -fconvert=big-endian -frecord-marker=4 $(M32) -ffree-form -fdefault-real-8 -DADDRESS64 -DHIGHRES
+F90FLAGS =      -fconvert=swap -fno-second-underscore -fbacktrace -fopenmp -fno-sign-zero -fpic -ffree-line-length-none -m64 -ffree-form  -DLINUX -DLITTLE_ENDIAN -DLITTLE -DDARWIN -DADDRESS64 -fdefault-real-8 -fdefault-double-8 -g -O2
 EXEC	 =	acadfa_exe
 
 OBJS	 =	acadfa1D_main.o \
@@ -10,10 +10,11 @@ OBJS	 =	acadfa1D_main.o \
 		real2spec.o \
 		empty.o 
 
-XRD	 =	libxrd.a 
-GRIBEX   =      libgribex.a 
-MPIDUMMY =      libmpidummy.a
-LIBS	 =	$(XRD) $(GRIBEX) $(MPIDUMMY)
+XRD	 =	/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/lib/libxrd.local.a 
+XLA	 =	/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/lib/libxla.local.a 
+GRIBEX   =      /Users/romainroehrig/libraries/auxlibs/GNU/auxlibs/lib/libgribex.a 
+MPIDUMMY =      /Users/romainroehrig/libraries/auxlibs/GNU/auxlibs/lib/libmpidummy.a
+LIBS	 =	$(XRD) $(XLA) $(GRIBEX) $(MPIDUMMY) 
 
 %.o:%.F90
 	$(FC) $(F90FLAGS) -c $<
diff --git a/UTIL/Tools/ASCII2FA/src/acadfa1D_main.F90 b/UTIL/Tools/ASCII2FA/src/acadfa1D_main.F90
index 2ab6200..99e4f92 100644
--- a/UTIL/Tools/ASCII2FA/src/acadfa1D_main.F90
+++ b/UTIL/Tools/ASCII2FA/src/acadfa1D_main.F90
@@ -135,7 +135,7 @@
 
 
       CHARACTER CLMCA*16, CLFILEOUT*40
-      CHARACTER CBLOCK*10, YRECFM*7
+      CHARACTER CBLOCK*16, YRECFM*7
       CHARACTER CHAMP*16
 
       ! allocatable arrays
@@ -256,8 +256,8 @@
       READ(10,*) CBLOCK
 
       IF (CBLOCK.NE.'ETA') THEN
-         print*,'problem : ETA (A and B functions) is not present'
-         STOP
+        print*,'problem : ETA (A and B functions) is not present'
+        STOP
       ENDIF
 
       ! 3.2 Read vertical coefficients A,B
@@ -266,13 +266,13 @@
       ALLOCATE(ZVBH (0:IFLEV))
       READ(10,*)CBLOCK
       DO JLEV = 0,IFLEV
-       READ(10,*)ZVALH(JLEV)
-       ZVALH(JLEV) = ZVALH(JLEV) / ZP00
+        READ(10,*)ZVALH(JLEV)
+        ZVALH(JLEV) = ZVALH(JLEV) / ZP00
         WRITE(6,*)'JLEV ZVALH=',JLEV,ZVALH(JLEV)
       ENDDO
       READ(10,*)CBLOCK
       DO JLEV = 0,IFLEV
-       READ(10,*)ZVBH (JLEV)
+        READ(10,*)ZVBH (JLEV)
         WRITE(6,*)'JLEV ZVBH=',JLEV,ZVBH(JLEV)
       ENDDO
 
@@ -337,7 +337,7 @@
 
 
       ! 4.4 Impose no GRIB encoding (no packing)
-                                                                                
+                                                                        
       INGRIG = 0
       CALL FAVEUR(IREP,IUFD,INGRIB,INBPDG,INBCSP, &
      &  ISTRON,IPUILA,IDMOPL)
@@ -354,18 +354,6 @@
       IF (IREP.NE.0) STOP
 
       ! 4.3 Initialize the date
-! date pour Eurocs/ARM
-!      IDATE(1)  = 1997
-!      IDATE(2)  = 6
-!      IDATE(3)  = 21
-!      IDATE(4)  = 11
-!      IDATE(5)  = 30 
-!      IDATE(6)  = 1
-!      IDATE(7)  = 0
-!      IDATE(8)  = 0
-!      IDATE(9)  = 0
-!      IDATE(10) = 0
-!      IDATE(11) = 0
 
       IDATE(1)  = IYEAR
       IDATE(2)  = IMONTH
@@ -382,15 +370,6 @@
       CALL FANDAR(IREP,IUFD,IDATE)
       IF (IREP.NE.0) STOP
       
-      ! 4.4 Impose no GRIB encoding (no packing)
-          
-!      INGRIG = 0
-!      CALL FAVEUR(IREP,IUFD,INGRIB,INBPDG,INBCSP,
-!     &  ISTRON,IPUILA,IDMOPL)
-!      CALL FAGOTE(IREP,IUFD,INGRIG,INBPDG,INBCSP,
-!     &  ISTRON,IPUILA,IDMOPL)
-
-
       ! ----------------------------
       ! 5. Write data for ATMOSPHERE
       ! ----------------------------
@@ -398,8 +377,8 @@
       READ(10,*) CBLOCK
 
       IF (CBLOCK.NE.'ATMOSPHERE') THEN
-         print*,'problem : the block ATMOSPHERE is not present'
-         STOP
+        print*,'problem : the block ATMOSPHERE is not present'
+        STOP
       ENDIF
 
       !  Preparation for GP fields
@@ -416,7 +395,7 @@
       READ(10,*)
       READ(10,*)ZOROG
       DO J = 1,IDGL
-      ZOUT (J) = ZOROG*ZG
+        ZOUT (J) = ZOROG*ZG
       ENDDO
 
       CALL FAIENC(IREP,IUFD,'SURF',1,'GEOPOTENTIEL',ZOUT,LLCOSP)
@@ -446,11 +425,19 @@
       DO J = 1,IDGL
         ZFFT(J) = ZOROG*ZG
       ENDDO
+
+      !WRITE(6,*)'IDGL=',idgl
+      !WRITE(6,*)'NSEFRE=',NSEFRE
+      !WRITE(6,*)'INSMAX=',INSMAX
+      !WRITE(6,*)'TRIGS=',TRIGS
+      !WRITE(6,*)'IFAX=',IFAX
+      !WRITE(6,*)'ZFFT=',ZFFT
     
-       call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
+      call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
 
-      WRITE(6,*)'GEOP=',ZFFT(1)
-      WRITE(6,*)'ZOUT=',ZOUT
+      !WRITE(6,*)'GEOP=',ZFFT(1)
+      !WRITE(6,*)'ZFFT=',ZFFT
+      !WRITE(6,*)'ZOUT=',ZOUT
       CALL FAIENC (IREP,IUFD,'SPECSURF',1,'GEOPOTEN',ZOUT,LLCOSP)
 
       ! 5.3 Spectral Surface Pressure
@@ -461,9 +448,10 @@
         ZFFT(J) = ZSPT0
       ENDDO
         
-       call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-      WRITE(6,*)'Ps=',ZFFT(1)
-      WRITE(6,*)'ZOUT=',ZOUT
+      call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
+      !WRITE(6,*)'Ps=',ZFFT(1)
+      !WRITE(6,*)'Ps=',ZFFT
+      !WRITE(6,*)'ZOUT=',ZOUT
       CALL FAIENC(IREP,IUFD,'SURF',1,'PRESSION',ZOUT,LLCOSP)
 
       !
@@ -472,16 +460,16 @@
       READ(10,*)
 !
       DO JLEV =1, IFLEV
-         READ(10,*) ZU 
-         DO J = 1,IDGL
-            ZFFT(J) = ZU
-         ENDDO
-         WRITE (6,*)'JLEV UWIND',JLEV,ZFFT(1)
+        READ(10,*) ZU 
+        DO J = 1,IDGL
+          ZFFT(J) = ZU
+        ENDDO
+        WRITE (6,*)'JLEV UWIND',JLEV,ZFFT(1)
     
         call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
      
-         CALL FAIENC (IREP,IUFD,'S',JLEV,'WIND.U.PHYS',ZOUT,LLCOSP)
-      END DO
+        CALL FAIENC (IREP,IUFD,'S',JLEV,'WIND.U.PHYS',ZOUT,LLCOSP)
+      ENDDO
         
       ! 
       ! 5.5 Spectral V-Wind
@@ -489,61 +477,64 @@
       READ(10,*)
 !
       DO JLEV =1, IFLEV
-             READ(10,*) ZV 
+        READ(10,*) ZV 
         DO J = 1,IDGL
-           ZFFT(J)=ZV 
+          ZFFT(J)=ZV 
         ENDDO
         WRITE (6,*)'JLEV VWIND',JLEV,ZFFT(1)
 
-         call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
+        call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
 
         CALL FAIENC (IREP,IUFD,'S',JLEV,'WIND.V.PHYS',ZOUT,LLCOSP)
-      END DO
+      ENDDO
 
       !
       ! 5.6 Spectral Temperature
       !
       READ(10,*)
-!
+      !
       DO JLEV =1, IFLEV
-          READ(10,*)ZT 
+        READ(10,*)ZT 
         DO J = 1,IDGL
           ZFFT(J)=ZT 
         ENDDO
         WRITE(6,*)'JLEV TEMPE',JLEV,ZFFT(1)
-
-         call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-
+        !
+        call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
+        !
+        !WRITE(6,*) 'JLEV TEMPE ZOUT=',JLEV,ZOUT
+        !
         CALL FAIENC (IREP,IUFD,'S',JLEV,'TEMPERATURE',ZOUT,LLCOSP)
-      END DO
+      ENDDO
 
 
         ! 5.7 NH fields if LNHDYN
 
       IF (LNHDYN) THEN
       !
-         DO JLEV =1, IFLEV
+        DO JLEV =1, IFLEV
+          !
           ! Pressure Departure
           !      
-            DO J = 1,IDGL
-               ZFFT(J) = 0.0
-            ENDDO
-
-           call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-	
-            CALL FAIENC (IREP,IUFD,'S',JLEV,'PRESS.DEPARTURE',ZOUT,LLCOSP)
-     
+          DO J = 1,IDGL
+            ZFFT(J) = 0.0
+          ENDDO
+          !
+          call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
+          !
+          CALL FAIENC (IREP,IUFD,'S',JLEV,'PRESS.DEPARTURE',ZOUT,LLCOSP)
+          !
           ! Vertical divergence
           !
-            DO J = 1,IDGL
-               ZFFT(J) = 0.0
-            ENDDO
-        
-           call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-   	
-            CALL FAIENC (IREP,IUFD,'S',JLEV,'VERTIC.DIVERGENC',ZOUT,LLCOSP)
-
-         END DO
+          DO J = 1,IDGL
+            ZFFT(J) = 0.0
+          ENDDO
+          ! 
+          call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
+          !
+          CALL FAIENC (IREP,IUFD,'S',JLEV,'VERTIC.DIVERGENC',ZOUT,LLCOSP)
+          !
+        ENDDO
       ENDIF
       ! Finish 3D-spectral data
 
@@ -552,210 +543,274 @@
       !
       ! 5.7 Grid point or Spectral Humidity
       !
-
-print*,'LQVGRP=',LQVGRP
-print*,'LSPRT=',LSPRT
-!IF(LQVGRP) THEN
-
-
-   IF ( LSPRT ) THEN
-      ! Grid point specific humidity
-      LLCOSP = .FALSE.      
-      ALLOCATE(ZOUT (IDGL))
-      ZOUT(:) = 0.
-
-      READ(10,*)
-      DO JLEV=1,IFLEV
-         READ(10,*) ZQ
-         DO J = 1,IDGL
+      print*,'LQVGRP=',LQVGRP
+      print*,'LSPRT=',LSPRT
+      !IF(LQVGRP) THEN
+      !
+      IF ( LSPRT ) THEN
+        ! Grid point specific humidity
+        LLCOSP = .FALSE.      
+        ALLOCATE(ZOUT (IDGL))
+        ZOUT(:) = 0.
+        !
+        READ(10,*)
+        DO JLEV=1,IFLEV
+          READ(10,*) ZQ
+          DO J = 1,IDGL
             ZOUT(J)=ZQ
-         ENDDO
-         WRITE (6,*)' JLEV HUMI',JLEV,ZOUT(1)
-         CALL FAIENC (IREP,IUFD,'S',JLEV,'HUMI.SPECIFI',ZOUT,LLCOSP)
-      ENDDO
-      DEALLOCATE (ZOUT) 
-   ELSEIF (.NOT. LSPRT) THEN
-      !
-      ! 5.6 Spectral Humidity
-      !
-print*,'QV en spectral'
- WRITE(6,*)' Q_v en spectral'
-      ALLOCATE(ZOUT (NSEFRE))
-      ALLOCATE(ZFFT (IDGL)  )
-      ALLOCATE(ZWORK(IDGL+1))
-      
-      LLCOSP =.TRUE.  
-
-      READ(10,*)
-!
-      DO JLEV =1, IFLEV
+          ENDDO
+          WRITE (6,*)' JLEV HUMI',JLEV,ZOUT(1)
+          !WRITE (6,*)' JLEV HUMI',JLEV,ZOUT
+          CALL FAIENC (IREP,IUFD,'S',JLEV,'HUMI.SPECIFI',ZOUT,LLCOSP)
+        ENDDO
+        DEALLOCATE (ZOUT) 
+      ELSEIF (.NOT. LSPRT) THEN
+        !
+        ! 5.6 Spectral Humidity
+        !
+        print*,'QV en spectral'
+        WRITE(6,*)' Q_v en spectral'
+        ALLOCATE(ZOUT (NSEFRE))
+        ALLOCATE(ZFFT (IDGL)  )
+        ALLOCATE(ZWORK(IDGL+1))
+        !
+        LLCOSP =.TRUE.  
+        !
+        READ(10,*)
+        !
+        DO JLEV =1, IFLEV
           READ(10,*)ZQ
-        DO J = 1,IDGL
-          ZFFT(J)=ZQ
+          DO J = 1,IDGL
+            ZFFT(J)=ZQ
+          ENDDO
+          WRITE(6,*)'JLEV HUMI',JLEV,ZFFT(1)
+          ! 
+          call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
+          !
+          !WRITE(6,*) 'JLEV QV ZOUT=',JLEV,ZOUT 
+          !
+          CALL FAIENC (IREP,IUFD,'S',JLEV,'HUMI.SPECIFI',ZOUT,LLCOSP)
         ENDDO
-        WRITE(6,*)'JLEV HUMI',JLEV,ZFFT(1)
-           
-        call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-
-        CALL FAIENC (IREP,IUFD,'S',JLEV,'HUMI.SPECIFI',ZOUT,LLCOSP)
-      END DO
-
-      DEALLOCATE (ZOUT) 
-      DEALLOCATE (ZFFT)
-      DEALLOCATE (ZWORK) 
-   ENDIF
-
-!ENDIF
-
+        !
+        DEALLOCATE (ZOUT) 
+        DEALLOCATE (ZFFT)
+        DEALLOCATE (ZWORK) 
+      ENDIF
+      !
+      !ENDIF
+      !
       !
       ! 5.8 Grid point specific cloud content
       !
       IF(LQCGRP) THEN 
-         LLCOSP = .FALSE.      
-         ALLOCATE(ZOUT (IDGL))
-         ZOUT(:) = 0.
-         READ(10,*)
-
-        DO JLEV=1,IFLEV
-          READ(10,*) ZQ
-          DO J = 1,IDGL
-            ZOUT(J)=ZQ
-          ENDDO
-          WRITE (6,*)' JLEV QL',JLEV,ZOUT(1)
-          CALL FAIENC (IREP,IUFD,'S',JLEV,'CLOUD_WATER',ZOUT,LLCOSP)
-          CALL FAIENC (IREP,IUFD,'S',JLEV,'LIQUID_WATER',ZOUT,LLCOSP)
-        ENDDO 
-        DEALLOCATE (ZOUT) 
+        !
+        READ(10,*) CBLOCK
+        print*,'CBLOCK=',CBLOCK
+        !
+        IF (CBLOCK.NE.'CLOUD_WATER') THEN
+          print*,&
+         & 'the block CLOUD_WATER is not present while it is expected'
+          STOP
+        ELSE
+          LLCOSP = .FALSE.      
+          ALLOCATE(ZOUT (IDGL))
+          ZOUT(:) = 0.                
+          DO JLEV=1,IFLEV
+            READ(10,*) ZQ
+            DO J = 1,IDGL
+              ZOUT(J)=ZQ
+            ENDDO
+            WRITE (6,*)' JLEV CLOUD_WATER',JLEV,ZOUT(1)
+            CALL FAIENC (IREP,IUFD,'S',JLEV,'CLOUD_WATER',ZOUT,LLCOSP)
+            CALL FAIENC (IREP,IUFD,'S',JLEV,'LIQUID_WATER',ZOUT,LLCOSP)
+          ENDDO 
+          DEALLOCATE (ZOUT)        
+        ENDIF
       ENDIF
       !
       ! 5.9 Grid point specific ice cristal content
       ! 
       IF(LQIGRP) THEN
-         LLCOSP = .FALSE.      
-         ALLOCATE(ZOUT (IDGL))
-         ZOUT(:) = 0.
-
-         DO JLEV=1,IFLEV
-          DO J = 1,IDGL
-            ZOUT(J)=0.0
-           ENDDO
-          WRITE (6,*)' JLEV ICE_CRYSTAL',JLEV,ZOUT(1)
-          CALL FAIENC (IREP,IUFD,'S',JLEV,'ICE_CRYSTAL',ZOUT,LLCOSP)
-        ENDDO  
-!
-!for LOPEZ
-!
-         DO JLEV=1,IFLEV
-          DO J = 1,IDGL
-            ZOUT(J)=0.0
-           ENDDO
-          WRITE (6,*)' JLEV SOLID_WATER',JLEV,ZOUT(1)
-          CALL FAIENC (IREP,IUFD,'S',JLEV,'SOLID_WATER',ZOUT,LLCOSP)
-         ENDDO 
-         DEALLOCATE (ZOUT) 
+        !
+        READ(10,*) CBLOCK
+        print*,'CBLOCK=',CBLOCK
+        !
+        IF (CBLOCK.NE.'ICE_CRYSTAL') THEN
+          print*, &
+         & 'the block ICE_CRYSTAL is not present while it is expected'
+          STOP
+        ELSE
+          LLCOSP = .FALSE.      
+          ALLOCATE(ZOUT (IDGL))
+          ZOUT(:) = 0.          
+          DO JLEV=1,IFLEV
+            READ(10,*) ZQ
+            DO J = 1,IDGL
+              ZOUT(J)=ZQ
+            ENDDO
+            WRITE (6,*)' JLEV ICE_CRYSTAL',JLEV,ZOUT(1)
+            CALL FAIENC (IREP,IUFD,'S',JLEV,'ICE_CRYSTAL',ZOUT,LLCOSP)
+            CALL FAIENC (IREP,IUFD,'S',JLEV,'SOLID_WATER',ZOUT,LLCOSP)
+          ENDDO 
+          DEALLOCATE (ZOUT)           
+        ENDIF
       ENDIF 
       !
       ! 5.10 Grid point specific rain content
       !
       IF(LQRGRP) THEN 
-         LLCOSP = .FALSE.      
-         ALLOCATE(ZOUT (IDGL))
-         ZOUT(:) = 0.
-
-         DO JLEV=1,IFLEV
+        !
+        READ(10,*) CBLOCK
+        print*,'CBLOCK=',CBLOCK
+        !
+        IF (CBLOCK.NE.'RAIN') THEN
+          print*,'the block RAIN is not present while it is expected'
+          STOP
+        ELSE
+          LLCOSP = .FALSE.      
+          ALLOCATE(ZOUT (IDGL))
+          ZOUT(:) = 0.
+          DO JLEV=1,IFLEV
+            READ(10,*) ZQ          
             DO J = 1,IDGL
-               ZOUT(J)=0.0
+              ZOUT(J)=ZQ
             ENDDO
             WRITE (6,*)' JLEV RAIN',JLEV,ZOUT(1)
             CALL FAIENC (IREP,IUFD,'S',JLEV,'RAIN',ZOUT,LLCOSP)
-         ENDDO
-         DEALLOCATE (ZOUT) 
+          ENDDO
+          DEALLOCATE (ZOUT)
+        ENDIF
       ENDIF
       !
       ! 5.11 Grid point specific snow content
       !
       IF(LQSGRP) THEN  
-         LLCOSP = .FALSE.      
-         ALLOCATE(ZOUT (IDGL))
-         ZOUT(:) = 0.
-         
-         DO JLEV=1,IFLEV
+        !
+        READ(10,*) CBLOCK
+        print*,'CBLOCK=',CBLOCK
+        !
+        IF (CBLOCK.NE.'SNOW') THEN
+          print*,'the block SNOW is not present while it is expected'
+          STOP
+        ELSE   
+          LLCOSP = .FALSE.      
+          ALLOCATE(ZOUT (IDGL))
+          ZOUT(:) = 0.         
+          DO JLEV=1,IFLEV
+            READ(10,*) ZQ
             DO J = 1,IDGL
-               ZOUT(J)=0.0
+              ZOUT(J)=ZQ
             ENDDO
             WRITE (6,*)' JLEV SNOW',JLEV,ZOUT(1)
             CALL FAIENC (IREP,IUFD,'S',JLEV,'SNOW',ZOUT,LLCOSP)
-         ENDDO
-         DEALLOCATE (ZOUT) 
+          ENDDO
+          DEALLOCATE (ZOUT)
+        ENDIF
       ENDIF
       !
       ! 5.12 Grid point specific graupel content
       !
       IF(LQGGRP) THEN 
-         LLCOSP = .FALSE.      
-         ALLOCATE(ZOUT (IDGL))
-         ZOUT(:) = 0.
-         
-         DO JLEV=1,IFLEV
+        !
+        READ(10,*) CBLOCK
+        print*,'CBLOCK=',CBLOCK
+        !
+        IF (CBLOCK.NE.'GRAUPEL') THEN
+          print*,'the block GRAUPEL is not present while it is expected'
+          STOP
+        ELSE                 
+          LLCOSP = .FALSE.      
+          ALLOCATE(ZOUT (IDGL))
+          ZOUT(:) = 0.        
+          DO JLEV=1,IFLEV
+            READ(10,*) ZQ          
             DO J = 1,IDGL
-               ZOUT(J)=0.0
+              ZOUT(J)=ZQ
             ENDDO
             WRITE (6,*)' JLEV GRAUPEL',JLEV,ZOUT(1)
             CALL FAIENC (IREP,IUFD,'S',JLEV,'GRAUPEL',ZOUT,LLCOSP)
-         ENDDO
-         DEALLOCATE (ZOUT) 
+          ENDDO
+          DEALLOCATE (ZOUT) 
+        ENDIF
       ENDIF
       !
       ! 5.13 Grid point cloud fraction
       !
       IF(LCFGRP) THEN 
-         LLCOSP = .FALSE.      
-         ALLOCATE(ZOUT (IDGL))
-         ZOUT(:) = 0.
-         
-         DO JLEV=1,IFLEV
+        !
+        READ(10,*) CBLOCK
+        print*,'CBLOCK=',CBLOCK
+        !
+        IF (CBLOCK.NE.'CLOUD FRACTION') THEN
+          print*,&
+        & 'the block CLOUD FRACTION is not present while it is expected'
+          STOP
+        ELSE                 
+          LLCOSP = .FALSE.      
+          ALLOCATE(ZOUT (IDGL))
+          ZOUT(:) = 0.      
+          DO JLEV=1,IFLEV
+            READ(10,*) ZQ          
             DO J = 1,IDGL
-               ZOUT(J)=0.0
+              ZOUT(J)=ZQ
             ENDDO
             WRITE (6,*)' JLEV CLF',JLEV,ZOUT(1)
             CALL FAIENC (IREP,IUFD,'S',JLEV,' CLOUD FRACTION',ZOUT,LLCOSP)
-         ENDDO
-         DEALLOCATE (ZOUT)
+          ENDDO
+          DEALLOCATE (ZOUT)
+        ENDIF
       ENDIF
       !
       ! 5.14 Grid point SRC
       !
       IF(LSRCGRP) THEN 
-         LLCOSP = .FALSE.      
-         ALLOCATE(ZOUT (IDGL))
-         ZOUT(:) = 0.
-         
-         DO JLEV=1,IFLEV
+        !
+        READ(10,*) CBLOCK
+        print*,'CBLOCK=',CBLOCK
+        !
+        IF (CBLOCK.NE.'SRC') THEN
+          print*,'the block SRC is not present while it is expected'
+          STOP
+        ELSE                   
+          LLCOSP = .FALSE.      
+          ALLOCATE(ZOUT (IDGL))
+          ZOUT(:) = 0.        
+          DO JLEV=1,IFLEV
+            READ(10,*) ZQ           
             DO J = 1,IDGL
-               ZOUT(J)=0.0
+              ZOUT(J)=ZQ
             ENDDO
             WRITE (6,*)' JLEV SRC',JLEV,ZOUT(1)
             CALL FAIENC (IREP,IUFD,'S',JLEV,'SRC',ZOUT,LLCOSP)
-         ENDDO
-         DEALLOCATE (ZOUT)
+          ENDDO
+          DEALLOCATE (ZOUT)
+        ENDIF
       ENDIF
       !
       ! 7.15 Grid point TKE 
       !
       IF(LTKEGRP) THEN 
-         LLCOSP = .FALSE.      
-         ALLOCATE(ZOUT (IDGL))
-         ZOUT(:) = 0.
-         READ(10,*)
-         DO JLEV=1,IFLEV
-            READ(10,*) ZQ
-            DO J = 1,IDGL
+         !
+         READ(10,*) CBLOCK
+         print*,'CBLOCK=',CBLOCK
+         !
+         IF (CBLOCK.NE.'TKE') THEN
+            print*,'the block TKE is not present'
+           !
+         ELSE
+           LLCOSP = .FALSE.      
+           ALLOCATE(ZOUT (IDGL))
+           ZOUT(:) = 0.                 
+           DO JLEV=1,IFLEV
+             READ(10,*) ZQ
+             DO J = 1,IDGL
                ZOUT(J)=MAX(0.000001,ZQ)
-            ENDDO
-            WRITE (6,*)' JLEV TKE',JLEV,ZOUT(1)
-            CALL FAIENC (IREP,IUFD,'S',JLEV,'TKE',ZOUT,LLCOSP)
-         ENDDO
-         DEALLOCATE (ZOUT)
+             ENDDO
+             WRITE (6,*)' JLEV TKE',JLEV,ZOUT(1)
+             CALL FAIENC (IREP,IUFD,'S',JLEV,'TKE',ZOUT,LLCOSP)
+           ENDDO
+           DEALLOCATE (ZOUT)
+         ENDIF
       ENDIF
       !
       !IF(LOZONE) THEN 
@@ -773,44 +828,43 @@ print*,'QV en spectral'
       !   ENDDO
       !   DEALLOCATE (ZOUT)
       !ENDIF
-
+      !
       ! ----------------------------
       ! 6. Write data for FORCING
       ! ----------------------------
       READ(10,*) CBLOCK
       print*,'CBLOCK=',CBLOCK
-
+      !
       IF (CBLOCK.NE.'FORCING') THEN
          print*,'the block FORCING is not present'
          !
       ELSE
-      !
-      !  Preparation for GP fields
-      !
-      LLCOSP = .FALSE.      
-      ALLOCATE(ZOUT (IDGL))
-      ZOUT(:) = 0.
-      !
-      ! loop for forcing
-      !
-      DO JFORC=1,NFORC
-
-         !  FORCING no JFORC
-         WRITE(YRECFM,'(A4,I3.3)') 'FORC',JFORC
-         print*,'YRECFM=',YRECFM
-         READ(10,*)
-         DO JLEV=1,IFLEV
+        !
+        !  Preparation for GP fields
+        !
+        LLCOSP = .FALSE.      
+        ALLOCATE(ZOUT (IDGL))
+        ZOUT(:) = 0.
+        !
+        ! loop for forcing
+        !
+        DO JFORC=1,NFORC
+          !  FORCING no JFORC
+          WRITE(YRECFM,'(A4,I3.3)') 'FORC',JFORC
+          print*,'YRECFM=',YRECFM
+          READ(10,*)
+          DO JLEV=1,IFLEV
             READ(10,*) ZZ
             DO J = 1,IDGL
-               ZOUT(J)=ZZ
+              ZOUT(J)=ZZ
             ENDDO
             WRITE (6,*)YRECFM,JLEV,ZOUT(1)
             CALL FAIENC (IREP,IUFD,'S',JLEV,YRECFM,ZOUT,LLCOSP)
-         ENDDO            
-      !
-      ENDDO
-      !
-      DEALLOCATE (ZOUT)
+          ENDDO            
+        !
+        ENDDO
+        !
+        DEALLOCATE (ZOUT)
       ENDIF
       ! ----------------------------
       ! 7. Write data for SURFACE MAX=100.
@@ -824,41 +878,43 @@ print*,'QV en spectral'
       ALLOCATE(ZOUT (IDGL))
       ZOUT(:) = 0.
       DO I=1,100
-         READ(10,*)CHAMP
-         IF (CHAMP.EQ.'STOP') THEN 
-                 GOTO 999
-         ENDIF
-         READ(10,*)ZZ
-         print*,CHAMP(5:16),ZZ
-         DO J = 1,IDGL
-            ZOUT(J) = ZZ
-         ENDDO
-         CALL FAIENC(IREP,IUFD,CHAMP(1:4),JLEV,CHAMP(5:16),ZOUT,LLCOSP)
+        READ(10,*)CHAMP
+        WRITE(6,*) 'CHAMP',CHAMP
+        IF (CHAMP.EQ.'STOP') THEN 
+          GOTO 999
+        ENDIF
+        READ(10,*)ZZ
+        WRITE(6,*) 'ZZ',ZZ
+        print*,CHAMP(5:16),ZZ
+        DO J = 1,IDGL
+          ZOUT(J) = ZZ
+        ENDDO
+        CALL FAIENC(IREP,IUFD,CHAMP(1:4),JLEV,CHAMP(5:16),ZOUT,LLCOSP)
       ENDDO
       DEALLOCATE (ZOUT)
       !
       ! ---------
       ! 8. Finish
       ! ---------
-
+      !
       ! 8.1 Close the FA file
  999  WRITE(6,*)'FERMETURE DU FICHIER FA'
       LLOUT = .FALSE.
       CALL LFILAF(IREP,IUFD,LLOUT)
       CALL FAIRME(IREP,IUFD,'UNKNOWN')
-
+      !
       ! 8.2 The end
-
+      !
       IUFD   = IULOUT
       LLNOMM = .TRUE.
       LLERFA = .TRUE.
       LLIMST = .FALSE.
       INIMES = 2
       IBARP  = INART
-
+      !
       CALL FAITOU(IREP,IUFD,LLNOMM,CLFILEOUT,'UNKNOWN', &
      &            LLERFA,LLIMST,INIMES,IBARP,IBARI,CLMCA)
-
+      !
       DEALLOCATE(TRIGS)
       DEALLOCATE(NESN0)
       DEALLOCATE(NCPL4N)
@@ -866,11 +922,11 @@ print*,'QV en spectral'
       DEALLOCATE(IKMTMP)
       DEALLOCATE(ZVALH)
       DEALLOCATE(ZVBH)
-
-
+      !
+      !
       WRITE(6,*)
       WRITE(6,'(A)') 'END OF ACADFA'
       CLOSE (6)
       CLOSE(10)
-   STOP
-   END PROGRAM ACADFA1D_MAIN
+      STOP
+      END PROGRAM ACADFA1D_MAIN
diff --git a/UTIL/Tools/ASCII2FA/src/libxrd.a b/UTIL/Tools/ASCII2FA/src/libxrd.a
deleted file mode 100644
index 4e4a59c..0000000
Binary files a/UTIL/Tools/ASCII2FA/src/libxrd.a and /dev/null differ
diff --git a/UTIL/Tools/ASCII2FA/src/real2spec.F90 b/UTIL/Tools/ASCII2FA/src/real2spec.F90
index 5e804c6..4f69355 100644
--- a/UTIL/Tools/ASCII2FA/src/real2spec.F90
+++ b/UTIL/Tools/ASCII2FA/src/real2spec.F90
@@ -71,6 +71,7 @@ real :: zreal(ndgl + 2)
 
 ! initialize I/O array with zeroes
 zreal(:)=0.
+pspec(:)=0.
 zreal(1:ndgl) = preal(1:ndgl) 
 
 ! -----
diff --git a/UTIL/Tools/LFA/bin/cllangu b/UTIL/Tools/LFA/bin/cllangu
index 9f95061..fb1e1b6 100755
Binary files a/UTIL/Tools/LFA/bin/cllangu and b/UTIL/Tools/LFA/bin/cllangu differ
diff --git a/UTIL/Tools/LFA/bin/lfa2lfa b/UTIL/Tools/LFA/bin/lfa2lfa
index f902433..9ea0865 100755
Binary files a/UTIL/Tools/LFA/bin/lfa2lfa and b/UTIL/Tools/LFA/bin/lfa2lfa differ
diff --git a/UTIL/Tools/LFA/bin/lfa2lfp b/UTIL/Tools/LFA/bin/lfa2lfp
index d2129e6..afc92d1 100755
Binary files a/UTIL/Tools/LFA/bin/lfa2lfp and b/UTIL/Tools/LFA/bin/lfa2lfp differ
diff --git a/UTIL/Tools/LFA/bin/lfa_autodocumentation b/UTIL/Tools/LFA/bin/lfa_autodocumentation
index fa079a0..81a8c39 100755
Binary files a/UTIL/Tools/LFA/bin/lfa_autodocumentation and b/UTIL/Tools/LFA/bin/lfa_autodocumentation differ
diff --git a/UTIL/Tools/LFA/bin/lfa_demo b/UTIL/Tools/LFA/bin/lfa_demo
index 64e0248..512a742 100755
Binary files a/UTIL/Tools/LFA/bin/lfa_demo and b/UTIL/Tools/LFA/bin/lfa_demo differ
diff --git a/UTIL/Tools/LFA/bin/lfac b/UTIL/Tools/LFA/bin/lfac
index cfd4db8..da679d3 100755
Binary files a/UTIL/Tools/LFA/bin/lfac and b/UTIL/Tools/LFA/bin/lfac differ
diff --git a/UTIL/Tools/LFA/bin/lfacre b/UTIL/Tools/LFA/bin/lfacre
index 5a4c669..49371c4 100755
Binary files a/UTIL/Tools/LFA/bin/lfacre and b/UTIL/Tools/LFA/bin/lfacre differ
diff --git a/UTIL/Tools/LFA/bin/lfadiff b/UTIL/Tools/LFA/bin/lfadiff
index ea9c582..1098916 100755
Binary files a/UTIL/Tools/LFA/bin/lfadiff and b/UTIL/Tools/LFA/bin/lfadiff differ
diff --git a/UTIL/Tools/LFA/bin/lfadiffart b/UTIL/Tools/LFA/bin/lfadiffart
index 44ba560..db4bfd8 100755
Binary files a/UTIL/Tools/LFA/bin/lfadiffart and b/UTIL/Tools/LFA/bin/lfadiffart differ
diff --git a/UTIL/Tools/LFA/bin/lfadiffrel b/UTIL/Tools/LFA/bin/lfadiffrel
index e345de1..f6fb680 100755
Binary files a/UTIL/Tools/LFA/bin/lfadiffrel and b/UTIL/Tools/LFA/bin/lfadiffrel differ
diff --git a/UTIL/Tools/LFA/bin/lfafreq b/UTIL/Tools/LFA/bin/lfafreq
index f02ec67..db12761 100755
Binary files a/UTIL/Tools/LFA/bin/lfafreq and b/UTIL/Tools/LFA/bin/lfafreq differ
diff --git a/UTIL/Tools/LFA/bin/lfalaf b/UTIL/Tools/LFA/bin/lfalaf
index c6430df..d688e21 100755
Binary files a/UTIL/Tools/LFA/bin/lfalaf and b/UTIL/Tools/LFA/bin/lfalaf differ
diff --git a/UTIL/Tools/LFA/bin/lfaminm b/UTIL/Tools/LFA/bin/lfaminm
index 57bff37..b54e404 100755
Binary files a/UTIL/Tools/LFA/bin/lfaminm and b/UTIL/Tools/LFA/bin/lfaminm differ
diff --git a/UTIL/Tools/LFA/bin/lfamoy b/UTIL/Tools/LFA/bin/lfamoy
index 3dc0bda..24e2039 100755
Binary files a/UTIL/Tools/LFA/bin/lfamoy and b/UTIL/Tools/LFA/bin/lfamoy differ
diff --git a/UTIL/Tools/LFA/bin/lfareu b/UTIL/Tools/LFA/bin/lfareu
index dfe3cf7..b9ee641 100755
Binary files a/UTIL/Tools/LFA/bin/lfareu and b/UTIL/Tools/LFA/bin/lfareu differ
diff --git a/UTIL/Tools/LFA/bin/lfatest b/UTIL/Tools/LFA/bin/lfatest
index cde8c03..81268f2 100755
Binary files a/UTIL/Tools/LFA/bin/lfatest and b/UTIL/Tools/LFA/bin/lfatest differ
diff --git a/UTIL/Tools/LFA/bin/lfp2lfa b/UTIL/Tools/LFA/bin/lfp2lfa
index bc737bb..b47a98e 100755
Binary files a/UTIL/Tools/LFA/bin/lfp2lfa and b/UTIL/Tools/LFA/bin/lfp2lfa differ
diff --git a/UTIL/install/install_MUSC.py b/UTIL/install/install_MUSC.py
index 811f160..7a6cfec 100644
--- a/UTIL/install/install_MUSC.py
+++ b/UTIL/install/install_MUSC.py
@@ -13,7 +13,6 @@ repinit = os.getcwd()
 
 repARPC_UTIL = mainrep + '/UTIL/Init_Forc/ARPCLIMAT/'
 repARO_UTIL = mainrep + '/UTIL/Init_Forc/AROME/'
-repARO46t1_UTIL = mainrep + '/UTIL/Init_Forc/AROME46t1/'
 repARP_UTIL = mainrep + '/UTIL/Init_Forc/ARPPNT/'
 repSFX_UTIL = mainrep + '/UTIL/Init_Forc/SURFEX/'
 repRun_UTIL = mainrep + '/UTIL/Runs/'
@@ -38,8 +37,6 @@ def install_ATM(model,case,filecase,repout,nlev,timestep=None,subcase=None,lover
       repUTIL = repARPC_UTIL
     elif model == 'AROME':
       repUTIL = repARO_UTIL
-    elif model == 'AROME46t1':
-      repUTIL = repARO46t1_UTIL      
     elif model == 'ARPPNT':
       repUTIL = repARP_UTIL
     else:
@@ -147,7 +144,7 @@ def install_SFX(model,case,filecase,repout,cycle,PGD,PREP,config,namref,subcase=
 
       g.close()
 
-      os.system('cdat tmp.py')
+      os.system('python tmp.py')
       os.system('rm -f tmp.py')
     
       if lperf:
@@ -183,7 +180,7 @@ def install_SFX(model,case,filecase,repout,cycle,PGD,PREP,config,namref,subcase=
 
         g.close()
 
-        os.system('cdat tmp.py')
+        os.system('python tmp.py')
         os.system('rm -f tmp.py')
 
         os.system('./prepare_SURFEX.sh')
@@ -308,7 +305,7 @@ def install_Run(model,case,filecase,repout,config,configOut,subcase=None,loverwr
 
       g.close()
 
-      os.system('cdat tmp.py')
+      os.system('python tmp.py')
       os.system('rm -f tmp.py')
 
       if lperf:
@@ -325,11 +322,11 @@ def install_Run(model,case,filecase,repout,config,configOut,subcase=None,loverwr
         print >> g, 'filecase = "' + filecase + '"'
         print >> g, 'namref = "' + config['namSFXref'] + '"'
         print >> g, 'namout = "namsfx_' + config['name'] + '"'
-        print >> g, 'prepare_namSFX.prep_nam_SFX(case,filecase,namref,namout=namout)'
+        print >> g, 'prepare_namSFX.prep_nam_SFX(case,filecase,namref,namout=namout,subcase="'+subcase+'")'
 
         g.close()
 
-        os.system('cdat tmp.py')
+        os.system('python tmp.py')
         os.system('rm -f tmp.py')
 
         if lperf:
@@ -523,13 +520,13 @@ def install_Atlas(case,repout,config,configAtlas,subcase=None,loverwrite=False,l
 
       g.close()
 
-      os.system('cdat atlas.py')
+      os.system('python atlas.py')
 
     else: 
       print 'Directory already exists:', rep
       if lupdate:
         os.chdir(rep)
-        os.system('cdat atlas.py')
+        os.system('python atlas.py')
       else:
         print 'Nothing is done'
 
diff --git a/UTIL/install/prepare_namATM_AROME.py b/UTIL/install/prepare_namATM_AROME.py
index 4b36506..d0d9547 100644
--- a/UTIL/install/prepare_namATM_AROME.py
+++ b/UTIL/install/prepare_namATM_AROME.py
@@ -367,6 +367,8 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,ls
       i=i+1
       for it in range(0,nt):
         nam[nn]['NL_LSW_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]      
+  else:
+      nam[nn]['LGEOST_UV_FRC'] = ['.FALSE.',]
   if attributes['nudging_u'] > 0. or attributes['nudging_v'] > 0.:
       nam["NAMCT0"]['LSFORC']=['.TRUE.',]
       nam[nn]['LUV_NUDG'] = ['.TRUE.',]
@@ -388,10 +390,10 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,ls
         nam[nn]['RZ0_FORC'] = [str(float(attributes['z0'])),]
       else:
         nam[nn]['RZ0_FORC'] = ['0.035',]
-      nam[nn]["NSH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
+      nam[nn]["NSH_FORC_DEB"]=[str(int(1+i*nt+j*nt_sfc)),]
       nam[nn]["NSH_FORC_NUM"]=[str(nt_sfc),]
       j=j+1
-      nam[nn]["NLH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
+      nam[nn]["NLH_FORC_DEB"]=[str(int(1+i*nt+j*nt_sfc)),]
       nam[nn]["NLH_FORC_NUM"]=[str(nt_sfc),]
       if nt_sfc == 1:
         dt_sfc = 0.
diff --git a/UTIL/install/prepare_namATM_AROME46t1.py b/UTIL/install/prepare_namATM_AROME46t1.py
deleted file mode 100644
index dccd3f8..0000000
--- a/UTIL/install/prepare_namATM_AROME46t1.py
+++ /dev/null
@@ -1,423 +0,0 @@
-#!/usr/bin/env python
-# -*- coding:UTF-8 -*-
-
-import namelist
-import cdms2
-import math
-
-
-def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,lsurfex=False):
-
-  """
-    Prepare AROME namelist for MUSC simulation, 
-    given information in filecase,
-    and from AROME namelist namref
-  """
-
-  if namout is None:
-    namout = namref + '_' + case
-    if subcase is not None:
-      namout = namout + '_' + subcase        
-
-  print '-'*40
-  print 'Prepare AROME namelist for MUSC'
-  print 'case:', case, 'subcase:', subcase
-  print 'Reference namelist:', namref
-  print 'Output namelist:', namout
-
-  nam = namelist.readarp(namref)
-
-  # -----------------------------------------------------------
-  # Some general modification in namref
-  # -----------------------------------------------------------
-
-  for namin in nam.keys():
-    for param in nam[namin].keys():
-      tmp = enumerate(nam[namin][param])
-      for i, obj in tmp:  
-        if obj == '.T.': nam[namin][param][i] = '.TRUE.'
-        if obj == '.F.': nam[namin][param][i] = '.FALSE.'
-        if obj == 'NDPROC': nam[namin][param][i] = '1'
-        if obj == 'NBPROC': nam[namin][param][i] = '1'
-        if obj == 'NCPROC': nam[namin][param][i] = '1'
-        if obj == 'NBPROC_IO': nam[namin][param][i] = '1'
-
-  # Aerosols and Ozone
-  #nam['NAMPHY']['LOZONE'] = ['.FALSE.',]
-  #nam['NAMPHY']['LRAYFM'] = ['.FALSE.',]
-  #nam['NAMPHY']['LO3ABC'] = ['.FALSE.',]
-  #nam['NAMPHY']['LAEROSEA'] = ['.FALSE.',]
-  #nam['NAMPHY']['LAEROLAN'] = ['.FALSE.',]
-  #nam['NAMPHY']['LAEROSOO'] = ['.FALSE.',]
-  #nam['NAMPHY']['LAERODES'] = ['.FALSE.',]
-  #nam['NAMPHY']['LEDR'] = ['.FALSE.',]
-  #nam['NAMPHY']['LO3FL'] = ['.FALSE.',]
-
-  # Empty a few namelists
-  for nn in ['NAMFPC','NAMFPD','NAMLSFORC','NAMDYNA','NAMFPSC2_DEP']:
-    del(nam[nn])
-    nam[nn] = {}
-
-  # Add a few namelists
-  for nn in []:
-    nam[nn] = {}      
-
-  # Update NAMGFL
-  fin = cdms2.open(filecase)
-  time = fin('temp').getTime()
-  nn='NAMGFL'
-  del(nam[nn])
-  nam[nn] = {}
-  nt = time.shape[0]
-  for param in nam[nn].keys():
-    if param[-6:] == 'NREQIN': nam[nn][param] = ['0',]
-    if param[-7:] == 'LREQOUT': nam[nn][param] = ['.FALSE.']
-  nam[nn]['NGFL_EZDIAG'] = ['23',]
-  for it in range(1,24):
-      nam[nn]['YEZDIAG_NL('+str(it)+')%CNAME'] = ["'EZDIAG"+str(it).zfill(2)+"'",]
-  for name in ['TKE','S','R','Q','L','I','G','CVGQ',]:
-      if name == 'CVGQ' : 
-        nam[nn]['Y'+name+'_NL%LCDERS'] = ['.FALSE.',]
-        nam[nn]['Y'+name+'_NL%LSP'] = ['.FALSE.',]      
-        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
-      elif name == 'G':
-        nam[nn]['Y'+name+'_NL%LPT'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
-        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
-      elif name == 'I':
-        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LPHY'] = ['.FALSE.',]
-        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
-        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
-        nam[nn]['Y'+name+'_NL%LADV'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
-      elif name == 'L':
-        nam[nn]['Y'+name+'_NL%LPHY'] = ['.FALSE.',]
-        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LADV'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
-        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
-      elif name == 'Q': 
-        nam[nn]['Y'+name+'_NL%LSP'] = ['.FALSE.',]      
-        nam[nn]['Y'+name+'_NL%LQM'] = ['.FALSE.',]
-        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
-        nam[nn]['Y'+name+'_NL%NREQIN'] = ['1',]
-      elif name == 'R': 
-        nam[nn]['Y'+name+'_NL%LPHY'] = ['.FALSE.',]
-        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
-        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
-        nam[nn]['Y'+name+'_NL%LADV'] = ['.TRUE.',]
-      elif name == 'S': 
-        nam[nn]['Y'+name+'_NL%LPHY'] = ['.FALSE.',]
-        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LADV'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
-        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
-      else: 
-        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LADV'] = ['.FALSE.',]
-        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
-        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
-        nam[nn]['Y'+name+'_NL%NREQIN'] = ['-1',]
-        nam[nn]['Y'+name+'_NL%REFVALI'] = ['0.000001',]
-  
-  # Update due to MUSC/ALADIN config
-  nn = 'NAMDYN'
-  nam[nn]['LADVF'] = ['.FALSE.',]
-  nam[nn]['NSITER'] = ['0',]
-
-  # Update NAMDIM
-  nn='NAMDIM'
-  try:
-    del(nam[nn])
-  except KeyError:
-    pass      
-  nam[nn] = {}
-  nam[nn]['NPROMA'] = ['-4',]
-
-  # Update NAMDYNA
-  #nn='NAMDYNA'
-  #try:
-  #  del(nam[nn])
-  #except KeyError:
-  #  pass      
-  #nam[nn] = {}
-  #nam[nn]['NDLNPR'] = ['0',]
-
-# Update NAMIO_SERV
-  #nn='NAMIO_SERV'
-  #nam[nn]['NIO_SERV_BUF_MAXSIZE'] = ['0']
-  #nam[nn]['NPROCESS_LEVEL'] = ['0']
-  #nam[nn]['NPROC_IO'] = ['0']
-
-  # Update NAMCT1
-  #nn='NAMCT1'
-  #del(nam[nn])
-  #nam[nn] = {}
-  #nam[nn]['LRFILAF'] = ['.FALSE.',]
-  #nam[nn]['N1POS']=['1',]
-  #nam[nn]['N1RES']=['0',]
-  #nam[nn]['N1SFXHIS']=['0',]
-
-  # Update NAMCT0
-  nn = 'NAMCT0'
-  #nam['NAMCT0'] = {}
-  #nam[nn]['LAROME']=['.TRUE.',]
-  #nam[nn]['LREGETA']=['.TRUE.',]
-  #nam[nn]['LSPRT']=['.TRUE.',]
-  #nam[nn]['CNPPATH']=["'.'",]
-  #nam[nn]['LFDBOP']=['.FALSE.',]
-  #nam[nn]['LFBDAP']=['.TRUE.',]
-  nam[nn]['LSFORC']=['.TRUE.',]
-  nam[nn]['LSFORCS']=['.TRUE.',]
-  #nam[nn]['NFRHIS'] = ['1',]
-  #nam[nn]['NFPOS'] = ['1',]
-  #nam[nn]['NFRPOS'] = ['1',]
-  #nam[nn]['NFRSDI'] = ['1',]
-  #nam[nn]['NHISTS(0)'] = ['1',]
-  #nam[nn]['LGRIB_API']=['.FALSE.',]
-  #nam[nn]['LALLOPR']=['.FALSE.',]
-  #nam[nn]['NUNDEFLD'] = ['-99999999',]
-
-  # Update NAMXFU
-  nn =  'NAMXFU'
-  for param in nam[nn].keys():
-    if param[0] == 'L': nam[nn][param] = ['.FALSE.',]
-
-# Update NAMPAR0
-  nn = 'NAMPAR0'
-  del(nam[nn])
-  nam[nn]={}
-  nam[nn][' MBX_SIZE']=['2048000000',]
-  nam[nn][' NOUTPUT']=['1',]
-  nam[nn][' NPROC']=['1',]
-  nam[nn][' MP_TYPE']=['2',]
-  nam[nn][' LOPT_SCALAR']=['.TRUE.',]
-  nam[nn][' NPRINTLEV']=['1',]
-
-# Update NAMPAR1
-  nn = 'NAMPAR1'
-  del(nam[nn])
-  nam[nn]={}
-  nam[nn]['L_GATHERV_WRGP']=['.FALSE.',]
-  nam[nn]['LEQ_REGIONS']=['.FALSE.',]
-  nam[nn]['LSLONDEM']=['.TRUE.',]
-  nam[nn]['LSPLIT']=['.FALSE.',]
-  nam[nn]['LSYNC_SLCOM']=['.TRUE.',]
-  nam[nn]['LSYNC_TRANS']=['.TRUE.',]
-  nam[nn]['NCOMBFLEN']=['1800000',]
-  nam[nn]['NSTRIN']=['1',]
-  nam[nn]['NSTROUT']=['1',]
- 
-# Update NAMPARAR
-  #nn='NAMPARAR'
-  #nam[nn]['CMF_CLOUD']=["'DIRE'",]
-  #nam[nn]['CMF_UPDRAFT']=["'EDKF'",]
-  #nam[nn]['LMIXUV']=['.TRUE.',]
-  #nam[nn]['NSWB_MNH']=['6',]
-
-# Update NAMARG
-
-  nn = 'NAMARG'
-  nam[nn]['CNMEXP'] = ["'ARPE'",]
-
-# Update NAMCFU
-
-  nn = 'NAMCFU'
-  for param in nam[nn].keys():
-    nam[nn][param] = [".FALSE.",]
-
-# Update NEMELBC0A
-
-  #nn = 'NEMELBC0A'
-  #nam[nn]['LESPCPL'] = [".FALSE.",]
-
-
-  # -----------------------------------------------------------
-  # Case specific modifications in namref
-  # -----------------------------------------------------------
-
-  attributes = {}
-  for att in ['tadvh','qdvh','qtadvh','uadvh','vadvh','tadvv','qadvv','qtadvv','uadvv','vadvv','tadv','qadv','uadv','vadv','trad','forc_omega','forc_w','forc_geo','nudging_t','nudging_q','nudging_u','nudging_v','surfaceForcing','z0','ustar']:
-    attributes[att] = 0
-
-  for att in ['p_nudging_t','p_nudging_q','p_nudging_u','p_nudging_v']:
-    attributes[att] = 110000.     
-  for att in fin.listglobal():
-    attributes[att] = fin.getglobal(att)
-
-  if attributes['surfaceForcing'] == "surfaceFlux" :
-    time_sfc = fin('sfc_sens_flx').getAxis(0)
-    nt_sfc = time_sfc.shape[0]
-
-  # Setting latitude and longitude
-  tmp = fin('temp')
-  lat = tmp.getLatitude()[0]
-  lon = tmp.getLongitude()[0]
-  nam['NEMGEO']['RLAT_ACAD'] = [str(float(lat)),]
-  nam['NEMGEO']['RLON_ACAD'] = [str(float(lon)),]
-
-  # Setting starting date
-  startDate = str(fin.startDate)
-  year = int(startDate[0:4])
-  month = int(startDate[4:6])
-  day = int(startDate[6:8])
-  hour = int(startDate[8:10])
-  minute = int(startDate[10:12])
-  second = int(startDate[12:14])
-  
-#  second = 0
-  #nam['NAMRIP']['NINDAT'] = [startDate[0:8],]
-  #nam['NAMRIP']['NSSSSS'] = [str(int(hour*3600+minute*60+second)),]
-  nam['NAMRIP']['TSTEP'] = [str(timestep),]
-  nam['NAMRIP']['CSTOP'] = ["'"+NSTOP+"'",]
-
-  # Case with no radiation or radiation included in temperature advection
-  nam['NAERAD']['LRRTM'] =  ['.FALSE.',]
-  if attributes['trad'] in [1,'adv']:
-    nam['NAMPHY']['LRAYFM'] = ['.FALSE.',]
-    nam['NAERAD']['LSRTM'] =  ['.FALSE.',]
-    nam['NAERAD']['NSW'] = ['6',]
-    nam['NAERAD']['NOZOCL'] = ['2',]
-
-  # MUSC Forcing
-  nn = 'NAMLSFORC'
-  del(nam[nn])
-  nam[nn] = {}
-
-  i=0 # compter
-  j=0 # compter
-  
-  if nt == 1:
-      dt = 0.
-  else:  
-      dt = time[1]-time[0]
-      
-  #for param in ['LFIXRAD','LGEOST_UV_FRC','LNOWINDTEND','LQV_ADV_FRC','LQV_NUDG','LSOMEGA_FRC','LSW_FRC','LT_ADV_FRC','LT_NUDG','LUV_ADV_FRC','LUV_NUDG']:
-  for param in ['LGEOST_UV_FRC','LQV_ADV_FRC','LT_ADV_FRC']:
-    nam[nn][param] = ['.FALSE.',]
-  nam[nn]['LMUSCLFA'] = ['.TRUE.',]
-  for param in ['NGEOST_U_NUM','NGEOST_V_NUM','NQV_ADV_NUM','NT_ADV_NUM']:
-    nam[nn][param] = ['-1',]
-
-  if attributes['tadv'] == 1 or attributes['tadvh'] == 1 or attributes['tadvv'] == 1:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LT_ADV_FRC'] = ['.TRUE.',]
-      nam[nn]['NT_ADV_DEB'] = [str(1+i*nt),]
-      nam[nn]['NT_ADV_NUM'] = [str(nt),]
-      i=i+1
-      for it in range(0,nt):
-           nam[nn]['NL_T_ADV_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]
-  if attributes['qadv'] == 1 or attributes['qadvh'] == 1 or attributes['qtadvh'] == 1 or attributes['qadvv'] == 1:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LQV_ADV_FRC'] = ['.TRUE.',]
-      nam[nn]['NQV_ADV_DEB'] = [str(1+i*nt),]
-      nam[nn]['NQV_ADV_NUM'] = [str(nt),]
-      i=i+1
-      for it in range(0,nt):
-           nam[nn]['NL_QV_ADV_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]
-  if attributes['uadvh'] == 1 or attributes['uadvh'] == 1 or attributes['uadvv'] == 1 or attributes['vadvv'] == 1:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LUV_ADV_FRC'] = ['.TRUE.',]
-  if attributes['forc_omega'] == 1:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LSOMEGA_FRC'] = ['.TRUE.',]
-  if attributes['forc_geo'] == 1:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LGEOST_UV_FRC'] = ['.TRUE.',]
-      W=7.2921e-5
-      nam[nn]['RCORIO_FORC'] = [str(2.*W*math.sin(lat*math.pi/180)),]
-      nam[nn]['NGEOST_U_DEB']=[str(1+nt*i),]
-      nam[nn]['NGEOST_U_NUM']=[str(nt),]
-      i=i+1
-      nam[nn]['NGEOST_V_DEB']=[str(1+nt*i),] 
-      nam[nn]['NGEOST_V_NUM']=[str(nt),]
-      i=i+1
-      for it in range(0,nt):
-        nam[nn]['NL_GEOST_UV_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]
-  if attributes['forc_w'] == 1:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LSW_FRC'] = ['TRUE',]  
-      nam[nn]['NLSW_DEB'] = [str(1+i*nt),]
-      nam[nn]['NLSW_NUM'] = [str(nt),]
-      i=i+1
-      for it in range(0,nt):
-        nam[nn]['NL_LSW_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]      
-  if attributes['nudging_u'] > 0. or attributes['nudging_v'] > 0.:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LUV_NUDG'] = ['.TRUE.',]
-      nam[nn]['RELAX_TAUU'] = [str(float(attributes['nudging_u'])),]
-      nam['NAMTOPH']['ETRELAXU'] = [str(float(attributes['p_nudging_u'])),]
-  if attributes['nudging_t'] > 0.:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LT_NUDG'] = ['.TRUE.',]
-      nam[nn]['RELAX_TAUT'] = [str(float(attributes['nudging_t'])),]
-      nam['NAMTOPH']['ETRELAXT'] = [str(float(attributes['p_nudging_t'])),]
-  if attributes['nudging_q'] > 0.:
-      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-      nam[nn]['LQV_NUDG'] = ['.TRUE.',]
-      nam[nn]['RELAX_TAUQ'] = [str(float(attributes['nudging_q'])),]
-      nam['NAMTOPH']['ETRELAXQ'] = [str(float(attributes['p_nudging_q'])),]
-  if attributes['surfaceForcing'] == "surfaceFlux" :
-      nam["NAMCT0"]['LSFORCS']=['.TRUE.',]
-      if attributes['z0'] > 0.:
-        nam[nn]['RZ0_FORC'] = [str(float(attributes['z0'])),]
-      else:
-        nam[nn]['RZ0_FORC'] = ['0.035',]
-      nam[nn]["NSH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
-      nam[nn]["NSH_FORC_NUM"]=[str(nt_sfc),]
-      j=j+1
-      nam[nn]["NLH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
-      nam[nn]["NLH_FORC_NUM"]=[str(nt_sfc),]
-      if nt_sfc == 1:
-        dt_sfc = 0.
-      else:  
-        dt_sfc = time_sfc[1]-time_sfc[0]
-      for it in range(0,nt_sfc):
-         nam[nn]['NL_SH_ADV_TIME(   '+str(int(it+1))+" )"]=[str(int(dt_sfc*it)),]
-         nam[nn]['NL_LH_ADV_TIME(   '+str(int(it+1))+" )"]=[str(int(dt_sfc*it)),]
-      nam["NAMPHYDS"]['NSFORC']=[str(int(2*nt_sfc)),]
-
-  nam['NAMGFL']['NGFL_FORC'] = [str(int(nt*i)),]
-
-
-
-# Do we use SURFEX or not 
-
-  if lsurfex : 
-     nam["NAMARPHY"]['LMSE'] = [".TRUE.",]
-  else:
-     nam["NAMARPHY"]['LMSE'] = [".FALSE.",]
-
-
-
-# -----------------------------------------------------------
-# Final writing
-# -----------------------------------------------------------
-
-  namelist.writearp(nam,namout)
-
-  print '-'*40
diff --git a/UTIL/install/prepare_namATM_ARPCLIMAT.py b/UTIL/install/prepare_namATM_ARPCLIMAT.py
index 54467a8..cd18815 100644
--- a/UTIL/install/prepare_namATM_ARPCLIMAT.py
+++ b/UTIL/install/prepare_namATM_ARPCLIMAT.py
@@ -70,6 +70,12 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None):
   nam[nn]['YCVGQ_NL%LSP'] = ['.TRUE.',]
   for param in nam[nn].keys():
     if param[-6:] == 'NREQIN': nam[nn][param] = ['0',]
+  if 'YL_NL%NREQIN' in nam[nn].keys():
+    nam[nn]['YL_NL%NREQIN'] = ['1',]
+  if 'YI_NL%NREQIN' in nam[nn].keys():    
+    nam[nn]['YI_NL%NREQIN'] = ['1',]
+  if 'YTKE_NL%NREQIN' in nam[nn].keys():    
+    nam[nn]['YTKE_NL%NREQIN'] = ['1',]
 
   # Update due to MUSC/ALADIN config
   nn = 'NAMDYN'
diff --git a/UTIL/install/prepare_namATM_ARPPNT.py b/UTIL/install/prepare_namATM_ARPPNT.py
index 4ca9fa5..0d137e1 100644
--- a/UTIL/install/prepare_namATM_ARPPNT.py
+++ b/UTIL/install/prepare_namATM_ARPPNT.py
@@ -271,6 +271,8 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,ls
       i=i+1
       for it in range(0,nt):
         nam[nn]['NL_LSW_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]      
+  else:
+      nam[nn]['LGEOST_UV_FRC'] = ['.FALSE.',]
   if attributes['nudging_u'] > 0. or attributes['nudging_v'] > 0.:
       nam["NAMCT0"]['LSFORC']=['.TRUE.',]
       nam[nn]['LUV_NUDG'] = ['.TRUE.',]
@@ -292,10 +294,10 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,ls
         nam[nn]['RZ0_FORC'] = [str(float(attributes['z0'])),]
       else:
         nam[nn]['RZ0_FORC'] = ['0.035',]
-      nam[nn]["NSH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
+      nam[nn]["NSH_FORC_DEB"]=[str(int(1+i*nt+j*nt_sfc)),]
       nam[nn]["NSH_FORC_NUM"]=[str(nt_sfc),]
       j=j+1
-      nam[nn]["NLH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
+      nam[nn]["NLH_FORC_DEB"]=[str(int(1+i*nt+j*nt_sfc)),]
       nam[nn]["NLH_FORC_NUM"]=[str(nt_sfc),]
       if nt_sfc == 1:
         dt_sfc = 0.
diff --git a/UTIL/post_DEPHY/convert2p.py b/UTIL/post_DEPHY/convert2p.py
index 5c02a0b..019fcbc 100644
--- a/UTIL/post_DEPHY/convert2p.py
+++ b/UTIL/post_DEPHY/convert2p.py
@@ -69,8 +69,10 @@ for var in var2save:
     for att in data0.listattributes():
       data.setattribute(att,data0.getattribute(att))
 
+    #print MV2.min(data), MV2.max(data)
     g.write(data)
   else:
+    #print MV2.min(data0), MV2.max(data0)
     g.write(data0)	  
 
 
diff --git a/UTIL/post_DEPHY/convert2p.so b/UTIL/post_DEPHY/convert2p.so
index eed38ec..20cd20c 100755
Binary files a/UTIL/post_DEPHY/convert2p.so and b/UTIL/post_DEPHY/convert2p.so differ
diff --git a/UTIL/post_DEPHY/convert2z.so b/UTIL/post_DEPHY/convert2z.so
index 690cb49..a432ba5 100755
Binary files a/UTIL/post_DEPHY/convert2z.so and b/UTIL/post_DEPHY/convert2z.so differ
diff --git a/UTIL/post_DEPHY/convertLFA2nc.py b/UTIL/post_DEPHY/convertLFA2nc.py
index a229b45..8bd1f65 100755
--- a/UTIL/post_DEPHY/convertLFA2nc.py
+++ b/UTIL/post_DEPHY/convertLFA2nc.py
@@ -9,44 +9,44 @@ else:
     os.system('rm -f netcdf/*')
 
 os.system('python lfa2nc_part1.py')
-os.system('cdat lfa2nc_part2.py')
+os.system('python lfa2nc_part2.py')
 
 os.system('mv Out_klevel.nc netcdf/')
 
 if config.convertk1h:
-    os.system('cdat convertk_to_1hourly.py')
+    os.system('python convertk_to_1hourly.py')
 
 if config.convertk3h:
     print 'convertk3h not coded yet'
     pass #sys.exit()
-    #os.system('cdat convertk_to_3hourly.py')
+    #os.system('python convertk_to_3hourly.py')
 
 if config.convertkday:
-    os.system('cdat convertk_to_daily.py')
+    os.system('python convertk_to_daily.py')
 
 
 if config.convert2p:
-    os.system('cdat convert2p.py')
+    os.system('python convert2p.py')
     if config.convertp1h:
-        os.system('cdat convertp_to_1hourly.py')
+        os.system('python convertp_to_1hourly.py')
 
     if config.convertp3h:
-        os.system('cdat convertp_to_3hourly.py')
+        os.system('python convertp_to_3hourly.py')
 
     if config.convertpday:
-        os.system('cdat convertp_to_daily.py')
+        os.system('python convertp_to_daily.py')
 
 
 if config.convert2z:
-    os.system('cdat convert2z.py')
+    os.system('python convert2z.py')
     if config.convertz1h:
-        os.system('cdat convertz_to_1hourly.py')
+        os.system('python convertz_to_1hourly.py')
 
     if config.convertz3h:
         print 'convertz3h not coded yet'
         pass #sys.exit()
-        #os.system('cdat convertz_to_3hourly.py')
+        #os.system('python convertz_to_3hourly.py')
 
     if config.convertzday:
-        os.system('cdat convertz_to_daily.py')
+        os.system('python convertz_to_daily.py')
 
diff --git a/UTIL/post_DEPHY/convertp_to_daily.py b/UTIL/post_DEPHY/convertp_to_daily.py
index 3cbdf17..5a889fb 100644
--- a/UTIL/post_DEPHY/convertp_to_daily.py
+++ b/UTIL/post_DEPHY/convertp_to_daily.py
@@ -1,6 +1,7 @@
 import cdms2
 import MV2
 import cdtime
+import numpy as np
 #from sets import Set
 
 cdms2.setNetcdfShuffleFlag(0)
@@ -17,7 +18,7 @@ nt0 = time0.shape[0]
 t0 = cdtime.reltime(time0[0],time0.units)
 dt = time0[1]-time0[0]
 
-nt = int(nt0*dt/86400)-1
+nt = int(nt0*dt/86400)#-1
 
 kt = int(86400/dt)
 nt1 = kt*nt
@@ -42,6 +43,13 @@ for var in f.listvariables():
   rms = 0.
 
   tmp = f(var, squeeze=1)
+  if len(tmp.shape) == 2 and tmp.shape[1] >= 10:
+    lev = tmp.getLevel()
+
+  if var in ['rsuscs','rsdscs']:
+    tmp = MV2.where(np.isnan(tmp),0,tmp) # problem with nan values... to be understood in MUSC...
+
+  #print MV2.min(tmp),MV2.max(tmp)
 
   for it in range(0,kt+1):
     if it == 0:
@@ -57,8 +65,9 @@ for var in f.listvariables():
   data.setAxis(0,time)
   rms.setAxis(0,time)
 
+  #print MV2.min(data),MV2.max(data)
+
   if len(tmp.shape) == 2 and tmp.shape[1] >= 10:
-    lev = tmp.getLevel()	 
     data.setAxis(1,lev)
     rms.setAxis(1,lev)
 
diff --git a/UTIL/post_DEPHY/lfa2nc_part1.py b/UTIL/post_DEPHY/lfa2nc_part1.py
index 490d80d..a0f1633 100644
--- a/UTIL/post_DEPHY/lfa2nc_part1.py
+++ b/UTIL/post_DEPHY/lfa2nc_part1.py
@@ -235,6 +235,5 @@ for file in sorted(files):
 
         data[var][it] = tmp
 
-
 f.close()
 
diff --git a/UTIL/post_DEPHY/lfa2nc_part2.py b/UTIL/post_DEPHY/lfa2nc_part2.py
index 84f7336..d495b62 100644
--- a/UTIL/post_DEPHY/lfa2nc_part2.py
+++ b/UTIL/post_DEPHY/lfa2nc_part2.py
@@ -41,6 +41,7 @@ if saveall:
       var2save.append(var)
       varnames[var] = var
       names[var] = var
+      coefs[var] = 1.
       varunits[var] = '-'
 else:
   var2save0 = f.listvariables()
@@ -54,6 +55,7 @@ else:
       var2save1.append(var)
       varnames[var] = var
       names[var] = var
+      coefs[var] = 1.
       varunits[var] = '-'
   var2save = set(var2save).intersection(set(var2save1))
 
@@ -274,7 +276,7 @@ if lmisr:
 g = cdms2.open('Out_klevel.nc','w')
 for var in var2save:
   if config.verbose >= 1:
-    print var	
+    print var
   data = f(varnames[var])*coefs[var]
   data = MV2.array(data, typecode=MV2.float32)
   if var in ['cltcalipso','cllcalipso','clmcalipso','clhcalipso','clcalipso','cllcalipsoice','clmcalipsoice','clhcalipsoice','cltcalipsoice','cllcalipsoliq','clmcalipsoliq','clhcalipsoliq','cltcalipsoliq','cllcalipsoun','clmcalipsoun','clhcalipsoun','cltcalipsoun','clcalipso','lidarBetaMol532','clcalipsoice','clcalipsoliq','clcalipsoun','clcalipsotmp','clcalipsotmpice','clcalipsotmpliq','clcalipsotmpun','parasolRefl','cltlidarradar','clcalipso2','cltisccp','pctisccp','tauisccp','albisccp','meantbisccp','meantbclrisccp','boxtauisccp','boxptopisccp','cltmodis','clwmodis','climodis','clhmodis','clmmodis','cllmodis','tautmodis','tauwmodis','tauimodis','tautlogmodis','tauwlogmodis','tauilogmodis','reffclwmodis','reffclimodis','pctmodis','lwpmodis','iwpmodis','fracout', 'atb532', 'dbze94','cfadDbze94','cfadLidarsr532','clisccp', 'clmodis','clMISR']:
diff --git a/UTIL/python/lfa.so b/UTIL/python/lfa.so
index e757e1f..fa60fc2 100755
Binary files a/UTIL/python/lfa.so and b/UTIL/python/lfa.so differ
diff --git a/UTIL/python/lfa/makelib.sh b/UTIL/python/lfa/makelib.sh
index 245f06e..6ab2673 100755
--- a/UTIL/python/lfa/makelib.sh
+++ b/UTIL/python/lfa/makelib.sh
@@ -1,5 +1,7 @@
 #!/bin/bash
 
+source activate myuvcdat
+
 DIR0=`pwd`
 
 for ff in cllang caracteres_lfa lfa
@@ -11,7 +13,7 @@ done
 
 gfortran -L$DIR0 -llfa -I$DIR0 -fconvert=big-endian -cpp  -c -fPIC -o famusc.o famusc.f90
 
-/opt/cdat/bin/f2py -I/opt/cdat/include -lgfortran -c famusc.pyf famusc.o liblfa.a
+f2py -lgfortran -c famusc.pyf famusc.o liblfa.a
 
 rm -f *.o *.mod *.a
 
@@ -20,3 +22,5 @@ mv lfa.so ../
 # Test
 
 #python tmp.py
+
+source deactivate myuvcdat
diff --git a/UTIL/python/lfa/makelib.sh.cnrm b/UTIL/python/lfa/makelib.sh.cnrm
deleted file mode 100644
index f08dba5..0000000
--- a/UTIL/python/lfa/makelib.sh.cnrm
+++ /dev/null
@@ -1,18 +0,0 @@
-
-
-#/opt/cdat/bin/f2py -m lfa -h famusc.pyf famusc.f90 (comment lfaread* subroutines)
-gfortran -I./ -fconvert=big-endian -cpp  -c -fPIC cllang.f90
-gfortran -I./ -fconvert=big-endian -cpp  -c -fPIC caracteres_lfa.f90
-gfortran -I./ -fconvert=big-endian -cpp  -c -fPIC lfa.f90
-ar r liblfa.a *.o
-gfortran -L./ -llfa -I./ -fconvert=big-endian -cpp  -c -fPIC -o famusc.o famusc.f90
-#f2py -L./ -llfa -lm -lgfortran --f77flags='-L./ -llfa -I./ -fPIC -fconvert=big-endian -cpp' --f90flags='-L./ -llfa -I./ -fPIC -fconvert=big-endian -cpp' --fcompiler=gnu95 -c famusc.pyf famusc.o
-/opt/cdat/bin/f2py -I/opt/cdat/include -L./ -llfa -lm -lgfortran --f77flags='-L./ -llfa -I./ -fPIC -fconvert=big-endian -cpp' --f90flags='-L./ -llfa -I./ -fPIC -fconvert=big-endian -cpp' --fcompiler=gnu95 -c famusc.pyf famusc.o
-
-##Ne fonctionne pas...
-#pgf90 -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -c -fPIC cllang.f90
-#pgf90 -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -c -fPIC caracteres_lfa.f90
-#pgf90 -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -c -fPIC lfa.f90
-#ar r liblfa.a *.o
-#pgf90 -L./ -llfa -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -c -fPIC -o famusc.o famusc.f90
-#/opt/cdat/bin/f2py -L./ -llfa --f77flags='-L./ -llfa -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -fPIC' --f90flags='-L./ -llfa -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -fPIC' --fcompiler=pg -c famusc.pyf famusc.o
diff --git a/diff b/diff
deleted file mode 100644
index 94b4178..0000000
--- a/diff
+++ /dev/null
@@ -1,5165 +0,0 @@
-diff --git a/CASES/ARMCu/ARMCu_driver_RR.nc b/CASES/ARMCu/ARMCu_driver_RR.nc
-index 572eb9a..4989430 100644
-Binary files a/CASES/ARMCu/ARMCu_driver_RR.nc and b/CASES/ARMCu/ARMCu_driver_RR.nc differ
-diff --git a/CASES/ARMCu/convert_ARMcu.py b/CASES/ARMCu/convert_ARMcu.py
-index 6dffb47..9b5b1b2 100644
---- a/CASES/ARMCu/convert_ARMcu.py
-+++ b/CASES/ARMCu/convert_ARMcu.py
-@@ -39,7 +39,7 @@ data['ps'].id = 'ps'
- data['ps'].title = 'Surface Pressure'
- data['ps'].units = 'Pa'
- 
--data['ts'] = data['ts'] + 10
-+data['ts'] = data['ts']*0. + 320.
- data['ts'].id = 'ts'
- 
- variables.append('tadv')
-diff --git a/CASES/ASTEX/ASTEX_GASS-EUCLIPSE_driver_RR.nc b/CASES/ASTEX/ASTEX_GASS-EUCLIPSE_driver_RR.nc
-new file mode 100644
-index 0000000..8fabdb2
-Binary files /dev/null and b/CASES/ASTEX/ASTEX_GASS-EUCLIPSE_driver_RR.nc differ
-diff --git a/CASES/ASTEX/README b/CASES/ASTEX/README
-new file mode 100644
-index 0000000..97e95ad
---- /dev/null
-+++ b/CASES/ASTEX/README
-@@ -0,0 +1 @@
-+from http://gop.meteo.uni-koeln.de/~neggers/transitions/
-diff --git a/CASES/ASTEX/astex_input_v5.nc b/CASES/ASTEX/astex_input_v5.nc
-new file mode 100644
-index 0000000..5f9f1d8
-Binary files /dev/null and b/CASES/ASTEX/astex_input_v5.nc differ
-diff --git a/CASES/ASTEX/convert.py b/CASES/ASTEX/convert.py
-new file mode 100644
-index 0000000..4b48ab6
---- /dev/null
-+++ b/CASES/ASTEX/convert.py
-@@ -0,0 +1,225 @@
-+import cdms2 
-+import MV2
-+import numpy as np
-+
-+cdms2.setNetcdfShuffleFlag(0)
-+cdms2.setNetcdfDeflateFlag(0)
-+cdms2.setNetcdfDeflateLevelFlag(0)
-+
-+names = {}
-+units = {}
-+
-+var = 'temp'
-+names[var] = 'Temperature'
-+units[var] = 'K'
-+
-+var = 'theta'
-+names[var] = 'Potential temperature'
-+units[var] = 'K'
-+
-+var = 'pressure'
-+names[var] = 'Air Pressure'
-+units[var] = 'Pa'
-+
-+var = 'zf'
-+names[var] = 'Height'
-+units[var] = 'm'
-+
-+var = 'qv'
-+names[var] = 'Specific Humidity'
-+units[var] = 'kg kg-1'
-+
-+var = 'ql'
-+names[var] = 'Liquid water content'
-+units[var] = 'kg kg-1'
-+
-+var = 'qt'
-+names[var] = 'Total water content'
-+units[var] = 'kg kg-1'
-+
-+var = 'u'
-+names[var] = 'Zonal Wind'
-+units[var] = 'm s-1'
-+
-+var = 'v'
-+names[var] = 'Meridional Wind'
-+units[var] = 'm s-1'
-+
-+var = 'tke'
-+names[var] = 'Turbulent Kinetic Energy'
-+units[var] = 'm2 s-2'
-+
-+var = 'ug'
-+names[var] = 'Geostrophic Zonal Wind'
-+units[var] = 'm s-1'
-+
-+var = 'vg'
-+names[var] = 'Geostrophic Meridional Wind'
-+units[var] = 'm s-1'
-+
-+var = 'w'
-+names[var] = 'Vertical Velocity'
-+units[var] = 'm s-1'
-+
-+var = 'omega'
-+names[var] = 'Pressure Vertical Velocity'
-+units[var] = 'Pa s-1'
-+
-+var = 'ps'
-+names[var] = 'Surface pressure'
-+units[var] = 'Pa'
-+
-+var = 'ts'
-+names[var] = 'Surface Temperature'
-+units[var] = 'K'
-+
-+
-+
-+
-+f = cdms2.open('astex_input_v5.nc')
-+
-+lat = MV2.array([34.,],typecode=MV2.float32)
-+lat = cdms2.createAxis(lat)
-+lat.designateLatitude()
-+lat.id = 'lat'
-+lat.units = 'degrees_north'
-+
-+lon = MV2.array([-25.,],typecode=MV2.float32)
-+lon = cdms2.createAxis(lon)
-+lon.designateLongitude()
-+lon.id = 'lon'
-+lon.units = 'degrees_east'
-+
-+t0= MV2.array([0,],typecode=MV2.float32)
-+t0= cdms2.createAxis(t0)
-+#t0.designateTime()
-+t0.id = 't0'
-+t0.calendar = 'gregorian'
-+t0.units = "seconds since 1992-06-13 00:00:00"
-+
-+
-+tsec = f('tsec')
-+
-+time = cdms2.createAxis(tsec)
-+time.designateTime()
-+time.id = 'time'
-+time.units = "seconds since 1992-06-13 00:00:00"
-+time.calendar = 'gregorian'
-+
-+nt, = time.shape
-+
-+data = {}
-+
-+data['temp'] = f('T')
-+
-+lev = data['temp'].getAxis(0)
-+lev.designateLevel()
-+lev.id = 'lev'
-+lev.units = 'Pa'
-+lev.long_name = 'Pressure'
-+nlev, = lev.shape
-+
-+data['pressure'] = data['temp'].getAxis(0)[:]
-+data['theta'] = f('theta')
-+data['tke'] = f('tke')
-+data['zf'] = f('height')
-+data['qv'] = f('qv')
-+data['ql'] = f('ql')
-+data['qt'] = f('qt')
-+data['u'] = f('u')
-+data['v'] = f('v')
-+data['ug'] = f('ug')
-+data['vg'] = f('vg')
-+data['w'] = f('w')
-+
-+#data['ps'] = MV2.array(np.tile(f('Ps'),nt))
-+
-+data['ts'] = f('Tg')
-+data['ps'] = f('Ps')
-+
-+for var in ['temp','pressure','zf','qv','ql','qt','tke','u','v']:
-+#    data[var] = MV2.array(np.tile(data[var],(nt,1)))
-+#    data[var] = MV2.reshape(data[var],(nt,nlev,1,1))
-+    data[var] = MV2.reshape(data[var],(1,nlev,1,1))
-+    data[var].setAxis(0,t0)
-+    data[var].setAxis(1,lev)
-+    data[var].setAxis(2,lat)
-+    data[var].setAxis(3,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+for var in ['ug','vg']:
-+    data[var] = MV2.transpose(MV2.array(np.tile(data[var],(nlev,1))))
-+    data[var] = MV2.reshape(data[var],(nt,nlev,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lev)
-+    data[var].setAxis(2,lat)
-+    data[var].setAxis(3,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+for var in ['w']:
-+    data[var] = MV2.reshape(data[var],(nt,nlev,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lev)
-+    data[var].setAxis(2,lat)
-+    data[var].setAxis(3,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+
-+
-+for var in ['ts','ps']:
-+    data[var] = MV2.reshape(data[var],(nt,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lat)
-+    data[var].setAxis(2,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+
-+g = cdms2.open('ASTEX_GASS-EUCLIPSE_driver_RR.nc','w')
-+
-+for var in data.keys():
-+  g.write(data[var])
-+
-+g.comment = 'Forcing and initial conditions for GASS/EUCLIPSE ASTEX cases'
-+g.reference = '??'
-+g.author = 'R. Roehrig'
-+
-+
-+g.case = 'ASTEX/EUCLIPSE'
-+g.startDate = '19920613000000'
-+g.endDate = '19920614160000'
-+
-+g.qadvh = 0
-+g.tadvh = 0
-+g.tadvv = 0
-+g.qadvv = 0
-+g.trad = 0 #1 ????
-+
-+g.forc_omega = 0
-+g.forc_w = 1
-+
-+g.forc_geo = 1
-+
-+g.nudging_u = 0
-+g.nudging_v = 0
-+g.nudging_t = 0
-+g.nudging_q = 0
-+
-+#g.p_nudging_u = 110000
-+#g.p_nudging_v = 110000
-+#g.p_nudging_t = 70000
-+#g.p_nudging_q = 70000
-+
-+g.zorog = 0.
-+g.surfaceType = 'ocean'
-+g.surfaceForcing = 'ts'
-+g.z0 = 0.01
-+
-+g.close()
-diff --git a/CASES/ASTEX/description_astex.pdf b/CASES/ASTEX/description_astex.pdf
-new file mode 100644
-index 0000000..c4cf216
-Binary files /dev/null and b/CASES/ASTEX/description_astex.pdf differ
-diff --git a/CASES/ASTEX/description_astex_intro.pdf b/CASES/ASTEX/description_astex_intro.pdf
-new file mode 100644
-index 0000000..3d3ddf2
-Binary files /dev/null and b/CASES/ASTEX/description_astex_intro.pdf differ
-diff --git a/CASES/AYOTTE/AYOTTE_A00SC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A00SC_driver_FC_RR.nc
-index 1eecde7..d0108eb 100644
-Binary files a/CASES/AYOTTE/AYOTTE_A00SC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A00SC_driver_FC_RR.nc differ
-diff --git a/CASES/AYOTTE/AYOTTE_A00WC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A00WC_driver_FC_RR.nc
-index d4d7fc3..299db43 100644
-Binary files a/CASES/AYOTTE/AYOTTE_A00WC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A00WC_driver_FC_RR.nc differ
-diff --git a/CASES/AYOTTE/AYOTTE_A03SC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A03SC_driver_FC_RR.nc
-index 303b5c2..f9b7aa5 100644
-Binary files a/CASES/AYOTTE/AYOTTE_A03SC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A03SC_driver_FC_RR.nc differ
-diff --git a/CASES/AYOTTE/AYOTTE_A05SC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A05SC_driver_FC_RR.nc
-index d2f0806..12a20bb 100644
-Binary files a/CASES/AYOTTE/AYOTTE_A05SC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A05SC_driver_FC_RR.nc differ
-diff --git a/CASES/AYOTTE/AYOTTE_A05WC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A05WC_driver_FC_RR.nc
-index 169bc99..cedc9f9 100644
-Binary files a/CASES/AYOTTE/AYOTTE_A05WC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A05WC_driver_FC_RR.nc differ
-diff --git a/CASES/AYOTTE/AYOTTE_A24F_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A24F_driver_FC_RR.nc
-index b3efd1c..d9629f1 100644
-Binary files a/CASES/AYOTTE/AYOTTE_A24F_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A24F_driver_FC_RR.nc differ
-diff --git a/CASES/AYOTTE/AYOTTE_A24SC_driver_FC_RR.nc b/CASES/AYOTTE/AYOTTE_A24SC_driver_FC_RR.nc
-index 34805f6..4ac2021 100644
-Binary files a/CASES/AYOTTE/AYOTTE_A24SC_driver_FC_RR.nc and b/CASES/AYOTTE/AYOTTE_A24SC_driver_FC_RR.nc differ
-diff --git a/CASES/AYOTTE/convert_AYOTTE_A00SC.py b/CASES/AYOTTE/convert_AYOTTE_A00SC.py
-index 9735e52..d91eefe 100644
---- a/CASES/AYOTTE/convert_AYOTTE_A00SC.py
-+++ b/CASES/AYOTTE/convert_AYOTTE_A00SC.py
-@@ -18,7 +18,7 @@ f.close()
- time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
- time.designateTime()
- time.id = 'time'
--time.units = 'seconds since 2009-12-11 10:00:00'
-+time.units = 'seconds since 2009-12-11 00:00:00'
- time.calendar = 'gregorian'
- 
- lat = MV2.zeros(1,typecode=MV2.float32) + 45
-@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
- g.author = "F Couvreux"
- g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
- g.case = "AYOTTE_00SC" 
--g.startDate = "20091211100000" 
--g.endDate = "20091211160000" 
-+g.startDate = "20091211000000" 
-+g.endDate =   "20091211060000" 
- g.qadvh = 0 
- g.tadvh = 0 
- g.qadvv = 0 
-diff --git a/CASES/AYOTTE/convert_AYOTTE_A00WC.py b/CASES/AYOTTE/convert_AYOTTE_A00WC.py
-index 9eeffa0..0e1ddbd 100644
---- a/CASES/AYOTTE/convert_AYOTTE_A00WC.py
-+++ b/CASES/AYOTTE/convert_AYOTTE_A00WC.py
-@@ -18,7 +18,7 @@ f.close()
- time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
- time.designateTime()
- time.id = 'time'
--time.units = 'seconds since 2009-12-11 10:00:00'
-+time.units = 'seconds since 2009-12-11 00:00:00'
- time.calendar = 'gregorian'
- 
- lat = MV2.zeros(1,typecode=MV2.float32) + 45
-@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
- g.author = "F Couvreux"
- g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
- g.case = "AYOTTE_00WC" 
--g.startDate = "20091211100000" 
--g.endDate = "20091211160000" 
-+g.startDate = "20091211000000" 
-+g.endDate =   "20091211060000" 
- g.qadvh = 0 
- g.tadvh = 0 
- g.qadvv = 0 
-diff --git a/CASES/AYOTTE/convert_AYOTTE_A03SC.py b/CASES/AYOTTE/convert_AYOTTE_A03SC.py
-index 70b648e..01794e6 100644
---- a/CASES/AYOTTE/convert_AYOTTE_A03SC.py
-+++ b/CASES/AYOTTE/convert_AYOTTE_A03SC.py
-@@ -18,7 +18,7 @@ f.close()
- time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
- time.designateTime()
- time.id = 'time'
--time.units = 'seconds since 2009-12-11 10:00:00'
-+time.units = 'seconds since 2009-12-11 00:00:00'
- time.calendar = 'gregorian'
- 
- lat = MV2.zeros(1,typecode=MV2.float32) + 45
-@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
- g.author = "F Couvreux"
- g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
- g.case = "AYOTTE_03SC" 
--g.startDate = "20091211100000" 
--g.endDate = "20091211160000" 
-+g.startDate = "20091211000000" 
-+g.endDate =   "20091211060000" 
- g.qadvh = 0 
- g.tadvh = 0 
- g.qadvv = 0 
-diff --git a/CASES/AYOTTE/convert_AYOTTE_A05SC.py b/CASES/AYOTTE/convert_AYOTTE_A05SC.py
-index 8e91241..493f760 100644
---- a/CASES/AYOTTE/convert_AYOTTE_A05SC.py
-+++ b/CASES/AYOTTE/convert_AYOTTE_A05SC.py
-@@ -18,7 +18,7 @@ f.close()
- time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
- time.designateTime()
- time.id = 'time'
--time.units = 'seconds since 2009-12-11 10:00:00'
-+time.units = 'seconds since 2009-12-11 00:00:00'
- time.calendar = 'gregorian'
- 
- lat = MV2.zeros(1,typecode=MV2.float32) + 45
-@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
- g.author = "F Couvreux"
- g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
- g.case = "AYOTTE_05SC" 
--g.startDate = "20091211100000" 
--g.endDate = "20091211160000" 
-+g.startDate = "20091211000000" 
-+g.endDate =   "20091211060000" 
- g.qadvh = 0 
- g.tadvh = 0 
- g.qadvv = 0 
-diff --git a/CASES/AYOTTE/convert_AYOTTE_A05WC.py b/CASES/AYOTTE/convert_AYOTTE_A05WC.py
-index a9be406..5763359 100644
---- a/CASES/AYOTTE/convert_AYOTTE_A05WC.py
-+++ b/CASES/AYOTTE/convert_AYOTTE_A05WC.py
-@@ -18,7 +18,7 @@ f.close()
- time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
- time.designateTime()
- time.id = 'time'
--time.units = 'seconds since 2009-12-11 10:00:00'
-+time.units = 'seconds since 2009-12-11 00:00:00'
- time.calendar = 'gregorian'
- 
- lat = MV2.zeros(1,typecode=MV2.float32) + 45
-@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
- g.author = "F Couvreux"
- g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
- g.case = "AYOTTE_05WC" 
--g.startDate = "20091211100000" 
--g.endDate = "20091211160000" 
-+g.startDate = "20091211000000" 
-+g.endDate =   "20091211060000" 
- g.qadvh = 0 
- g.tadvh = 0 
- g.qadvv = 0 
-diff --git a/CASES/AYOTTE/convert_AYOTTE_A24F.py b/CASES/AYOTTE/convert_AYOTTE_A24F.py
-index 3fc2662..deb2931 100644
---- a/CASES/AYOTTE/convert_AYOTTE_A24F.py
-+++ b/CASES/AYOTTE/convert_AYOTTE_A24F.py
-@@ -18,7 +18,7 @@ f.close()
- time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
- time.designateTime()
- time.id = 'time'
--time.units = 'seconds since 2009-12-11 10:00:00'
-+time.units = 'seconds since 2009-12-11 00:00:00'
- time.calendar = 'gregorian'
- 
- lat = MV2.zeros(1,typecode=MV2.float32) + 45
-@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
- g.author = "F Couvreux"
- g.modifications = "2018-04-20: R. Roehrig put all fields on the same vertical and time axes"
- g.case = "AYOTTE_24F" 
--g.startDate = "20091211100000" 
--g.endDate = "20091211160000" 
-+g.startDate = "20091211000000" 
-+g.endDate =   "20091211060000" 
- g.qadvh = 0 
- g.tadvh = 0 
- g.qadvv = 0 
-diff --git a/CASES/AYOTTE/convert_AYOTTE_A24SC.py b/CASES/AYOTTE/convert_AYOTTE_A24SC.py
-index 287d0b1..961adea 100644
---- a/CASES/AYOTTE/convert_AYOTTE_A24SC.py
-+++ b/CASES/AYOTTE/convert_AYOTTE_A24SC.py
-@@ -18,7 +18,7 @@ f.close()
- time = cdms2.createAxis(MV2.array([0.,3600*6],typecode=MV2.float32))
- time.designateTime()
- time.id = 'time'
--time.units = 'seconds since 2009-12-11 10:00:00'
-+time.units = 'seconds since 2009-12-11 00:00:00'
- time.calendar = 'gregorian'
- 
- lat = MV2.zeros(1,typecode=MV2.float32) + 45
-@@ -146,8 +146,8 @@ g.reference = 'Ayotte et al (1996, BLM)'
- g.author = "F Couvreux"
- g.modifications = "2017-07-17: R. Roehrig put all fields on the same vertical and time axes"
- g.case = "AYOTTE_24SC" 
--g.startDate = "20091211100000" 
--g.endDate = "20091211160000" 
-+g.startDate = "20091211000000" 
-+g.endDate =   "20091211060000" 
- g.qadvh = 0 
- g.tadvh = 0 
- g.qadvv = 0 
-diff --git a/CASES/BOMEX/BOMEX_driver_MPL_RR.nc b/CASES/BOMEX/BOMEX_driver_MPL_RR.nc
-index d9ad6f5..6f92a24 100644
-Binary files a/CASES/BOMEX/BOMEX_driver_MPL_RR.nc and b/CASES/BOMEX/BOMEX_driver_MPL_RR.nc differ
-diff --git a/CASES/BOMEX/convert.py b/CASES/BOMEX/convert.py
-index 2fd0eb8..c97aa5b 100644
---- a/CASES/BOMEX/convert.py
-+++ b/CASES/BOMEX/convert.py
-@@ -59,6 +59,13 @@ data['sfc_lat_flx'].id = 'sfc_lat_flx'
- data['sfc_lat_flx'].units = 'W/m2'
- data['sfc_lat_flx'].title = 'Surface latent heat flux'
- 
-+data['ustar'] = data['sfc_lat_flx']*0.+0.28
-+data['ustar'].id = 'ustar'
-+data['ustar'].units = 'm s-1'
-+data['ustar'].title = 'usar'
-+
-+
-+
- for ilev in range(0,nlev):
-   if lev[ilev] <= 300:
-       data['qadvh'][:,ilev,:,:] = -1.2e-8
-@@ -78,7 +85,7 @@ data['theta'].id = 'theta'
- 
- g = cdms2.open('BOMEX_driver_MPL_RR.nc','w')
- 
--for var in ['height','pressure','ps','temp','theta','qv','u','v','w','trad','thrad','qadvh','ug','vg','sfc_sens_flx','sfc_lat_flx','ts']:
-+for var in ['height','pressure','ps','temp','theta','qv','u','v','w','trad','thrad','qadvh','ug','vg','sfc_sens_flx','sfc_lat_flx','ts','ustar']:
-     if len(data[var].shape) == 4:
-         data[var].setAxis(1,lev)
-     data[var].setAxis(0,time)
-@@ -89,7 +96,7 @@ g.author = "MP Lefebvre (20170628), R. Roehrig (20180404)" ;
- g.version = "20180404" ;
- g.case = "BOMEX" ;
- g.startDate = "19690624000000" ;
--g.endDate = "19690624060000" ;
-+g.endDate = "19690624230000" ;
- g.comment = """Forcing and initial confitions for BOMEX case
- Large-scale subsidence w applied to qt, thetal, u, v
- Radiative cooling dtheta/dt
-@@ -110,11 +117,11 @@ g.nudging_v = 0
- g.nudging_t = 0
- g.nudging_q = 0
- g.zorog = 0.
--g.z0 = 0.001019
-+#g.z0 = 0.001019
- #g.ustar = 0.28
- g.surfaceType = "ocean"
- g.surfaceForcing = "surfaceFlux"
--g.surfaceForcingWind = "z0"
-+g.surfaceForcingWind = "ustar"
- 
- g.close()
- 
-diff --git a/CASES/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc b/CASES/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc
-index 4d58f73..b47227b 100644
-Binary files a/CASES/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc and b/CASES/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc differ
-diff --git a/CASES/CINDY-DYNAMO/NSA3a/cindy_nsa3a.nc b/CASES/CINDY-DYNAMO/NSA3a/cindy_nsa3a.nc
-index d8f54bb..f253c7b 100644
-Binary files a/CASES/CINDY-DYNAMO/NSA3a/cindy_nsa3a.nc and b/CASES/CINDY-DYNAMO/NSA3a/cindy_nsa3a.nc differ
-diff --git a/CASES/CINDY-DYNAMO/NSA3a/convert2nc.py b/CASES/CINDY-DYNAMO/NSA3a/convert2nc.py
-index e00c49c..75ccd3e 100644
---- a/CASES/CINDY-DYNAMO/NSA3a/convert2nc.py
-+++ b/CASES/CINDY-DYNAMO/NSA3a/convert2nc.py
-@@ -457,7 +457,7 @@ data['vqs'   ] = data['vqs'] / 1000. * -1
- data['flat'  ] = data['flat'] /3.45*100.
- data['sens'  ] = data['sens'] /3.45*100.
- data['Qrad'  ] = data['Qrad'] /3.45*100.
--data['Qrad_CERES'] = data['Qrad'] /3.45*100.
-+data['Qrad_CERES'] = data['Qrad_CERES'] /3.45*100.
- 
- data['advTs' ] = data['hTs'] + data['vTs']
- data['advqs' ] = data['hqs'] + data['vqs']
-diff --git a/CASES/CINDY-DYNAMO/NSA3a/convertDEPHY2_flux.py b/CASES/CINDY-DYNAMO/NSA3a/convertDEPHY2_flux.py
-index 2135391..55fb0b3 100644
---- a/CASES/CINDY-DYNAMO/NSA3a/convertDEPHY2_flux.py
-+++ b/CASES/CINDY-DYNAMO/NSA3a/convertDEPHY2_flux.py
-@@ -97,6 +97,7 @@ g.z0 = 0.01
- g.ustar = 0.
- g.surfaceType = 'ocean'
- g.surfaceForcing = 'surfaceFlux'
-+g.surfaceForcingWind = 'z0'
- 
- g.close()
- 
-diff --git a/CASES/EMS_cases.py b/CASES/EMS_cases.py
-index 39f2929..daf841a 100644
---- a/CASES/EMS_cases.py
-+++ b/CASES/EMS_cases.py
-@@ -110,8 +110,8 @@ case = 'FIRE'
- cases.append(case)
- subcases[case] = ['REF']
- data_input[case] = {}
--#data_input[case]['REF'] = rep0 + '/FIRE/Fire-I_driver_RR.nc'
--data_input[case]['REF'] = rep0 + '/FIRE/Fire-I_driver_RR_v3.nc'
-+#data_input[case]['REF'] = rep0 + '/FIRE/Fire-I_driver_RR_v3.nc'
-+data_input[case]['REF'] = rep0 + '/FIRE/Fire-I_driver_RR.nc'
- 
- # DYCOMS Case
- case = 'DYCOMS'
-@@ -120,6 +120,22 @@ subcases[case] = ['REF']
- data_input[case] = {}
- data_input[case]['REF'] = rep0 + '/DYCOMS/DYCOMS_driver_FC_RR.nc'
- 
-+# ASTEX cases
-+case = 'ASTEX'
-+cases.append(case)
-+subcases[case] = ['EUCLIPSE']
-+data_input[case] = {}
-+data_input[case]['EUCLIPSE'] = rep0 + '/ASTEX/ASTEX_GASS-EUCLIPSE_driver_RR.nc'
-+
-+# SANDU composite cases
-+case = 'SANDU'
-+cases.append(case)
-+subcases[case] = ['REF','FAST','SLOW']
-+data_input[case] = {}
-+data_input[case]['REF'] = rep0 + '/SANDU/Composite_REF_driver_RR.nc'
-+data_input[case]['FAST'] = rep0 + '/SANDU/Composite_FAST_driver_RR.nc'
-+data_input[case]['SLOW'] = rep0 + '/SANDU/Composite_SLOW_driver_RR.nc'
-+
- ####################################
- #### Deep convection cases
- 
-@@ -151,9 +167,10 @@ data_input[case]['REF'] = rep0 + '/AMMA/AMMA_20060710_setupI_driver_RR.nc'
- case = 'CINDY-DYNAMO'
- cases.append(case)
- #subcases[case] = ['NSA3a','NSA3aflux','SSA3a']
--subcases[case] = ['NSA3a']
--subcases[case] = ['Revelle-ARM-CSU-13Nov']
--subcases[case] = ['Revelle-PE-13Nov']
-+#subcases[case] = ['NSA3a']
-+subcases[case] = ['NSA3aflux']
-+#subcases[case] = ['Revelle-ARM-CSU-13Nov']
-+#subcases[case] = ['Revelle-PE-13Nov']
- data_input[case] = {}
- data_input[case]['NSA3a'] = rep0 + '/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3a_driver_RR.nc'
- data_input[case]['NSA3aflux'] = rep0 + '/CINDY-DYNAMO/NSA3a/cindy-dynamo-NSA3aflux_driver_RR.nc'
-diff --git a/CASES/FIRE/Fire-I_driver_RR.nc b/CASES/FIRE/Fire-I_driver_RR.nc
-index 43356b5..0bb9b29 100644
-Binary files a/CASES/FIRE/Fire-I_driver_RR.nc and b/CASES/FIRE/Fire-I_driver_RR.nc differ
-diff --git a/CASES/FIRE/convert_v3.py b/CASES/FIRE/convert_v3.py
-index badf324..c9edf39 100644
---- a/CASES/FIRE/convert_v3.py
-+++ b/CASES/FIRE/convert_v3.py
-@@ -148,12 +148,9 @@ for ilev in range(0,nlev):
-     elif lev[ilev] <= 2000:
-         data['thl'][:,ilev,:,:] = data['thl'][:,ilev,:,:] + 299.5 + 7.5e-3*(lev[ilev]-595)
-         data['qt'][:,ilev,:,:] = data['qt'][:,ilev,:,:] + 0.0066 - 3.e-6*(lev[ilev]-595)
--        data['thladvh'][:,ilev,:,:] = data['thladvh'][:,ilev,:,:] -7.5e-8*max(lev[ilev],500.)
--        data['qtadvh'][:,ilev,:,:] = data['qtadvh'][:,ilev,:,:] +3.e-11*max(lev[ilev],500.)
--        data['w'][:,ilev,:,:] = data['w'][:,ilev,:,:] - 1.e-5*lev[ilev]
-     else:
-         data['thl'][:,ilev,:,:] = thstd2[ilev]+(299.5 + 7.5e-3*(2000-595)-thstd2[ilev])*math.exp(-(lev[ilev]-2000)/3000.)
--        data['qt'][:,ilev,:,:] = (0.0066 - 3.e-6*(2000.-595.))*math.exp(-(lev[ilev]-2000)/3000.)
-+        data['qt'][:,ilev,:,:] = 0. #(0.0066 - 3.e-6*(2000.-595.))*math.exp(-(lev[ilev]-2000)/3000.)
- 
- kappa = 2./7.
- p0 = 100000.
-diff --git a/CASES/FIRE/images/height.png b/CASES/FIRE/images/height.png
-index afad045..e8196fe 100644
-Binary files a/CASES/FIRE/images/height.png and b/CASES/FIRE/images/height.png differ
-diff --git a/CASES/FIRE/images/pressure.png b/CASES/FIRE/images/pressure.png
-index 8ea230b..19f75f9 100644
-Binary files a/CASES/FIRE/images/pressure.png and b/CASES/FIRE/images/pressure.png differ
-diff --git a/CASES/FIRE/images/ql.png b/CASES/FIRE/images/ql.png
-new file mode 100644
-index 0000000..afeeef0
-Binary files /dev/null and b/CASES/FIRE/images/ql.png differ
-diff --git a/CASES/FIRE/images/qt.png b/CASES/FIRE/images/qt.png
-index 3fd32bc..a78e554 100644
-Binary files a/CASES/FIRE/images/qt.png and b/CASES/FIRE/images/qt.png differ
-diff --git a/CASES/FIRE/images/qtadvh.png b/CASES/FIRE/images/qtadvh.png
-index 18eff78..045765f 100644
-Binary files a/CASES/FIRE/images/qtadvh.png and b/CASES/FIRE/images/qtadvh.png differ
-diff --git a/CASES/FIRE/images/qv.png b/CASES/FIRE/images/qv.png
-index c5bb47c..24c9c0e 100644
-Binary files a/CASES/FIRE/images/qv.png and b/CASES/FIRE/images/qv.png differ
-diff --git a/CASES/FIRE/images/rh.png b/CASES/FIRE/images/rh.png
-new file mode 100644
-index 0000000..27d11b8
-Binary files /dev/null and b/CASES/FIRE/images/rh.png differ
-diff --git a/CASES/FIRE/images/tadvh.png b/CASES/FIRE/images/tadvh.png
-index c9fcf48..9987717 100644
-Binary files a/CASES/FIRE/images/tadvh.png and b/CASES/FIRE/images/tadvh.png differ
-diff --git a/CASES/FIRE/images/temp.png b/CASES/FIRE/images/temp.png
-index 67a4436..dad5e38 100644
-Binary files a/CASES/FIRE/images/temp.png and b/CASES/FIRE/images/temp.png differ
-diff --git a/CASES/FIRE/images/theta.png b/CASES/FIRE/images/theta.png
-new file mode 100644
-index 0000000..67532fd
-Binary files /dev/null and b/CASES/FIRE/images/theta.png differ
-diff --git a/CASES/FIRE/images/thl.png b/CASES/FIRE/images/thl.png
-index a5262f5..2fd71b6 100644
-Binary files a/CASES/FIRE/images/thl.png and b/CASES/FIRE/images/thl.png differ
-diff --git a/CASES/FIRE/images/thladvh.png b/CASES/FIRE/images/thladvh.png
-index dc9ee9a..8445ade 100644
-Binary files a/CASES/FIRE/images/thladvh.png and b/CASES/FIRE/images/thladvh.png differ
-diff --git a/CASES/FIRE/images/ths.png b/CASES/FIRE/images/ths.png
-new file mode 100644
-index 0000000..e2e9043
-Binary files /dev/null and b/CASES/FIRE/images/ths.png differ
-diff --git a/CASES/FIRE/images/thv.png b/CASES/FIRE/images/thv.png
-new file mode 100644
-index 0000000..6c8bf7e
-Binary files /dev/null and b/CASES/FIRE/images/thv.png differ
-diff --git a/CASES/FIRE/images/u.png b/CASES/FIRE/images/u.png
-index 25f5b01..df64a38 100644
-Binary files a/CASES/FIRE/images/u.png and b/CASES/FIRE/images/u.png differ
-diff --git a/CASES/FIRE/images/ug.png b/CASES/FIRE/images/ug.png
-index 79e4499..4f5d881 100644
-Binary files a/CASES/FIRE/images/ug.png and b/CASES/FIRE/images/ug.png differ
-diff --git a/CASES/FIRE/images/v.png b/CASES/FIRE/images/v.png
-index 39bb720..1c2fe55 100644
-Binary files a/CASES/FIRE/images/v.png and b/CASES/FIRE/images/v.png differ
-diff --git a/CASES/FIRE/images/vg.png b/CASES/FIRE/images/vg.png
-index fe4a642..ee8e828 100644
-Binary files a/CASES/FIRE/images/vg.png and b/CASES/FIRE/images/vg.png differ
-diff --git a/CASES/FIRE/images/w.png b/CASES/FIRE/images/w.png
-index cb406a7..a5bf865 100644
-Binary files a/CASES/FIRE/images/w.png and b/CASES/FIRE/images/w.png differ
-diff --git a/CASES/FIRE/qtadvh.gif b/CASES/FIRE/qtadvh.gif
-deleted file mode 100644
-index 687e30d..0000000
-Binary files a/CASES/FIRE/qtadvh.gif and /dev/null differ
-diff --git a/CASES/FIRE/thladvh.gif b/CASES/FIRE/thladvh.gif
-deleted file mode 100644
-index d516cfa..0000000
-Binary files a/CASES/FIRE/thladvh.gif and /dev/null differ
-diff --git a/CASES/RICO/convert.py b/CASES/RICO/convert.py
-index 3fa9deb..85dd2ef 100644
---- a/CASES/RICO/convert.py
-+++ b/CASES/RICO/convert.py
-@@ -49,8 +49,17 @@ tmp.setAxis(2,lat)
- tmp.setAxis(3,lon)
- data[var] = tmp
- 
-+nlev,nlat,nlon = data['temp'].shape
- 
--for var in ['temp','qv','u','v','height','pressure']:
-+data['tke'] = data['temp']*0.
-+for ilev in range(0,nlev):
-+    data['tke'][ilev,0,0] = max(0,1-data['height'][ilev,0,0]/4000.) 
-+
-+data['tke'].id = 'tke'
-+data['tke'].title = 'TKE'
-+data['tke'].units = 'm2 s-2'
-+
-+for var in ['temp','qv','u','v','height','pressure','tke']:
-   nlev,nlat,nlon = data[var].shape	
-   tmp = data[var].reshape((1,nlev,nlat,nlon))
-   for att in data[var].listattributes():
-@@ -64,7 +73,7 @@ for var in ['temp','qv','u','v','height','pressure']:
-   data[var] = tmp
- 
- g = cdms2.open('rico_driver_RR.nc','w')
--for var in f.listvariables():
-+for var in f.listvariables() + ['tke',]:
-   if len(data[var].shape) == 4:	
-     data[var].setAxis(1,lev)
-     data[var].setAxis(2,lat)
-@@ -87,13 +96,14 @@ g.author = 'R. Roehrig'
- 
- g.case = 'RICO'
- g.startDate = '20041216000000'
--g.endDate =   '20041218210000'
-+g.endDate =   '20041217000000'
-+#g.endDate =   '20041218210000'
- 
- g.qadvh = 1
- g.tadvh = 1
- g.tadvv = 0
- g.qadvv = 0
--g.trad = 0 #1 ????
-+g.trad = "adv" #0 #1 ????
- 
- g.forc_omega = 1
- g.forc_w = 0
-diff --git a/CASES/RICO/rico_driver_RR.nc b/CASES/RICO/rico_driver_RR.nc
-index 981b320..2be6ed1 100644
-Binary files a/CASES/RICO/rico_driver_RR.nc and b/CASES/RICO/rico_driver_RR.nc differ
-diff --git a/CASES/SANDU/Composite_FAST_driver_RR.nc b/CASES/SANDU/Composite_FAST_driver_RR.nc
-new file mode 100644
-index 0000000..4fd18da
-Binary files /dev/null and b/CASES/SANDU/Composite_FAST_driver_RR.nc differ
-diff --git a/CASES/SANDU/Composite_REF_driver_RR.nc b/CASES/SANDU/Composite_REF_driver_RR.nc
-new file mode 100644
-index 0000000..c9d68b3
-Binary files /dev/null and b/CASES/SANDU/Composite_REF_driver_RR.nc differ
-diff --git a/CASES/SANDU/Composite_SLOW_driver_RR.nc b/CASES/SANDU/Composite_SLOW_driver_RR.nc
-new file mode 100644
-index 0000000..4d1b935
-Binary files /dev/null and b/CASES/SANDU/Composite_SLOW_driver_RR.nc differ
-diff --git a/CASES/SANDU/DeRoode.et.al_JAS_2016.pdf b/CASES/SANDU/DeRoode.et.al_JAS_2016.pdf
-new file mode 100644
-index 0000000..bc17e66
-Binary files /dev/null and b/CASES/SANDU/DeRoode.et.al_JAS_2016.pdf differ
-diff --git a/CASES/SANDU/README b/CASES/SANDU/README
-new file mode 100644
-index 0000000..97e95ad
---- /dev/null
-+++ b/CASES/SANDU/README
-@@ -0,0 +1 @@
-+from http://gop.meteo.uni-koeln.de/~neggers/transitions/
-diff --git a/CASES/SANDU/Sandu.Stevens_JAS_May2011.pdf b/CASES/SANDU/Sandu.Stevens_JAS_May2011.pdf
-new file mode 100644
-index 0000000..de48ee4
-Binary files /dev/null and b/CASES/SANDU/Sandu.Stevens_JAS_May2011.pdf differ
-diff --git a/CASES/SANDU/composite_fast_init.nc b/CASES/SANDU/composite_fast_init.nc
-new file mode 100644
-index 0000000..08db001
-Binary files /dev/null and b/CASES/SANDU/composite_fast_init.nc differ
-diff --git a/CASES/SANDU/composite_ref_init.nc b/CASES/SANDU/composite_ref_init.nc
-new file mode 100644
-index 0000000..6d2a80e
-Binary files /dev/null and b/CASES/SANDU/composite_ref_init.nc differ
-diff --git a/CASES/SANDU/composite_slow_init.nc b/CASES/SANDU/composite_slow_init.nc
-new file mode 100644
-index 0000000..d193546
-Binary files /dev/null and b/CASES/SANDU/composite_slow_init.nc differ
-diff --git a/CASES/SANDU/convert.py b/CASES/SANDU/convert.py
-new file mode 100644
-index 0000000..47c8ac2
---- /dev/null
-+++ b/CASES/SANDU/convert.py
-@@ -0,0 +1,172 @@
-+import cdms2 
-+import MV2
-+import numpy as np
-+
-+cdms2.setNetcdfShuffleFlag(0)
-+cdms2.setNetcdfDeflateFlag(0)
-+cdms2.setNetcdfDeflateLevelFlag(0)
-+
-+names = {}
-+units = {}
-+
-+var = 'temp'
-+names[var] = 'Temperature'
-+units[var] = 'K'
-+
-+var = 'pressure'
-+names[var] = 'Air Pressure'
-+units[var] = 'Pa'
-+
-+
-+var = 'zf'
-+names[var] = 'Height'
-+units[var] = 'm'
-+
-+var = 'qv'
-+names[var] = 'Specific Humidity'
-+units[var] = 'kg kg-1'
-+
-+var = 'u'
-+names[var] = 'Zonal Wind'
-+units[var] = 'm s-1'
-+
-+var = 'v'
-+names[var] = 'Meridional Wind'
-+units[var] = 'm s-1'
-+
-+var = 'w'
-+names[var] = 'Vertical Velocity'
-+units[var] = 'm s-1'
-+
-+var = 'omega'
-+names[var] = 'Pressure Vertical Velocity'
-+units[var] = 'Pa s-1'
-+
-+var = 'ps'
-+names[var] = 'Surface pressure'
-+units[var] = 'Pa'
-+
-+var = 'ts'
-+names[var] = 'Surface Temperature'
-+units[var] = 'K'
-+
-+
-+
-+
-+f = cdms2.open('composite_ref_init.nc')
-+
-+lat = MV2.array([25.,],typecode=MV2.float32)
-+lat = cdms2.createAxis(lat)
-+lat.designateLatitude()
-+lat.id = 'lat'
-+lat.units = 'degrees_north'
-+
-+lon = MV2.array([-125.,],typecode=MV2.float32)
-+lon = cdms2.createAxis(lon)
-+lon.designateLongitude()
-+lon.id = 'lon'
-+lon.units = 'degrees_east'
-+
-+t0= MV2.array([0,],typecode=MV2.float32)
-+t0= cdms2.createAxis(t0)
-+#t0.designateTime()
-+t0.id = 't0'
-+t0.calendar = 'gregorian'
-+t0.units = "seconds since 2007-7-15 00:00:00"
-+
-+
-+tsec = f('tsec')
-+
-+time = cdms2.createAxis(tsec)
-+time.designateTime()
-+time.id = 'time'
-+time.units = "seconds since 2007-7-15 00:00:00"
-+time.calendar = 'gregorian'
-+
-+nt, = time.shape
-+
-+data = {}
-+
-+data['temp'] = f('T')
-+
-+lev = data['temp'].getAxis(0)
-+lev.designateLevel()
-+lev.id = 'lev'
-+lev.units = 'Pa'
-+lev.long_name = 'Pressure'
-+nlev, = lev.shape
-+
-+data['pressure'] = data['temp'].getAxis(0)[:]
-+data['zf'] = f('height')
-+data['qv'] = f('qt')
-+data['u'] = f('u')
-+data['v'] = f('v')
-+data['w'] = f('w')
-+data['omega'] = f('omega')
-+
-+data['ps'] = MV2.array(np.tile(f('Ps'),nt))
-+
-+data['ts'] = f('Tg')
-+
-+for var in ['temp','pressure','zf','qv','u','v','w','omega']:
-+    data[var] = MV2.array(np.tile(data[var],(nt,1)))
-+    data[var] = MV2.reshape(data[var],(nt,nlev,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lev)
-+    data[var].setAxis(2,lat)
-+    data[var].setAxis(3,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+for var in ['ts','ps']:
-+    data[var] = MV2.reshape(data[var],(nt,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lat)
-+    data[var].setAxis(2,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+
-+g = cdms2.open('Composite_REF_driver_RR.nc','w')
-+
-+for var in data.keys():
-+  g.write(data[var])
-+
-+g.comment = 'Forcing and initial conditions for I. SANDU Composite cases - REF'
-+g.reference = '??'
-+g.author = 'R. Roehrig'
-+
-+
-+g.case = 'SANDU/REF'
-+g.startDate = '20070715000000'
-+g.endDate = '20070718000000'
-+
-+g.qadvh = 0
-+g.tadvh = 0
-+g.tadvv = 0
-+g.qadvv = 0
-+g.trad = 0 #1 ????
-+
-+g.forc_omega = 0
-+g.forc_w = 1
-+
-+g.forc_geo = 0
-+
-+g.nudging_u = 3600
-+g.nudging_v = 3600
-+g.nudging_t = 3600
-+g.nudging_q = 3600
-+
-+g.p_nudging_u = 110000
-+g.p_nudging_v = 110000
-+g.p_nudging_t = 70000
-+g.p_nudging_q = 70000
-+
-+g.zorog = 0.
-+g.surfaceType = 'ocean'
-+g.surfaceForcing = 'ts'
-+g.z0 = 0.01
-+
-+g.close()
-diff --git a/CASES/SANDU/convert_fast.py b/CASES/SANDU/convert_fast.py
-new file mode 100644
-index 0000000..490266b
---- /dev/null
-+++ b/CASES/SANDU/convert_fast.py
-@@ -0,0 +1,172 @@
-+import cdms2 
-+import MV2
-+import numpy as np
-+
-+cdms2.setNetcdfShuffleFlag(0)
-+cdms2.setNetcdfDeflateFlag(0)
-+cdms2.setNetcdfDeflateLevelFlag(0)
-+
-+names = {}
-+units = {}
-+
-+var = 'temp'
-+names[var] = 'Temperature'
-+units[var] = 'K'
-+
-+var = 'pressure'
-+names[var] = 'Air Pressure'
-+units[var] = 'Pa'
-+
-+
-+var = 'zf'
-+names[var] = 'Height'
-+units[var] = 'm'
-+
-+var = 'qv'
-+names[var] = 'Specific Humidity'
-+units[var] = 'kg kg-1'
-+
-+var = 'u'
-+names[var] = 'Zonal Wind'
-+units[var] = 'm s-1'
-+
-+var = 'v'
-+names[var] = 'Meridional Wind'
-+units[var] = 'm s-1'
-+
-+var = 'w'
-+names[var] = 'Vertical Velocity'
-+units[var] = 'm s-1'
-+
-+var = 'omega'
-+names[var] = 'Pressure Vertical Velocity'
-+units[var] = 'Pa s-1'
-+
-+var = 'ps'
-+names[var] = 'Surface pressure'
-+units[var] = 'Pa'
-+
-+var = 'ts'
-+names[var] = 'Surface Temperature'
-+units[var] = 'K'
-+
-+
-+
-+
-+f = cdms2.open('composite_fast_init.nc')
-+
-+lat = MV2.array([25.,],typecode=MV2.float32)
-+lat = cdms2.createAxis(lat)
-+lat.designateLatitude()
-+lat.id = 'lat'
-+lat.units = 'degrees_north'
-+
-+lon = MV2.array([-125.,],typecode=MV2.float32)
-+lon = cdms2.createAxis(lon)
-+lon.designateLongitude()
-+lon.id = 'lon'
-+lon.units = 'degrees_east'
-+
-+t0= MV2.array([0,],typecode=MV2.float32)
-+t0= cdms2.createAxis(t0)
-+#t0.designateTime()
-+t0.id = 't0'
-+t0.calendar = 'gregorian'
-+t0.units = "seconds since 2007-7-15 00:00:00"
-+
-+
-+tsec = f('tsec')
-+
-+time = cdms2.createAxis(tsec)
-+time.designateTime()
-+time.id = 'time'
-+time.units = "seconds since 2007-7-15 00:00:00"
-+time.calendar = 'gregorian'
-+
-+nt, = time.shape
-+
-+data = {}
-+
-+data['temp'] = f('T')
-+
-+lev = data['temp'].getAxis(0)
-+lev.designateLevel()
-+lev.id = 'lev'
-+lev.units = 'Pa'
-+lev.long_name = 'Pressure'
-+nlev, = lev.shape
-+
-+data['pressure'] = data['temp'].getAxis(0)[:]
-+data['zf'] = f('height')
-+data['qv'] = f('qt')
-+data['u'] = f('u')
-+data['v'] = f('v')
-+data['w'] = f('w')
-+data['omega'] = f('omega')
-+
-+data['ps'] = MV2.array(np.tile(f('Ps'),nt))
-+
-+data['ts'] = f('Tg')
-+
-+for var in ['temp','pressure','zf','qv','u','v','w','omega']:
-+    data[var] = MV2.array(np.tile(data[var],(nt,1)))
-+    data[var] = MV2.reshape(data[var],(nt,nlev,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lev)
-+    data[var].setAxis(2,lat)
-+    data[var].setAxis(3,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+for var in ['ts','ps']:
-+    data[var] = MV2.reshape(data[var],(nt,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lat)
-+    data[var].setAxis(2,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+
-+g = cdms2.open('Composite_FAST_driver_RR.nc','w')
-+
-+for var in data.keys():
-+  g.write(data[var])
-+
-+g.comment = 'Forcing and initial conditions for I. SANDU Composite cases - FAST'
-+g.reference = '??'
-+g.author = 'R. Roehrig'
-+
-+
-+g.case = 'SANDU/FAST'
-+g.startDate = '20070715000000'
-+g.endDate = '20070718000000'
-+
-+g.qadvh = 0
-+g.tadvh = 0
-+g.tadvv = 0
-+g.qadvv = 0
-+g.trad = 0 #1 ????
-+
-+g.forc_omega = 0
-+g.forc_w = 1
-+
-+g.forc_geo = 0
-+
-+g.nudging_u = 3600
-+g.nudging_v = 3600
-+g.nudging_t = 3600
-+g.nudging_q = 3600
-+
-+g.p_nudging_u = 110000
-+g.p_nudging_v = 110000
-+g.p_nudging_t = 70000
-+g.p_nudging_q = 70000
-+
-+g.zorog = 0.
-+g.surfaceType = 'ocean'
-+g.surfaceForcing = 'ts'
-+g.z0 = 0.01
-+
-+g.close()
-diff --git a/CASES/SANDU/convert_slow.py b/CASES/SANDU/convert_slow.py
-new file mode 100644
-index 0000000..66cb93a
---- /dev/null
-+++ b/CASES/SANDU/convert_slow.py
-@@ -0,0 +1,172 @@
-+import cdms2 
-+import MV2
-+import numpy as np
-+
-+cdms2.setNetcdfShuffleFlag(0)
-+cdms2.setNetcdfDeflateFlag(0)
-+cdms2.setNetcdfDeflateLevelFlag(0)
-+
-+names = {}
-+units = {}
-+
-+var = 'temp'
-+names[var] = 'Temperature'
-+units[var] = 'K'
-+
-+var = 'pressure'
-+names[var] = 'Air Pressure'
-+units[var] = 'Pa'
-+
-+
-+var = 'zf'
-+names[var] = 'Height'
-+units[var] = 'm'
-+
-+var = 'qv'
-+names[var] = 'Specific Humidity'
-+units[var] = 'kg kg-1'
-+
-+var = 'u'
-+names[var] = 'Zonal Wind'
-+units[var] = 'm s-1'
-+
-+var = 'v'
-+names[var] = 'Meridional Wind'
-+units[var] = 'm s-1'
-+
-+var = 'w'
-+names[var] = 'Vertical Velocity'
-+units[var] = 'm s-1'
-+
-+var = 'omega'
-+names[var] = 'Pressure Vertical Velocity'
-+units[var] = 'Pa s-1'
-+
-+var = 'ps'
-+names[var] = 'Surface pressure'
-+units[var] = 'Pa'
-+
-+var = 'ts'
-+names[var] = 'Surface Temperature'
-+units[var] = 'K'
-+
-+
-+
-+
-+f = cdms2.open('composite_slow_init.nc')
-+
-+lat = MV2.array([25.,],typecode=MV2.float32)
-+lat = cdms2.createAxis(lat)
-+lat.designateLatitude()
-+lat.id = 'lat'
-+lat.units = 'degrees_north'
-+
-+lon = MV2.array([-125.,],typecode=MV2.float32)
-+lon = cdms2.createAxis(lon)
-+lon.designateLongitude()
-+lon.id = 'lon'
-+lon.units = 'degrees_east'
-+
-+t0= MV2.array([0,],typecode=MV2.float32)
-+t0= cdms2.createAxis(t0)
-+#t0.designateTime()
-+t0.id = 't0'
-+t0.calendar = 'gregorian'
-+t0.units = "seconds since 2007-7-15 00:00:00"
-+
-+
-+tsec = f('tsec')
-+
-+time = cdms2.createAxis(tsec)
-+time.designateTime()
-+time.id = 'time'
-+time.units = "seconds since 2007-7-15 00:00:00"
-+time.calendar = 'gregorian'
-+
-+nt, = time.shape
-+
-+data = {}
-+
-+data['temp'] = f('T')
-+
-+lev = data['temp'].getAxis(0)
-+lev.designateLevel()
-+lev.id = 'lev'
-+lev.units = 'Pa'
-+lev.long_name = 'Pressure'
-+nlev, = lev.shape
-+
-+data['pressure'] = data['temp'].getAxis(0)[:]
-+data['zf'] = f('height')
-+data['qv'] = f('qt')
-+data['u'] = f('u')
-+data['v'] = f('v')
-+data['w'] = f('w')
-+data['omega'] = f('omega')
-+
-+data['ps'] = MV2.array(np.tile(f('Ps'),nt))
-+
-+data['ts'] = f('Tg')
-+
-+for var in ['temp','pressure','zf','qv','u','v','w','omega']:
-+    data[var] = MV2.array(np.tile(data[var],(nt,1)))
-+    data[var] = MV2.reshape(data[var],(nt,nlev,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lev)
-+    data[var].setAxis(2,lat)
-+    data[var].setAxis(3,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+for var in ['ts','ps']:
-+    data[var] = MV2.reshape(data[var],(nt,1,1))
-+    data[var].setAxis(0,time)
-+    data[var].setAxis(1,lat)
-+    data[var].setAxis(2,lon)
-+    data[var].id = var
-+    data[var].long_name = names[var]
-+    data[var].units = units[var]
-+
-+
-+g = cdms2.open('Composite_SLOW_driver_RR.nc','w')
-+
-+for var in data.keys():
-+  g.write(data[var])
-+
-+g.comment = 'Forcing and initial conditions for I. SANDU Composite cases - SLOW'
-+g.reference = '??'
-+g.author = 'R. Roehrig'
-+
-+
-+g.case = 'SANDU/SLOW'
-+g.startDate = '20070715000000'
-+g.endDate = '20070718000000'
-+
-+g.qadvh = 0
-+g.tadvh = 0
-+g.tadvv = 0
-+g.qadvv = 0
-+g.trad = 0 #1 ????
-+
-+g.forc_omega = 0
-+g.forc_w = 1
-+
-+g.forc_geo = 0
-+
-+g.nudging_u = 3600
-+g.nudging_v = 3600
-+g.nudging_t = 3600
-+g.nudging_q = 3600
-+
-+g.p_nudging_u = 110000
-+g.p_nudging_v = 110000
-+g.p_nudging_t = 70000
-+g.p_nudging_q = 70000
-+
-+g.zorog = 0.
-+g.surfaceType = 'ocean'
-+g.surfaceForcing = 'ts'
-+g.z0 = 0.01
-+
-+g.close()
-diff --git a/CASES/SANDU/description_composite.pdf b/CASES/SANDU/description_composite.pdf
-new file mode 100644
-index 0000000..2e44c65
-Binary files /dev/null and b/CASES/SANDU/description_composite.pdf differ
-diff --git a/CASES/SANDU/description_composite_addendum.txt b/CASES/SANDU/description_composite_addendum.txt
-new file mode 100644
-index 0000000..3b3c76e
---- /dev/null
-+++ b/CASES/SANDU/description_composite_addendum.txt
-@@ -0,0 +1,12 @@
-+Addendum to "description_composite.pdf"
-+---------------------------------------
-+
-+This documentation concerns the setup of the three composite cases as part of the EUCLIPSE/GASS intercomparison study for SCM/LES.
-+
-+Two changes were introduced by Irina Sandu:
-+
-+* relaxation of U,V throughout atmosphere
-+
-+* relaxation of T,Q above 3km
-+
-+RN, 20110309
-diff --git a/Examples/config/config_41t1_AROME_OPER.py b/Examples/config/config_41t1_AROME_OPER.py
-index 13c027b..e49408e 100644
---- a/Examples/config/config_41t1_AROME_OPER.py
-+++ b/Examples/config/config_41t1_AROME_OPER.py
-@@ -5,7 +5,7 @@ rep0 = os.getenv('REP_MUSC')
- config = 'AROME_OPER'
- cycle = '41t1_op1.11_MUSC'
- MASTER = '/home/roehrig/pack/' + cycle + '/bin/MASTERODB'
--#PGD = '/home/roehrig/pack/' + cycle + '/bin/PGD'
--#PREP = '/home/roehrig/pack/' + cycle + '/bin/PREP'
-+PGD = '/home/roehrig/pack/' + cycle + '/bin/PGD'
-+PREP = '/home/roehrig/pack/' + cycle + '/bin/PREP'
- namATMref = rep0 + '/namelist/AROME/namarp_41t1_AROME_HTUNE'
- #namSFXref = rep0 + '/namelist/SURFEX/nam.sfx.tl127.CMIP6.v631'
-diff --git a/Examples/config/config_46t1_AROME_EMI.py b/Examples/config/config_46t1_AROME_EMI.py
-deleted file mode 100644
-index a961016..0000000
---- a/Examples/config/config_46t1_AROME_EMI.py
-+++ /dev/null
-@@ -1,11 +0,0 @@
--import os
--
--rep0 = os.getenv('REP_MUSC')
--
--config = 'AROME_EMI'
--cycle = '46t1_Honnert'
--MASTER = '/home/roehrig/pack/' + cycle + '/bin/MASTERODB'
--#PGD = '/home/roehrig/pack/' + cycle + '/bin/PGD'
--#PREP = '/home/roehrig/pack/' + cycle + '/bin/PREP'
--namATMref = rep0 + '/namelist/AROME/namarp_46t1_AROME_EMI'
--#namSFXref = rep0 + '/namelist/SURFEX/nam.sfx.tl127.CMIP6.v631'
-diff --git a/Examples/config/config_arp631_CMIP6.py b/Examples/config/config_arp631_CMIP6.py
-index bff28f7..84da07a 100644
---- a/Examples/config/config_arp631_CMIP6.py
-+++ b/Examples/config/config_arp631_CMIP6.py
-@@ -4,8 +4,8 @@ rep0 = os.getenv('REP_MUSC')
- 
- config = 'CMIP6'
- cycle = 'arp631'
--MASTER = '/home/common/pack/arp603_export.01.GFORTRAN610.cx/bin/MASTER'
--PGD = '/home/common/pack/arp603_export.01.GFORTRAN610.cx/bin/PGD'
--PREP = '/home/common/pack/arp603_export.01.GFORTRAN610.cx/bin/PREP'
-+MASTER = '/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/bin//MASTERODB'
-+PGD = '/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/bin/PGD'
-+PREP = '/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/bin/PREP'
- namATMref = rep0 + '/namelist/ARPCLIMAT/nam.atm.tl127l91r.CMIP6.v631'
- namSFXref = rep0 + '/namelist/SURFEX/nam.sfx.tl127.CMIP6.v631'
-diff --git a/Examples/configsim.py b/Examples/configsim.py
-index 92a63f4..79b2e60 100644
---- a/Examples/configsim.py
-+++ b/Examples/configsim.py
-@@ -1,9 +1,8 @@
- import sys
- import EMS_cases as CC
- 
--# model : ARPCLIMAT, AROME, AROME46t1, ARPPNT
-+# model : ARPCLIMAT, AROME, ARPPNT
- #model = 'AROME'
--#model = 'AROME46t1'
- #model = 'ARPPNT'
- model = 'ARPCLIMAT'
- 
-@@ -20,7 +19,7 @@ if model in ['ARPCLIMAT',]:
-   nlev = 91
-   # Model time step in seconds
-   timestep = 300
--elif model in ['AROME','AROME46t1',]:
-+elif model in ['AROME',]:
-   # Number of vertical level
-   nlev= 90
-   # Model time step in seconds
-diff --git a/Examples/namelist/AROME/namarp_46t1_AROME_EMI b/Examples/namelist/AROME/namarp_46t1_AROME_EMI
-deleted file mode 100644
-index f8cbdd4..0000000
---- a/Examples/namelist/AROME/namarp_46t1_AROME_EMI
-+++ /dev/null
-@@ -1,607 +0,0 @@
-- &NACIETEO
-- /
-- &NACOBS
-- /
-- &NACTAN
-- /
-- &NACTEX
-- /
-- &NACVEG
-- /
-- &NADOCK
-- /
-- &NAEAEM7
-- /
-- &NAEAER
-- /
-- &NAECOAPHY
-- /
-- &NAEPHLI
-- /
-- &NAEPHY
-- /
-- &NAERAD
--   LRRTM=.FALSE.,
--   LSRTM=.FALSE.,
--   NMCICA=0,
--   NRADFR=-1,
--   NSW=6,
--   RLWINHF=0.9,
-- /
-- &NAERCLI
-- /
-- &NAETLDIAG
-- /
-- &NAEVOL
-- /
-- &NAIMPO
-- /
-- &NALORI
-- /
-- &NAMACV
-- /
-- &NAMAERDET
-- /
-- &NAMAFN
-- /
-- &NAMARG
--   CNMEXP='ARPE',
--   NCONF=1,
--   LELAM=.TRUE.,
--   LECMWF=.FALSE.,
--   LSLAG=.TRUE.,
--   NSUPERSEDE=1,
-- /
-- &NAMARPHY
--   LMPA=.TRUE.,
--   LMICRO=.TRUE.,
--   LTURB=.TRUE.,
--   LMSE=.FALSE.,
--   LKFBCONV=.FALSE.,
--   LKFBD=.FALSE.,
--   LKFBS=.FALSE.,
--   LMFSHAL=.TRUE.,
-- /
-- &NAMCA
-- /
-- &NAMCAPE
-- /
-- &NAMCFU
--   LCUMFU=.FALSE.,
-- /
-- &NAMCHEM
-- /
-- &NAMCHET
-- /
-- &NAMCHK
-- /
-- &NAMCLA
-- /
-- &NAMCLDP
-- /
-- &NAMCLI
-- /
-- &NAMCLOP15
-- /
-- &NAMCLTC
-- /
-- &NAMCOK
-- /
-- &NAMCOM
-- /
-- &NAMCOMPO
-- /
-- &NAMCOSJO
-- /
-- &NAMCT0
--   LAROME=.TRUE.,
--   LREGETA=.TRUE.,
--   LSPRT=.TRUE.,
--   CNPPATH='.',
--   LFDBOP=.FALSE.,
--   LFBDAP=.TRUE.,
--   LTWOTL=.TRUE.,
--   LSFORC=.TRUE.,
--   LSFORCS=.TRUE.,
--   NFRHIS=1,
--   NFRPOS=1,
--   NFRSDI=1,
--   NHISTS(0)=-30,
--   NHISTS(1)=0,
--   NHISTS(2)=-1,
--   NHISTS(3)=-2,
--   NHISTS(4)=-3,
--   NHISTS(5)=-4,
--   NHISTS(6)=-5,
--   NHISTS(7)=-6,
--   NHISTS(8)=-7,
--   NHISTS(9)=-8,
--   NHISTS(10)=-9,
--   NHISTS(11)=-10,
--   NHISTS(12)=-11,
--   NHISTS(13)=-12,
--   NHISTS(14)=-13,
--   NHISTS(15)=-14,
--   NHISTS(16)=-15,
--   NHISTS(17)=-16,
--   NHISTS(18)=-17,
--   NHISTS(19)=-18,
--   NHISTS(20)=-19,
--   NHISTS(21)=-20,
--   NHISTS(22)=-21,
--   NHISTS(23)=-22,
--   NHISTS(24)=-23,
--   NHISTS(25)=-24,
--   NHISTS(26)=-25,
--   NHISTS(27)=-26,
--   NHISTS(28)=-27,
--   NHISTS(29)=-28,
--   NHISTS(30)=-29,
--   LGRIB_API=.FALSE.,
--   LALLOPR=.FALSE.,
--   NUNDEFLD=-99999999,
-- /
-- &NAMCT1
--   LRFILAF=.FALSE.,
--   N1POS=0,
--   N1RES=0,
--   N1SFXHIS=0,
-- /
-- &NAMCUMF
-- /
-- &NAMCUMFS
-- /
-- &NAMCVER
-- /
-- &NAMCVMNH
-- /
-- &NAMDDH
-- /
-- &NAMDFI
-- /
-- &NAMDIM
--   NPROMA=-4,
-- /
-- &NAMDIMO
-- /
-- &NAMDIM_TRAJ
-- /
-- &NAMDPHY
-- /
-- &NAMDYN
--   NCOMP_CVGQ=1,
--   BETADT=1.,
--   LADVF=.FALSE.,
--   LIMPF=.FALSE.,
--   LQMT=.FALSE.,
--   LQMPD=.FALSE.,
--   LQMVD=.FALSE.,
--   NSITER=0,
--   NSPDLAG=3,
--   NSVDLAG=3,
--   NTLAG=3,
--   NVLAG=3,
--   NWLAG=3,
--   RCMSLP0=0.,
--   REPS1=0.,
--   REPS2=0.,
--   REPSM1=0.,
--   REPSM2=0.,
--   REPSP1=0.,
--   REXPDH=4.,
--   SIPR=101325.,
--   SITR=350.,
--   SITRA=50.,
--   VESL=0.,
--   XIDT=0.,
--   VMAX1=100.,
--   VMAX2=120.,
-- /
-- &NAMDYNA
--   NDLNPR=1,
--   LNESC=.FALSE.,
--   LNESCT=.FALSE.,
--   LNESCV=.FALSE.,
--   LSETTLS=.TRUE.,
--   LSETTLST=.TRUE.,
--   LSETTLSV=.TRUE.,
--   LPC_FULL=.FALSE.,
-- /
-- &NAMDYNCORE
-- /
-- &NAMEMIS_CONF
-- /
-- &NAMENKF
-- /
-- &NAMENSCOV
-- /
-- &NAMFA
--   NSTRON=0,
-- /
-- &NAMFAINIT
-- /
-- &NAMFPC
-- /
-- &NAMFPD
-- /
-- &NAMFPDY2
-- /
-- &NAMFPDYF
-- /
-- &NAMFPDYH
-- /
-- &NAMFPDYI
-- /
-- &NAMFPDYP
-- /
-- &NAMFPDYS
-- /
-- &NAMFPDYT
-- /
-- &NAMFPDYV
-- /
-- &NAMFPF
-- /
-- &NAMFPG
-- /
-- &NAMFPIOS
-- /
-- &NAMFPMOVE
-- /
-- &NAMFPOBJ
-- /
-- &NAMFPPHY
-- /
-- &NAMFPSC2
-- /
-- &NAMFPSC2_DEP
-- /
-- &NAMGEM
-- /
-- &NAMGFL
--   YQ_NL%LQM=.FALSE.,
--   YQ_NL%NREQIN=1,
--   YQ_NL%NCOUPLING=0,
--   YL_NL%NREQIN=0,
--   YL_NL%NCOUPLING=0,
--   YI_NL%NREQIN=0,
--   YI_NL%NCOUPLING=0,
--   YS_NL%NREQIN=0,
--   YS_NL%NCOUPLING=0,
--   YR_NL%NREQIN=0,
--   YR_NL%NCOUPLING=0,
--   YG_NL%NREQIN=0,
--   YG_NL%NCOUPLING=0,
--   YTKE_NL%NREQIN=-1,
--   YTKE_NL%NCOUPLING=0,
--   YA_NL%NCOUPLING=0,
--   YLRAD_NL%LGP=.TRUE.,
--   YLRAD_NL%NCOUPLING=0,
--   YIRAD_NL%LGP=.TRUE.,
--   YIRAD_NL%NCOUPLING=0,
--   YSRC_NL%NCOUPLING=0,
--   NGFL_FORC=14,
--   NGFL_EZDIAG=23,
-- /
-- &NAMGRIB
-- /
-- &NAMGWD
-- /
-- &NAMGWDIAG
-- /
-- &NAMGWWMS
-- /
-- &NAMIAU
-- /
-- &NAMICE
-- /
-- &NAMINI
--   LDFI=.FALSE.,
-- /
-- &NAMINTFLEX
-- /
-- &NAMIOMI
-- /
-- &NAMIOS
-- /
-- &NAMIO_SERV
-- /
-- &NAMJBCODES
-- /
-- &NAMJG
-- /
-- &NAMLCZ
-- /
-- &NAMLIMA
-- /
-- &NAMLSFORC
--   LMUSCLFA=.FALSE.,
--   LGEOST_UV_FRC=.TRUE.,
--   RCORIO_FORC=0.000085,
--   RZ0_FORC=0.035,
--   NGEOST_U_DEB=1,
--   NGEOST_U_NUM=1,
--   NGEOST_V_DEB=2,
--   NGEOST_V_NUM=1,
--   LT_ADV_FRC=.TRUE.,
--   NT_ADV_DEB=3,
--   NT_ADV_NUM=6,
--   LQV_ADV_FRC=.TRUE.,
--   NQV_ADV_DEB=9,
--   NQV_ADV_NUM=6,
--   LSW_FRC=.FALSE.,
--   NSH_FORC_DEB=1,
--   NSH_FORC_NUM=7,
--   NLH_FORC_DEB=8,
--   NLH_FORC_NUM=7,
--   NL_T_ADV_TIME(1)=0,
--   NL_T_ADV_TIME(2)=10800,
--   NL_T_ADV_TIME(3)=21600,
--   NL_T_ADV_TIME(4)=32400,
--   NL_T_ADV_TIME(5)=43200,
--   NL_T_ADV_TIME(6)=52200,
--   NL_QV_ADV_TIME(1)=0,
--   NL_QV_ADV_TIME(2)=10800,
--   NL_QV_ADV_TIME(3)=21600,
--   NL_QV_ADV_TIME(4)=32400,
--   NL_QV_ADV_TIME(5)=43200,
--   NL_QV_ADV_TIME(6)=52200,
--   NL_SH_ADV_TIME(1)=0,
--   NL_SH_ADV_TIME(2)=14400,
--   NL_SH_ADV_TIME(3)=23400,
--   NL_SH_ADV_TIME(4)=27000,
--   NL_SH_ADV_TIME(5)=36000,
--   NL_SH_ADV_TIME(6)=45000,
--   NL_SH_ADV_TIME(7)=52200,
--   NL_LH_ADV_TIME(1)=0,
--   NL_LH_ADV_TIME(2)=14400,
--   NL_LH_ADV_TIME(3)=23400,
--   NL_LH_ADV_TIME(4)=27000,
--   NL_LH_ADV_TIME(5)=36000,
--   NL_LH_ADV_TIME(6)=45000,
--   NL_LH_ADV_TIME(7)=52200,
-- /
-- &NAMMARS
-- /
-- &NAMMCC
-- /
-- &NAMMCUF
-- /
-- &NAMMETHOX
-- /
-- &NAMMKODB
-- /
-- &NAMMODERR
-- /
-- &NAMMTS
-- /
-- &NAMMWAVE
-- /
-- &NAMNORGWD
-- /
-- &NAMNPROF
-- /
-- &NAMNUD
-- /
-- &NAMOBS
-- /
-- &NAMOOPS
-- /
-- &NAMOPH
--   LINC=.TRUE.,
--   CFNHWF='ECHIS',
-- /
-- &NAMOPTCMEM
-- /
-- &NAMPAR0
--   MBX_SIZE=__MBX_SIZE__,
--   NOUTPUT=1,
--   NPROC=__NTASKS__,
--   MP_TYPE=__MP_TYPE__,
--   LOPT_SCALAR=__LOPT_SCALAR__,
--   NPRINTLEV=1,
-- /
-- &NAMPAR1
--   L_GATHERV_WRGP=.FALSE.,
--   LEQ_REGIONS=.FALSE.,
--   LSPLIT=.FALSE.,
--   LSPLITOUT=.FALSE.,
--   NSTRIN=__NTASKS__,
--   NSTROUT=__NTASKS__,
--   NCOMBFLEN=__NCOMBFLEN__,
-- /
-- &NAMPARAR
--   NPTP=1,
--   NPRINTFR=10000,
--   LOSUBG_COND=.TRUE.,
--   LOSIGMAS=.TRUE.,
--   LOSEDIC=.TRUE.,
--   VSIGQSAT=0.02,
--   LFPREC3D=.FALSE.,
--   XALP_PERT= 0.3 , 
--   XABUO=1,
--   XBENTR=1,
--   XBDETR=0,
--   XCMF=0.065,
--   XENTR_MF=0.035,
--   XCRAD_MF=50,
--   XENTR_DRY=0.55,
--   XDETR_DRY=10, 
--   XDETR_LUP=1,
--   XKCF_MF=2.75,
--   XPRES_UV=0.5,
--   XFRAC_UP_MAX=0.33,
--   XLINI=0.,
--   XCTD=1.2,
--   XCTP=4.65,
--   XCED=0.85,
--   XCEP=2.11,
--   XCET=0.40,
--   XALPSBL=4.63,
--   XPHI_LIM=3., /
-- &NAMPHMSE
--   LPGDFWR=.FALSE.,
-- /
-- &NAMPHY
--   LMPHYS=.TRUE.,
--   LRAYFM=.FALSE.,
-- /
-- &NAMPHY0
--   REFLKUO=5000.,
--   REFLRHC=25000.,
-- /
-- &NAMPHY1
-- /
-- &NAMPHY2
-- /
-- &NAMPHY3
-- /
-- &NAMPHYDS
--   NSFORC=14,
-- /
-- &NAMPPC
-- /
-- &NAMPPVI
-- /
-- &NAMPRE
-- /
-- &NAMRAD15
-- /
-- &NAMRADCMEM
-- /
-- &NAMRCF
-- /
-- &NAMRCOEF
-- /
-- &NAMRES
-- /
-- &NAMRGRI
-- /
-- &NAMRINC
-- /
-- &NAMRIP
--   CSTOP='t60',
--   TSTEP=60.,
-- /
-- &NAMRIP0
-- /
-- &NAMRLX
-- /
-- &NAMSATS
-- /
-- &NAMSCC
-- /
-- &NAMSCEN
-- /
-- &NAMSCM
-- /
-- &NAMSEKF
-- /
-- &NAMSENS
-- /
-- &NAMSIMPHL
-- /
-- &NAMSPNG
-- /
-- &NAMSPP
-- /
-- &NAMSPSDT
-- /
-- &NAMSTA
-- /
-- &NAMSTOPH
-- /
-- &NAMSWE
-- /
-- &NAMTESTVAR
-- /
-- &NAMTHLIM
-- /
-- &NAMTOPH
--   ETCVIM=5000.,
--   ETNEBU=5000.,
--   ETPLUI=5000.,
--   XDRMTK=2.0D-8,
--   XDRMTP=800.,
--   XDRMTX=4.0D-7,
--   XDRMUK=1.0D-7,
--   XDRMUP=800.,
--   XDRMUX=0.000002,
-- /
-- &NAMTRAJP
-- /
-- &NAMTRANS
-- /
-- &NAMTRANS0
-- /
-- &NAMVAR
-- /
-- &NAMVARBC
-- /
-- &NAMVARBC_AIREP
-- /
-- &NAMVARBC_ALLSKY
-- /
-- &NAMVARBC_GBRAD
-- /
-- &NAMVARBC_RAD
-- /
-- &NAMVARBC_SFCOBS
-- /
-- &NAMVARBC_TCWV
-- /
-- &NAMVARBC_TO3
-- /
-- &NAMVAREPS
-- /
-- &NAMVDF
-- /
-- &NAMVDOZ
-- /
-- &NAMVOLCANO
-- /
-- &NAMVRTL
-- /
-- &NAMVV0
-- /
-- &NAMVV1
-- /
-- &NAMVWRK
-- /
-- &NAMWAVELETJB
-- /
-- &NAMXFU
--   LXFU=.FALSE.,
-- /
-- &NAM_CANAPE
-- /
-- &NAM_DISTRIBUTED_VECTORS
-- /
-- &NAPHLC
-- /
-- &NEMCT0
--   LEQLIMSAT=.TRUE.,
-- /
-- &NEMDIM
-- /
-- &NEMDYN
-- /
-- &NEMELBC0A
--   NBICOP=2,
--   NBICOT=2,
--   NBICOU=2,
--   NECRIPL=1,
-- /
-- &NEMELBC0B
--   TEFRCL=0.,
-- /
-- &NEMFPEZO
-- /
-- &NEMGEO
-- /
-- &NEMJK
-- /
-- &NEMVAR
-- /
-- &NEMWAVELET
-- /
-diff --git a/Examples/post/config_ASTEX.py b/Examples/post/config_ASTEX.py
-new file mode 100644
-index 0000000..5a67a9a
---- /dev/null
-+++ b/Examples/post/config_ASTEX.py
-@@ -0,0 +1,36 @@
-+#saveall = True
-+saveall = False
-+
-+#var2save = ['pf','zf','theta','temp','qv','u','v','wap','ql','qi','qr','qsn','rneb','cc','prw','rain','lhf','shf','tsurf','hur','Q1','Q2','qlc','qic','qrc','qsnc','tke','w_up','Mf','alpha_up','ustar','z0']
-+var2save = ['pf','zf','theta','temp','qv','u','v','wap','ql','qi','qr','qsn','rneb','cc','prw','rain','lhf','shf','tsurf','hur','Q1','Q2','qlc','qic','qrc','qsnc','tke','w_up','Mf','alpha_up','ustar','z0','dTv_up','T_up','qv_up','eps_u','det_u','B_up','eps_u_org','eps_u_tur','det_u_org','det_u_tur']
-+
-+convert2p = False
-+convert2z = True
-+#convert2z = False
-+
-+convertkday = False
-+convertpday = False
-+convertzday = False
-+
-+convertk1h = False
-+convertp1h = False
-+convertz1h = False
-+
-+convertk3h = False # not coded for True
-+convertp3h = False
-+convertz3h = False # not coded for True
-+
-+# Pour convert2p, niveau en hPa
-+levout = []
-+for i in range(1,41):
-+  levout.append(i*25.)
-+levout.reverse()
-+
-+# Pour convert2z, niveau en m
-+levoutz = []
-+for i in range(0,401):
-+  levoutz.append(i*50.)
-+levoutz.reverse()
-+
-+# Niveau de print (0, 1 ou 2)
-+verbose = 2
-diff --git a/Examples/post/config_SANDU.py b/Examples/post/config_SANDU.py
-new file mode 100644
-index 0000000..5a67a9a
---- /dev/null
-+++ b/Examples/post/config_SANDU.py
-@@ -0,0 +1,36 @@
-+#saveall = True
-+saveall = False
-+
-+#var2save = ['pf','zf','theta','temp','qv','u','v','wap','ql','qi','qr','qsn','rneb','cc','prw','rain','lhf','shf','tsurf','hur','Q1','Q2','qlc','qic','qrc','qsnc','tke','w_up','Mf','alpha_up','ustar','z0']
-+var2save = ['pf','zf','theta','temp','qv','u','v','wap','ql','qi','qr','qsn','rneb','cc','prw','rain','lhf','shf','tsurf','hur','Q1','Q2','qlc','qic','qrc','qsnc','tke','w_up','Mf','alpha_up','ustar','z0','dTv_up','T_up','qv_up','eps_u','det_u','B_up','eps_u_org','eps_u_tur','det_u_org','det_u_tur']
-+
-+convert2p = False
-+convert2z = True
-+#convert2z = False
-+
-+convertkday = False
-+convertpday = False
-+convertzday = False
-+
-+convertk1h = False
-+convertp1h = False
-+convertz1h = False
-+
-+convertk3h = False # not coded for True
-+convertp3h = False
-+convertz3h = False # not coded for True
-+
-+# Pour convert2p, niveau en hPa
-+levout = []
-+for i in range(1,41):
-+  levout.append(i*25.)
-+levout.reverse()
-+
-+# Pour convert2z, niveau en m
-+levoutz = []
-+for i in range(0,401):
-+  levoutz.append(i*50.)
-+levoutz.reverse()
-+
-+# Niveau de print (0, 1 ou 2)
-+verbose = 2
-diff --git a/UTIL/Init_Forc/AROME46t1/L60.dta b/UTIL/Init_Forc/AROME46t1/L60.dta
-deleted file mode 100755
-index 04af4ee..0000000
---- a/UTIL/Init_Forc/AROME46t1/L60.dta
-+++ /dev/null
-@@ -1,61 +0,0 @@
--0.000000 0.0000000000
--271.828183 0.0000000000
--973.188280 0.0000000000
--2030.384267 0.0000000000
--3319.226030 0.0000000000
--4795.396231 0.0000000000
--6433.281895 0.0000000000
--8215.601394 0.0000000000
--10096.132563 0.0003309675
--11988.307779 0.0017502454
--13834.682123 0.0047467200
--15583.858088 0.0097630763
--17187.794886 0.0172188647
--18602.008555 0.0275061852
--19786.497669 0.0409789128
--20706.971826 0.0579393888
--21336.176625 0.0786244617
--21655.154375 0.1031923737
--21654.293789 0.1317118797
--21349.398517 0.1630387143
--20799.963249 0.1956652968
--20063.043810 0.2291058092
--19186.977397 0.2629653973
--18211.807506 0.2969317553
--17170.190348 0.3307628186
--16088.493072 0.3642733463
--14987.896852 0.3973221613
--13885.397395 0.4298010406
--12794.651871 0.4616256930
--11726.658425 0.4927289008
--10690.276989 0.5230556870
--9692.612455 0.5525602477
--8739.286691 0.5812043462
--7834.626887 0.6089568564
--6981.796027 0.6357941683
--6182.888017 0.6617012022
--5439.005999 0.6866728253
--4750.338217 0.7107155105
--4116.241919 0.7338491181
--3535.342466 0.7561087224
--3005.652443 0.7775464304
--2524.714255 0.7982331608
--2089.769666 0.8182603537
--1705.297418 0.8373613875
--1374.651994 0.8552205742
--1093.095953 0.8718800642
--855.930809 0.8873812719
--658.559613 0.9017642034
--496.535186 0.9150669112
--365.596754 0.9273250455
--261.697342 0.9385714693
--181.023925 0.9488359088
--120.012010 0.9581446011
--75.356071 0.9665198957
--44.017046 0.9739797401
--23.227928 0.9805369262
--10.498339 0.9861978406
--3.618836 0.9909600628
--0.665238 0.9948065724
--0.000000 0.9976807303
--0.000000 1.0000000000
-diff --git a/UTIL/Init_Forc/AROME46t1/L90.dta b/UTIL/Init_Forc/AROME46t1/L90.dta
-deleted file mode 100755
-index 1386c6b..0000000
---- a/UTIL/Init_Forc/AROME46t1/L90.dta
-+++ /dev/null
-@@ -1,91 +0,0 @@
--      0.      0.
--      2718.281829      0.0000000000
--      3747.089291      0.0000000000
--      4915.587160      0.0000000000
--      6184.629456      0.0000000000
--      7511.826567      0.0000000000
--      8869.101344      0.0000000000
--     10030.304356      0.0020808742
--     10981.652856      0.0063342307
--     11785.441359      0.0121732181
--     12467.115388      0.0193986154
--     13036.996600      0.0278371306
--     13504.534974      0.0373529653
--     13878.638942      0.0478429390
--     14167.467732      0.0592352126
--     14378.164793      0.0714873482
--     14516.624747      0.0845746582
--     14587.358345      0.0983741718
--     14595.755313      0.1128383503
--     14546.696521      0.1279315334
--     14444.613314      0.1436185400
--     14293.673022      0.1598595007
--     14097.987345      0.1766044735
--     13861.830406      0.1937879788
--     13589.853257      0.2113235966
--     13287.281608      0.2290987842
--     12960.083871      0.2469701004
--     12612.251710      0.2649022016
--     12247.287675      0.2828675957
--     11868.245840      0.3008456607
--     11477.778900      0.3188216081
--     11078.188746      0.3367854211
--     10671.478183      0.3547307961
--     10259.401904      0.3726541060
--      9843.515363      0.3905533994
--      9425.220462      0.4084274461
--      9005.807300      0.4262748343
--      8586.491397      0.4440931265
--      8168.695589      0.4618674416
--      7753.760647      0.4795830255
--      7342.954609      0.4972249800
--      6937.480580      0.5147780123
--      6538.483021      0.5322262004
--      6147.052425      0.5495527773
--      5764.228347     0.5667399335
--      5391.000788      0.5837686388
--      5028.309984      0.6006184839
--      4677.044680      0.6172675404
--      4338.039010      0.6336922407
--      4012.068233      0.6498672716
--      3699.843282      0.6657654933
--      3402.004748      0.6813578657
--      3119.007629      0.6966193450
--      2851.141239      0.7115283190
--      2598.537627      0.7260667007
--      2361.182186      0.7402199922
--      2138.926037      0.7539773233
--      1931.499783      0.7673314668
--      1738.528216      0.7802788340
--      1559.545611      0.7928194542
--      1394.011240      0.8049569410
--      1241.324890      0.8166984434
--      1100.841912      0.8280546004
--       971.887912      0.8390394770
--       853.772700      0.8496705050
--       746.106511      0.8599386316
--       648.446293      0.8698369440
--       560.305239      0.8793606592
--       481.162282      0.8885071083
--       410.471379      0.8972757162
--       347.670445      0.9056679778
--       292.189811      0.9136874321
--       243.460098      0.9213396338
--       200.919421      0.9286321259
--       164.019880      0.9355744104
--       132.233270      0.9421779224
--       105.056050      0.9484559990
--        82.013496      0.9544238611
--        62.744832      0.9600729770
--        46.885714      0.9653949126
--        34.071514      0.9703813221
--        23.940739      0.9750239392
--        16.138537      0.9793145669
--        10.320302      0.9832450676
--         6.155336      0.9868073535
--         3.330576      0.9899933762
--         1.554347      0.9927951169
--         0.560130      0.9952045769
--         0.110328      0.9972137692
--         0.000000      0.9988147073
--         0.000000      1.0000000000
-diff --git a/UTIL/Init_Forc/AROME46t1/prepare_nam1D.py b/UTIL/Init_Forc/AROME46t1/prepare_nam1D.py
-deleted file mode 100644
-index f7fc495..0000000
---- a/UTIL/Init_Forc/AROME46t1/prepare_nam1D.py
-+++ /dev/null
-@@ -1,410 +0,0 @@
--import cdms2
--import MV2
--import os
--import interpvertp
--import config
--import math
--
--cdms2.setNetcdfShuffleFlag(0)
--cdms2.setNetcdfDeflateFlag(0)
--cdms2.setNetcdfDeflateLevelFlag(0)
--
--lforc = config.lforc
--lnam1D = config.lnam1D
--#ASCII2FA=config.ASCII2FA
--
--nlev_out = config.nlev
--
--#dirout = 'files_L' + str(nlev_out) + '_' + str(int(config.dt)) + 's/'
--
--#---------------------------------------------------------------
--# Lecture des donnees d'entree
--#---------------------------------------------------------------
--
--var2read = ['pressure','temp','qv','u','v','ps']
--var2interpol = ['temp','qv','u','v']
--
--data_in = {}
--
--f = cdms2.open('data_input.nc')
--
--lat = f['temp'].getLatitude()[0]
--lon = f['temp'].getLongitude()[0]
--
--t0 = f['temp'].getAxis(0)[0]
--units0 = f['temp'].getAxis(0).units
--
--attributes = {}
--for att in ['tadvh','qdvh','qtadvh','uadvh','vadvh','tadvv','qadvv','qtadvv','uadvv','vadvv','tadv','qadv','uadv','vadv','trad','forc_omega','forc_w','forc_geo','nudging_t','nudging_q','nudging_u','nudging_v','surfaceForcing','z0','ustar']:
--  attributes[att] = 0
--
--for att in f.listglobal():
--  attributes[att] = f.getglobal(att)	
--
--LRAYFM = True
--
--zorog = float(attributes['zorog'])
--
--startDate = str(f.startDate)
--year = int(startDate[0:4])
--month = int(startDate[4:6])
--day = int(startDate[6:8])
--hour = int(startDate[8:10])
--minute = int(startDate[10:12])
--
--nb_f=0
--nb_fs=0
--
--if attributes['tadv'] == 1:
--  var2read.append('tadv')	
--  var2interpol.append('tadv')
--  time = f('tadv').getTime()
--  nb_f=nb_f+1
--if attributes['qadv'] == 1:
--  var2read.append('qadv')	
--  var2interpol.append('qadv')
--  nb_f=nb_f+1
--if attributes['tadvh'] == 1:
--  var2read.append('tadvh')	
--  var2interpol.append('tadvh')
--  time = f('tadvh').getTime()
--  nb_f=nb_f+1
--if attributes['qadvh'] == 1:
--  var2read.append('qadvh')	
--  var2interpol.append('qadvh')
--  nb_f=nb_f+1
--if attributes['qtadvh'] == 1:
--  var2read.append('qtadvh')	
--  var2interpol.append('qtadvh')
--  nb_f=nb_f+1
--if attributes['uadvh'] == 1:
--  var2read.append('uadvh')	
--  var2interpol.append('uadvh')
--  nb_f=nb_f+1
--if attributes['vadvh'] == 1:
--  var2read.append('vadvh')	
--  var2interpol.append('vadvh')
--  nb_f=nb_f+1
--if attributes['tadvv'] == 1:
--  var2read.append('tadvv')	
--  var2interpol.append('tadvv')
--  nb_f=nb_f+1
--if attributes['qadvv'] == 1:
--  var2read.append('qadvv')	
--  var2interpol.append('qadvv')
--  nb_f=nb_f+1
--if attributes['uadvv'] == 1:
--  var2read.append('uadvv')	
--  var2interpol.append('uadvv')
--  nb_f=nb_f+1
--if attributes['vadvv'] == 1:
--  var2read.append('vadvv')	
--  var2interpol.append('vadvv')
--  nb_f=nb_f+1
--if attributes['trad'] == 'adv':
--  LRAYFM = False  	
--if attributes['trad'] == 1:
--  LRAYFM = False	
--  var2read.append('trad')	
--  var2interpol.append('trad')
--  nb_f=nb_f+1
--if attributes['forc_omega'] == 1:
--  var2read.append('omega')	
--  var2interpol.append('omega')
--  time = f('omega').getTime()
--  nb_f=nb_f+1
--if attributes['forc_w'] == 1:
--  var2read.append('w')	
--  var2interpol.append('w')
--  time = f('w').getTime()
--  nb_f=nb_f+1
--if attributes['forc_geo'] == 1:
--  var2read.append('ug')	
--  var2interpol.append('ug')
--  var2read.append('vg')	
--  var2interpol.append('vg')
--  time = f('ug').getTime()
--  nb_f=nb_f+2
--
--if attributes['surfaceForcing'] == "surfaceFlux" :
--  var2read.append('sfc_sens_flx')	
--  var2read.append('sfc_lat_flx')	
--  time_sfc = f('sfc_lat_flx').getAxis(0)
--  nt_sfc = time_sfc.shape[0]
--  nb_fs=nb_fs+2
--
--if attributes['ustar'] > 0. :
--  nb_fs=nb_fs+1
--
--if attributes['nudging_u'] > 0.:
--  var2read.append('u')
--  var2interpol.append('u')
--  nb_f=nb_f+1
--
--if attributes['nudging_v'] > 0.:
--  var2read.append('v')
--  var2interpol.append('v')
--  nb_f=nb_f+1
--
--if attributes['nudging_t'] > 0.:
--  var2read.append('temp')
--  var2interpol.append('temp')
--  time = f('temp').getTime()
--  nb_f=nb_f+1
--
--if attributes['nudging_q'] > 0.:
--  var2read.append('qv')
--  var2interpol.append('qv')
--  nb_f=nb_f+1
--
--var2read = set(var2read)
--var2interpol = set(var2interpol)
--
--print 'var2read =', var2read
--print 'var2interpol =', var2interpol
--
--for var in var2read:
--  data_in[var] = f(var,squeeze=1)	
--#  data_in[var] = f(var)
--
--#time = f('omega').getTime()
--#f.close()
--
--#if len(data_in['w']).shape) == 1:
--#time = f('w').getTime()	
--#else:
--#  time = data_in['w'].getTime()
--nt = time.shape[0]
--lev_in = data_in['pressure'].getLevel()
--nlev_in = lev_in.shape[0]
--
--if attributes['trad'] == 1:
--  if attributes['tadvh'] == 1:	
--    data_in['tadvh'] = data_in['tadvh'] + data_in['trad']
--
--pres = data_in['pressure']
--if len(data_in['pressure'].shape) == 1:
--  pres = MV2.zeros((nt,nlev_in),typecode=MV2.float)
--  for it in range(0,nt):
--    pres[it,:] = data_in['pressure'][:]	 
--  pres0  = MV2.zeros((1,nlev_in),typecode=MV2.float)
--  pres0[0,:] = data_in['pressure'][:]
--
--#---------------------------------------------------------------
--# Calcul des niveaux pressions aux interfaces
--#---------------------------------------------------------------
--
--vah = MV2.zeros((nlev_out+1),typecode=MV2.float32)
--vbh = MV2.zeros((nlev_out+1),typecode=MV2.float32)
--
--f = open('L' + str(nlev_out) + '.dta')
--
--for ilev in range(0,nlev_out+1):
--  line = f.readline().split()
--  vah[ilev] = float(line[0])
--  vbh[ilev] = float(line[1])
--
--f.close()
--
--ppf = MV2.zeros((nt,nlev_out+1),typecode=MV2.float32)
--
--for ilev in range(0,nlev_out+1):
--  if data_in['ps'].shape is (): #nt == 1:
--    ppf[:,ilev] = vah[ilev] + vbh[ilev]*data_in['ps']	  
--  else:
--    ppf[:,ilev] = vah[ilev] + vbh[ilev]*data_in['ps'][:]
--
--#---------------------------------------------------------------
--# Calcul des niveaux pressions au milieu des couches
--#---------------------------------------------------------------
--
--pph = MV2.zeros((nt,nlev_out),typecode=MV2.float32)
--pph0 = MV2.zeros((1,nlev_out),typecode=MV2.float32)
--
--ppf = MV2.where(ppf < 0.1,0.1,ppf)
--
--for ilev in range(0,nlev_out):
--  pph[:,ilev] = (ppf[:,ilev+1]*MV2.log(ppf[:,ilev+1])-ppf[:,ilev]*MV2.log(ppf[:,ilev]))/(ppf[:,ilev+1]-ppf[:,ilev]) - 1.
--  pph0[0,ilev] = (ppf[0,ilev+1]*MV2.log(ppf[0,ilev+1])-ppf[0,ilev]*MV2.log(ppf[0,ilev]))/(ppf[0,ilev+1]-ppf[0,ilev]) - 1.
--
--pph = MV2.exp(pph)	  
--pph0 = MV2.exp(pph0)
--
--#---------------------------------------------------------------
--# Interpolation verticale vers les niveaux modeles (pph)
--#---------------------------------------------------------------
--
--data_out = {}
--missing = {}
--for var in var2interpol:
--  if len(data_in[var].shape) == 2 :
--    data_out[var],missing[var] = interpvertp.interpvertp(pres,pph,data_in[var])
--  else:
--    tmp = data_in[var].reshape((1,nlev_in))
--    data_out[var],missing[var] = interpvertp.interpvertp(pres0,pph0,tmp)
--
--#---------------------------------------------------------------
--# Ecriture du fichier pour etat initial ARPEGE
--#---------------------------------------------------------------
--
--if lnam1D:
--
--  g = open('nam1D_L' + str(nlev_out),'w')
--
--  print >>g, '&NAM1D'
--  print >>g, '  LMAP    = .FALSE.,'
--  print >>g, '  IFLEV   = ' + str(int(nlev_out)) + ','
--  print >>g, '  ZDELY   = 250000.,'
--  print >>g, '  LNHDYN  = .FALSE.,'
--  print >>g, '  LALAPHYS= .TRUE.,'
--  print >>g, '  LREASUR = .TRUE.,'
--  print >>g, '  NFORC   ='+str(int(nb_f*nt))+ ','  
--  print >>g, '  NFORCS  ='+str(int(nb_fs*nt_sfc))+ ','  
--  print >>g, '  LQCGRP  = .FALSE.,'
--  print >>g, '  LQIGRP  = .FALSE.,'
--  print >>g, '  LQRGRP  = .FALSE.,'
--  print >>g, '  LQSGRP  = .FALSE.,'
--  print >>g, '  LQGGRP  = .FALSE.,'
--  print >>g, '  LCFGRP  = .FALSE.,'
--  print >>g, '  LSRCGRP = .FALSE.,'
--  print >>g, '  LTKEGRP = .FALSE.,'
--  print >>g, '  IYEAR   = ' + str(int(year)) + ','
--  print >>g, '  IMONTH  = ' + str(int(month)) + ','
--  print >>g, '  IDAY    = ' + str(int(day)) + ','
--  print >>g, '  IHH     = ' + str(int(hour)) + ','
--  print >>g, '  IMIN    = ' + str(int(minute)) + ','
--  print >>g, '/'
--
--  print >>g, 'ETA'
--
--  print >>g, 'vah'
--  for ilev in range(0,nlev_out+1):
--    print >>g, vah[ilev]	
--
--  print >>g, 'vbh'
--  for ilev in range(0,nlev_out+1):
--    print >>g, vbh[ilev]	
--
--  print >>g, 'ATMOSPHERE'
--  print >>g, 'zorog'
--  print >>g, zorog
--  print >>g, 'ps (Pa)'
--  if data_in['ps'].shape is ():
--    tmp=MV2.log(data_in['ps']  )
--  else:	  
--    tmp=MV2.log(data_in['ps'][0])
--  print >>g, tmp
--
--  print >>g, 'U'
--  for ilev in range(0,nlev_out):
--    print >>g, data_out['u'][0,ilev]
--
--  print >>g, 'V'
--  for ilev in range(0,nlev_out):
--    print >>g, data_out['v'][0,ilev]
--
--  print >>g, 'T'
--  for ilev in range(0,nlev_out):
--    print >>g, data_out['temp'][0,ilev]
--
--  print >>g, 'QV'
--  for ilev in range(0,nlev_out):
--    print >>g, max(0.,data_out['qv'][0,ilev])
--
--  print >>g, ' FORCING'
--  if nt == 1:
--    dt = 0.
--  else:  
--    dt = time[1]-time[0]
--  if attributes['tadv'] == 1:
--    for it in range(0,nt): 
--      print >>g,' T ADV ',int(it*dt) ,'s'
--      for ilev in range(0,nlev_out):
--        print >>g, data_out['tadv'][it,ilev]
--  elif attributes['tadvh'] == 1:
--    for it in range(0,nt): 
--      print >>g,' T ADV ',int(it*dt) ,'s'
--      for ilev in range(0,nlev_out):
--        print >>g, data_out['tadvh'][it,ilev]
--  if attributes['qadv'] == 1:
--    for it in range(0,nt): 
--      print >>g,' Qv ADV ',int(it*dt) ,'s'
--      for ilev in range(0,nlev_out):
--        print >>g, data_out['qadv'][it,ilev]	
--  elif attributes['qadvh'] == 1:
--    for it in range(0,nt): 
--      print >>g,' Qv ADV ',int(it*dt) ,'s'
--      for ilev in range(0,nlev_out):
--        print >>g, data_out['qadvh'][it,ilev]	        
--  if attributes['forc_geo'] == 1:
--    for it in range(0,nt): 
--      print >>g,' PFUG ',int(it*dt) ,'s'
--      for ilev in range(0,nlev_out):
--        print >>g, data_out['ug'][it,ilev]
--    for it in range(0,nt): 
--      print >>g,' PFVG ',int(it*dt),'s'
--      for ilev in range(0,nlev_out):
--        print >>g, data_out['vg'][it,ilev]
--  if attributes['forc_w'] == 1:
--    for it in range(0,nt): 
--      print >>g,' W ',int(it*dt),'s'
--      for ilev in range(0,nlev_out):
--        print >>g, data_out['w'][it,ilev]
--  if attributes['surfaceForcing'] == "surfaceFlux" :
--    print >>g, 'SURF.FORC'
--    for it in range(0,nt_sfc):
--      print >>g, 'FCS'
--      print >>g, data_in['sfc_sens_flx'][it]
--    for it in range(0,nt_sfc):
--      print >>g, 'FLE'
--      print >>g, data_in['sfc_lat_flx'][it]
--  if attributes['ustar'] >0. :
--    for it in range(0,nt_sfc):
--      print >>g, 'USTAR'
--      print >>g, str(float(attributes['ustar']))
--
--  for var in config.variablesAux.keys():
--    print >>g, var
--    if var == 'SURFZ0.FOIS.G' and attributes['z0']>0. :
--        print >>g, str(9.80665*float(attributes['z0']))
--    elif var == 'SURFGZ0.THERM'  and attributes['z0']>0. :
--        print >>g, str(9.80665*float(attributes['z0'])/10.)
--    else:
--        print >>g, ' ' + str(config.variablesAux[var])
--
--  print >>g, 'STOP'
--
--#  os.system('cp nam1D_L' + str(nlev_out) + ' nam1D')
--#  os.system(ASCII2FA + ' > ascii2fa_' + str(nlev_out) + '.log 2>&1')
--#  os.system('rm -f nam1D')
--#  os.system('mv 1D.file initfile_L' + str(nlev_out))
--
--
--  g.close()
--
--  g = cdms2.open('init_L'+ str(nlev_out) + '.nc','w')
--  levAxis = pph[0,:] #/100.
--  levAxis = cdms2.createAxis(levAxis)
--  levAxis.designateLevel()
--  levAxis.id = 'level'
--  levAxis.units = 'Pa'
--  ntAxis = time_sfc[:]
--  ntAxis = cdms2.createAxis(ntAxis)
--  ntAxis.designateLevel()
--  ntAxis.id = 'time'
--  ntAxis.units = 's'
--
--  for var in ['u','v','temp','qv']:
--    tmp = MV2.array(data_out[var][0,:],typecode=MV2.float32)
--    tmp.setAxis(0,levAxis)
--    tmp.id = var
--    g.write(tmp)
--
--  for var in ['sfc_sens_flx','sfc_lat_flx']:
--    tmp = MV2.array(data_in[var][:],typecode=MV2.float32)
--    tmp.setAxis(0,ntAxis)
--    tmp.id = var
--    g.write(tmp)
--  #
--  g.close()
--
-diff --git a/UTIL/Init_Forc/AROME46t1/prepare_profile.sh b/UTIL/Init_Forc/AROME46t1/prepare_profile.sh
-deleted file mode 100755
-index 2f8eb47..0000000
---- a/UTIL/Init_Forc/AROME46t1/prepare_profile.sh
-+++ /dev/null
-@@ -1,82 +0,0 @@
--#!/bin/sh
--
--cat << EOF > tmp.py
--import os
--
--g = open('tmp.sh','w')
--print >> g, '#!/bin/sh'
--print >> g, "export ASCII2FA=" + os.getenv('REP_EMS') + "/UTIL/Tools/ASCII2FA_GMAP/bin/ascii2fa"
--g.close()
--EOF
--
--
--cdat tmp.py
--chmod u+x tmp.sh
--. ./tmp.sh
--
--rm -f tmp.py tmp.sh
--
--cat << EOF > config.py
--
--#zorog = 0.
--
--nlev = $1
--
--
--lforc = True
--lnam1D = True
--
--variablesAux = {}
--variablesAux['SURFAEROS.SEA']=6.2E-3
--variablesAux['SURFAEROS.LAND']=2.2E-2
--variablesAux['SURFAEROS.SOOT']=1.53E-3
--variablesAux['SURFAEROS.DESERT']=2.6E-2
--variablesAux['SURFA.OF.OZONE']=7.1E-2
--variablesAux['SURFB.OF.OZONE']=3166.
--variablesAux['SURFC.OF.OZONE']=3.
--variablesAux['SURFTEMPERATURE']=292.
--variablesAux['SURFRESERV.NEIGE']=0.     
--variablesAux['SURFRESERV.EAU']=10.      
--variablesAux['SURFZ0.FOIS.G']=0.1
--variablesAux['SURFALBEDO']=0.07      
--variablesAux['SURFEMISSIVITE']=0.98          
--variablesAux['SURFET.GEOPOTENT']=0.0
--variablesAux['SURFVAR.GEOP.ANI']=0.0
--variablesAux['SURFVAR.GEOP.DIR']=0.0
--variablesAux['SURFIND.TERREMER']=0.0
--variablesAux['PROFTEMPERATURE']=292.
--variablesAux['PROFRESERV.EAU']=8000.0   
--variablesAux['PROFRESERV.GLACE']=0.0
--variablesAux['SURFRESERV.INTER']=0.0
--variablesAux['SURFRESERV.GLACE']=0.0 
--variablesAux['SURFIND.VEG.DOMI']=1.0  
--variablesAux['SURFRESI.STO.MIN']=50.
--variablesAux['SURFPROP.ARGILE']=3.944         
--variablesAux['SURFPROP.SABLE']=85.09        
--variablesAux['SURFEPAIS.SOL']=8.0
--variablesAux['SURFIND.FOLIAIRE']=1.0
--variablesAux['SURFRES.EVAPOTRA']=1.
--variablesAux['SURFGZ0.THERM']=0.1
--variablesAux['SURFPROP.VEGETAT']=0.
--variablesAux['SURFALBEDO NEIGE']=0.65
--variablesAux['SURFDENSIT.NEIGE']=0.30
--variablesAux['SURFALBEDO.SOLNU']=0.75
--variablesAux['SURFALBEDO.VEG']=0.1
--variablesAux['SURFALBEDO.COMPL']=0.1
--variablesAux['SURFZ0REL.FOIS.G']=0.1
--
--EOF
--
--
--cdat prepare_nam1D.py
--
--cp nam1D_L$1 nam1D
--
--$ASCII2FA > ascii2fa_$1.log 2>&1
--
--rm -f nam1D
--
--mv 1D.file initfile_L$1
--
--
--
-diff --git a/UTIL/Init_Forc/ARPCLIMAT/L191.dta b/UTIL/Init_Forc/ARPCLIMAT/L191.dta
-index 1ba7f36..76ead82 120000
---- a/UTIL/Init_Forc/ARPCLIMAT/L191.dta
-+++ b/UTIL/Init_Forc/ARPCLIMAT/L191.dta
-@@ -1 +1 @@
--../../../CASES/FIRE/L191.dta
-\ No newline at end of file
-+/Users/romainroehrig/Tools/EMS/CASES/FIRE/L191.dta
-\ No newline at end of file
-diff --git a/UTIL/Init_Forc/ARPCLIMAT/interpvertp.so b/UTIL/Init_Forc/ARPCLIMAT/interpvertp.so
-index 6ba9413..f83c6d1 100755
-Binary files a/UTIL/Init_Forc/ARPCLIMAT/interpvertp.so and b/UTIL/Init_Forc/ARPCLIMAT/interpvertp.so differ
-diff --git a/UTIL/Init_Forc/ARPCLIMAT/prepare_nam1D.py b/UTIL/Init_Forc/ARPCLIMAT/prepare_nam1D.py
-index 4782761..459b461 100644
---- a/UTIL/Init_Forc/ARPCLIMAT/prepare_nam1D.py
-+++ b/UTIL/Init_Forc/ARPCLIMAT/prepare_nam1D.py
-@@ -21,8 +21,8 @@ dirout = 'files_L' + str(nlev_out) + '_' + str(int(config.dt)) + 's/'
- # Lecture des donnees d'entree
- #---------------------------------------------------------------
- 
--var2read = ['pressure','temp','qv','u','v','ps']
--var2interpol = ['temp','qv','u','v','theta']
-+var2read = ['pressure','temp','qv','ql','qi','tke','u','v','ps']
-+var2interpol = ['temp','qv','ql','qi','tke','u','v','theta']
- 
- data_in = {}
- 
-@@ -132,7 +132,10 @@ print 'var2read =', var2read
- print 'var2interpol =', var2interpol
- 
- for var in var2read:
--  data_in[var] = f(var,squeeze=1)	
-+    if var in f.listvariables():
-+        data_in[var] = f(var,squeeze=1)	
-+    else:
-+        data_in[var] = f('temp',squeeze=1)*0.
- #  data_in[var] = f(var)
- 
- 
-@@ -183,6 +186,9 @@ if len(data_in['pressure'].shape) == 1:
-     pres[it,:] = data_in['pressure'][:]	 
-   pres0  = MV2.zeros((1,nlev_in),typecode=MV2.float)
-   pres0[0,:] = data_in['pressure'][:]
-+else:
-+  pres0 = MV2.zeros((1,nlev_in),typecode=MV2.float)
-+  pres0[0,:] = data_in['pressure'][0,:]
- 
- #---------------------------------------------------------------
- # Calcul des niveaux pressions aux interfaces
-@@ -255,14 +261,14 @@ if lnam1D:
-   print >>g, '  LALAPHYS= .TRUE.,'
-   print >>g, '  LREASUR = .TRUE.,'
-   print >>g, '  NFORC   = 0,'
--  print >>g, '  LQCGRP  = .FALSE.,'
--  print >>g, '  LQIGRP  = .FALSE.,'
-+  print >>g, '  LQCGRP  = .TRUE.,'
-+  print >>g, '  LQIGRP  = .TRUE.,'
-   print >>g, '  LQRGRP  = .FALSE.,'
-   print >>g, '  LQSGRP  = .FALSE.,'
-   print >>g, '  LQGGRP  = .FALSE.,'
-   print >>g, '  LCFGRP  = .FALSE.,'
-   print >>g, '  LSRCGRP = .FALSE.,'
--  print >>g, '  LTKEGRP = .FALSE.,'
-+  print >>g, '  LTKEGRP = .TRUE.,'
-   print >>g, '  IYEAR   = ' + str(int(year)) + ','
-   print >>g, '  IMONTH  = ' + str(int(month)) + ','
-   print >>g, '  IDAY    = ' + str(int(day)) + ','
-@@ -311,6 +317,19 @@ if lnam1D:
-   for ilev in range(0,nlev_out):
-     print >>g, max(0.,data_out['qv'][0,ilev])
- 
-+  print >>g, 'CLOUD_WATER'
-+  for ilev in range(0,nlev_out):
-+    print >>g, max(0.,data_out['ql'][0,ilev])
-+
-+  print >>g, 'ICE_CRYSTAL'
-+  for ilev in range(0,nlev_out):
-+    print >>g, max(0.,data_out['qi'][0,ilev])
-+
-+  print >>g, 'TKE'
-+  for ilev in range(0,nlev_out):
-+    print >>g, max(0.,data_out['tke'][0,ilev])
-+
-+
-   print >>g, 'FORCING'
- 
-   for var in config.variablesAux.keys():
-diff --git a/UTIL/Init_Forc/ARPCLIMAT/prepare_profile.sh b/UTIL/Init_Forc/ARPCLIMAT/prepare_profile.sh
-index 1c47745..5c4dc61 100755
---- a/UTIL/Init_Forc/ARPCLIMAT/prepare_profile.sh
-+++ b/UTIL/Init_Forc/ARPCLIMAT/prepare_profile.sh
-@@ -1,10 +1,14 @@
- #!/bin/sh
- 
-+source activate myuvcdat
-+alias cdat='python'
-+
- cat << EOF > tmp.py
- import os
- 
- g = open('tmp.sh','w')
- print >> g, '#!/bin/sh'
-+print >> g, 'export OMP_NUM_THREADS=1'
- print >> g, "export ASCII2FA=" + os.getenv('REP_EMS') + "/UTIL/Tools/ASCII2FA/bin/ascii2fa"
- g.close()
- EOF
-diff --git a/UTIL/Init_Forc/ARPPNT/L91.dta b/UTIL/Init_Forc/ARPPNT/L91.dta
-deleted file mode 100644
-index c973e78..0000000
---- a/UTIL/Init_Forc/ARPPNT/L91.dta
-+++ /dev/null
-@@ -1,92 +0,0 @@
--0.0 0.0
--2.00004 0.0
--3.980832 0.0
--7.387186 0.0
--12.908319 0.0
--21.413612 0.0
--33.952858 0.0
--51.746601 0.0
--76.167656 0.0
--108.715561 0.0
--150.986023 0.0
--204.637451 0.0
--271.356506 0.0
--352.824493 0.0
--450.685791 0.0
--566.519226 0.0
--701.813354 0.0
--857.945801 0.0
--1036.166504 0.0
--1237.585449 0.0
--1463.16394 0.0
--1713.709595 0.0
--1989.87439 0.0
--2292.155518 0.0
--2620.898438 0.0
--2976.302246 0.0
--3358.425781 0.0
--3767.196045 0.0
--4202.416504 0.0
--4663.776367 0.0
--5150.859863 0.0
--5663.15625 0.0
--6199.839355 0.0
--6759.727051 0.0
--7341.469727 2.724e-07
--7942.92627 1.39116e-05
--8564.624023 5.46672e-05
--9208.305664 0.0001313641
--9873.560547 0.0002788848
--10558.881836 0.0005483841
--11262.484375 0.0010001344
--11982.662109 0.0017010754
--12713.897461 0.0027647193
--13453.225586 0.0042670486
--14192.009766 0.0063221669
--14922.685547 0.0090349903
--15638.053711 0.0125082629
--16329.560547 0.016859578
--16990.623047 0.0221886449
--17613.28125 0.0286103487
--18191.029297 0.0362269096
--18716.96875 0.0451461338
--19184.544922 0.0554742292
--19587.513672 0.0673161894
--19919.796875 0.0807773024
--20175.394531 0.0959640592
--20348.916016 0.1129790097
--20434.158203 0.1319348216
--20426.21875 0.1529335231
--20319.011719 0.1760910898
--20107.03125 0.20152013
--19785.357422 0.2293148786
--19348.775391 0.2595544755
--18798.822266 0.2919934094
--18141.296875 0.3263293803
--17385.595703 0.3622025847
--16544.585938 0.3992047608
--15633.566406 0.4369063377
--14665.645508 0.4750164151
--13653.219727 0.513279736
--12608.383789 0.551458478
--11543.166992 0.589317143
--10471.310547 0.6265588999
--9405.222656 0.662933588
--8356.25293 0.6982235909
--7335.164551 0.7322238088
--6353.920898 0.7646794915
--5422.802734 0.7953847647
--4550.21582 0.824185431
--3743.464355 0.8509504199
--3010.146973 0.8755183816
--2356.202637 0.8977672458
--1784.854614 0.917650938
--1297.656128 0.9351570606
--895.193542 0.9502738118
--576.314148 0.9630070925
--336.772369 0.9734660387
--162.043427 0.9822381139
--54.208336 0.9891529679
--6.575628 0.9942041636
--0.00316 0.9976301193
--0.0 1.0
-diff --git a/UTIL/Runs/run_AROME46t1.sh b/UTIL/Runs/run_AROME46t1.sh
-deleted file mode 100755
-index 033249d..0000000
---- a/UTIL/Runs/run_AROME46t1.sh
-+++ /dev/null
-@@ -1,239 +0,0 @@
--#!/bin/sh
--
--#------------------------------------------------------------
--# 			INTIALISATION
--#------------------------------------------------------------
--set -x
--
--. ./param
--
--EXP=ARPE
--ADVEC=sli
--
--#       *************************************
--#       * Directories Initialisation        *
--#       *************************************
--
--DIR=`pwd`
--
--OUTPUTDIR=$DIR/Output/LFA/
--OUTPUTDIR0=$DIR/Output/
--
--if [ ! -d $OUTPUTDIR ] ; then
--  mkdir -p $OUTPUTDIR
--fi
--
--TMPDIR=$HOME/tmp/EXEMUSC
--
--if [ ! -d $TMPDIR ] ; then
--  mkdir $TMPDIR
--fi
--
--cd $TMPDIR
--rm -rf $TMPDIR/* || : 
--
--ladate=`date`
--set +x
--echo '------------------------------------------------------------'
--echo 'run execute le ' $ladate
--echo 'cycle =' $cycle 'config = ' $CONFIG
--echo 'Namelist AROME =' $NAMARP
--echo 'Namelist Surfex =' $NAMSFX
--echo 'Executable =' $MASTER
--echo 'Time step =' $TSTEP 'seconds; Run stops at ' $NSTOP
--echo 'Number of levels =' $levels
--echo 'Conditions initiales et forcages =' $INITFILE
--echo 'Conditions pour la surface =' $PREP
--echo 'Dossier des sorties =' $OUTPUTDIR
--echo '------------------------------------------------------------'
--set -x
--#       **********************************
--#       *        Get namelists           *
--#       **********************************
--
--set +x
--echo ''
--echo ' Get the namelist AROME'
--echo ''
--set -x
--
--ln -s $DIR/$NAMARP fort.4
--cat < fort.4
--
--set +x
--echo ''
--echo ' Get the namelist SURFEX'
--echo ''
--set -x
--
--ln -s $DIR/$NAMSFX EXSEG1.nam
--cat < EXSEG1.nam
--
--
--#       **********************************
--#       * Get initial and forcing files  *
--#       **********************************
--
--set +x
--echo ''
--echo ' Get Initial conditions for atmosphere and surface '
--echo ' Get Forcing files '
--echo ''
--set -x
--
--
--ln -s $INITFILE ICMSH${EXP}INIT
--ln -s $FORCING_FILES files
--
--ln -s  $PREP TEST.lfi
--ln -s  $PGD PGD.lfi
--
--
--#       **********************************
--#       *            For SURFEX          *
--#       **********************************
--
--
--ln -s $ecoclimap/ecoclimapII_eu_covers_param.bin ecoclimapII_eu_covers_param.bin
--ln -s $ecoclimap/ecoclimapI_covers_param.bin ecoclimapI_covers_param.bin
--
--#       **********************************
--#       *            Execution           *
--#       **********************************
--
--set +x
--echo ''
--echo ' Get the executable file '
--echo ''
--set -x
--
--ln -s $MASTER MASTER
--chmod 755 MASTER
--
--set +x
--echo ''
--echo ' ALADIN job running '
--echo ''
--set -x
--
--#export DR_HOOK_NOT_MPI=1
--#export DR_HOOK=0
--export DR_HOOK_IGNORE_SIGNALS=-1
--
--ulimit -s unlimited
--
--date
--./MASTER >lola 2>&1
--date
--#rm fort.4
--ls -l
--
--set +x
--echo ''
--echo ' Listing for the not parallelised part: file lola'
--echo ''
--set -x
--
--cat lola
--
--if [ -a NODE.001_01 ]
--then
--  for file in NODE*
--  do
--    set +x
--    echo ''
--    echo ' Listing for the parallelised part: file' $file
--    echo ''
--    set -x
--    cat $file
--  done
--fi
--
--#       **********************************
--#       *     Save model results         *
--#       **********************************
--
--set +x
--echo ''
--echo ' Historic files saving '
--echo ''
--set -x
--
--find $OUTPUTDIR/ -name '*' -exec rm -f {} \;
--find ./ -name 'Out*' -exec mv {} $OUTPUTDIR \;
--find ./ -name 'NODE*' -exec mv {} $OUTPUTDIR \;
--find ./ -name 'lola' -exec mv {} $OUTPUTDIR \;
--
--#rm -f $OUTPUTDIR/*
--#mv Out* NODE* lola $OUTPUTDIR
--
--set +x
--echo ''
--echo ' Present files on the workdir $TMPDIR '
--echo ''
--set -x
--
--ls -l
--
--#       **********************************
--#       *        Nettoyage final         *
--#       *        Final Cleaning          *
--#       **********************************
--
--set +x
--echo ''
--echo ' Final cleaning of the workdir $TMPDIR '
--echo ''
--set -x
--
--set +x
--#rm -rf $TMPDIR/*
--find $TMPDIR/ -name '*' -exec rm -rf {} \;
--set -x
--#       ********************************************
--#       * Copie eventuelle des routines convert2nc *
--#       * Possible copy of convert2nc routines     *
--#       ********************************************
--
--if [ $installpost = True ]
--then
--  cd $OUTPUTDIR0
--  rm -f *.py *.sh *.pyc *.so 
--  set +x
--  echo ''
--  echo ' Install post-processing '
--  echo ''
--  set -x
--
--  files2install='convert2z.so convertp_to_daily.py convertk_to_1hourly.py convertz_to_1hourly.py convert2p.py convertk_to_daily.py convertz_to_daily.py convert2p.so     convertLFA2nc.py lfa2nc_part1.py convert2z.py convertp_to_1hourly.py lfa2nc_part2.py convertp_to_3hourly.py'
--
--  for file in $files2install
--  do
--    ln -s $dirpost/$file
--  done
--  ln -s $dirpost/$configpost config.py
--  ln -s $dirpost/$variablesDict variables.py
--fi
--
--#       ********************************************
--#       * Conversion eventuelle en netcdf          *
--#       * Possible conversion in netcdf            *
--#       ********************************************
--
--if [ $runpost = True ]
--then
--  set +x
--  echo ''
--  echo ' Postprocessing '
--  echo ''
--  set -x
--
--  # seems necessary in some circumstances (deep shells?)
--  unset PYTHONHOME
--  ./convertLFA2nc.py
--
--fi
--
--date
--
--cd $DIR
-diff --git a/UTIL/Runs/run_ARPCLIMAT.sh b/UTIL/Runs/run_ARPCLIMAT.sh
-index 646b1de..8bfac11 100755
---- a/UTIL/Runs/run_ARPCLIMAT.sh
-+++ b/UTIL/Runs/run_ARPCLIMAT.sh
-@@ -3,7 +3,7 @@
- #------------------------------------------------------------
- # 			INTIALISATION
- #------------------------------------------------------------
--set -vx
-+set -x
- 
- . ./param
- 
-@@ -25,12 +25,12 @@ fi
- 
- TMPDIR=$HOME/tmp/EXEMUSC
- 
--rm -rf $TMPDIR
--mkdir $TMPDIR
-+if [ ! -d $TMPDIR ] ; then
-+  mkdir $TMPDIR
-+fi
- 
- cd $TMPDIR
--
--#find $TMPDIR/ -name '*' -exec rm -rf {} \; || :
-+find $TMPDIR -name '*' -exec rm -rf {} \ || :
- #rm -rf $TMPDIR/* || : 
- 
- ladate=`date`
-@@ -117,11 +117,13 @@ echo ' ALADIN job running '
- echo ''
- set -x
- 
-+export OMP_NUM_THREADS=1
-+
- #export DR_HOOK_NOT_MPI=1
- #export DR_HOOK=0
- export DR_HOOK_IGNORE_SIGNALS=-1
- 
--ulimit -s unlimited
-+#ulimit -s unlimited
- 
- date
- ./MASTER -c001 -vmeteo -maladin -e${EXP} -t$TSTEP -f$NSTOP -a$ADVEC  >lola 2>&1
-diff --git a/UTIL/Tools/ASCII2FA/bin/ascii2fa b/UTIL/Tools/ASCII2FA/bin/ascii2fa
-index 61c7d98..df05251 100755
-Binary files a/UTIL/Tools/ASCII2FA/bin/ascii2fa and b/UTIL/Tools/ASCII2FA/bin/ascii2fa differ
-diff --git a/UTIL/Tools/ASCII2FA/src/Makefile b/UTIL/Tools/ASCII2FA/src/Makefile
-index a3df309..ed5e0cf 100755
---- a/UTIL/Tools/ASCII2FA/src/Makefile
-+++ b/UTIL/Tools/ASCII2FA/src/Makefile
-@@ -2,7 +2,7 @@
- 
- FC	 =	gfortran
- FFLAGS	 =      -ff2c -fconvert=big-endian -frecord-marker=4 $(M32) -ffixed-form -fdefault-real-8 -DADDRESS64 -DLITTLE_ENDIAN -DHIGHRES
--F90FLAGS =      -fconvert=big-endian -frecord-marker=4 $(M32) -ffree-form -fdefault-real-8 -DADDRESS64 -DHIGHRES
-+F90FLAGS =      -fconvert=swap -fno-second-underscore -fbacktrace -fopenmp -fno-sign-zero -fpic -ffree-line-length-none -m64 -ffree-form  -DLINUX -DLITTLE_ENDIAN -DLITTLE -DDARWIN -DADDRESS64 -fdefault-real-8 -fdefault-double-8 -g -O2
- EXEC	 =	acadfa_exe
- 
- OBJS	 =	acadfa1D_main.o \
-@@ -10,10 +10,11 @@ OBJS	 =	acadfa1D_main.o \
- 		real2spec.o \
- 		empty.o 
- 
--XRD	 =	libxrd.a 
--GRIBEX   =      libgribex.a 
--MPIDUMMY =      libmpidummy.a
--LIBS	 =	$(XRD) $(GRIBEX) $(MPIDUMMY)
-+XRD	 =	/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/lib/libxrd.local.a 
-+XLA	 =	/Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/lib/libxla.local.a 
-+GRIBEX   =      /Users/romainroehrig/libraries/auxlibs/GNU/auxlibs/lib/libgribex.a 
-+MPIDUMMY =      /Users/romainroehrig/libraries/auxlibs/GNU/auxlibs/lib/libmpidummy.a
-+LIBS	 =	$(XRD) $(XLA) $(GRIBEX) $(MPIDUMMY) 
- 
- %.o:%.F90
- 	$(FC) $(F90FLAGS) -c $<
-diff --git a/UTIL/Tools/ASCII2FA/src/acadfa1D_main.F90 b/UTIL/Tools/ASCII2FA/src/acadfa1D_main.F90
-index 2ab6200..99e4f92 100644
---- a/UTIL/Tools/ASCII2FA/src/acadfa1D_main.F90
-+++ b/UTIL/Tools/ASCII2FA/src/acadfa1D_main.F90
-@@ -135,7 +135,7 @@
- 
- 
-       CHARACTER CLMCA*16, CLFILEOUT*40
--      CHARACTER CBLOCK*10, YRECFM*7
-+      CHARACTER CBLOCK*16, YRECFM*7
-       CHARACTER CHAMP*16
- 
-       ! allocatable arrays
-@@ -256,8 +256,8 @@
-       READ(10,*) CBLOCK
- 
-       IF (CBLOCK.NE.'ETA') THEN
--         print*,'problem : ETA (A and B functions) is not present'
--         STOP
-+        print*,'problem : ETA (A and B functions) is not present'
-+        STOP
-       ENDIF
- 
-       ! 3.2 Read vertical coefficients A,B
-@@ -266,13 +266,13 @@
-       ALLOCATE(ZVBH (0:IFLEV))
-       READ(10,*)CBLOCK
-       DO JLEV = 0,IFLEV
--       READ(10,*)ZVALH(JLEV)
--       ZVALH(JLEV) = ZVALH(JLEV) / ZP00
-+        READ(10,*)ZVALH(JLEV)
-+        ZVALH(JLEV) = ZVALH(JLEV) / ZP00
-         WRITE(6,*)'JLEV ZVALH=',JLEV,ZVALH(JLEV)
-       ENDDO
-       READ(10,*)CBLOCK
-       DO JLEV = 0,IFLEV
--       READ(10,*)ZVBH (JLEV)
-+        READ(10,*)ZVBH (JLEV)
-         WRITE(6,*)'JLEV ZVBH=',JLEV,ZVBH(JLEV)
-       ENDDO
- 
-@@ -337,7 +337,7 @@
- 
- 
-       ! 4.4 Impose no GRIB encoding (no packing)
--                                                                                
-+                                                                        
-       INGRIG = 0
-       CALL FAVEUR(IREP,IUFD,INGRIB,INBPDG,INBCSP, &
-      &  ISTRON,IPUILA,IDMOPL)
-@@ -354,18 +354,6 @@
-       IF (IREP.NE.0) STOP
- 
-       ! 4.3 Initialize the date
--! date pour Eurocs/ARM
--!      IDATE(1)  = 1997
--!      IDATE(2)  = 6
--!      IDATE(3)  = 21
--!      IDATE(4)  = 11
--!      IDATE(5)  = 30 
--!      IDATE(6)  = 1
--!      IDATE(7)  = 0
--!      IDATE(8)  = 0
--!      IDATE(9)  = 0
--!      IDATE(10) = 0
--!      IDATE(11) = 0
- 
-       IDATE(1)  = IYEAR
-       IDATE(2)  = IMONTH
-@@ -382,15 +370,6 @@
-       CALL FANDAR(IREP,IUFD,IDATE)
-       IF (IREP.NE.0) STOP
-       
--      ! 4.4 Impose no GRIB encoding (no packing)
--          
--!      INGRIG = 0
--!      CALL FAVEUR(IREP,IUFD,INGRIB,INBPDG,INBCSP,
--!     &  ISTRON,IPUILA,IDMOPL)
--!      CALL FAGOTE(IREP,IUFD,INGRIG,INBPDG,INBCSP,
--!     &  ISTRON,IPUILA,IDMOPL)
--
--
-       ! ----------------------------
-       ! 5. Write data for ATMOSPHERE
-       ! ----------------------------
-@@ -398,8 +377,8 @@
-       READ(10,*) CBLOCK
- 
-       IF (CBLOCK.NE.'ATMOSPHERE') THEN
--         print*,'problem : the block ATMOSPHERE is not present'
--         STOP
-+        print*,'problem : the block ATMOSPHERE is not present'
-+        STOP
-       ENDIF
- 
-       !  Preparation for GP fields
-@@ -416,7 +395,7 @@
-       READ(10,*)
-       READ(10,*)ZOROG
-       DO J = 1,IDGL
--      ZOUT (J) = ZOROG*ZG
-+        ZOUT (J) = ZOROG*ZG
-       ENDDO
- 
-       CALL FAIENC(IREP,IUFD,'SURF',1,'GEOPOTENTIEL',ZOUT,LLCOSP)
-@@ -446,11 +425,19 @@
-       DO J = 1,IDGL
-         ZFFT(J) = ZOROG*ZG
-       ENDDO
-+
-+      !WRITE(6,*)'IDGL=',idgl
-+      !WRITE(6,*)'NSEFRE=',NSEFRE
-+      !WRITE(6,*)'INSMAX=',INSMAX
-+      !WRITE(6,*)'TRIGS=',TRIGS
-+      !WRITE(6,*)'IFAX=',IFAX
-+      !WRITE(6,*)'ZFFT=',ZFFT
-     
--       call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-+      call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
- 
--      WRITE(6,*)'GEOP=',ZFFT(1)
--      WRITE(6,*)'ZOUT=',ZOUT
-+      !WRITE(6,*)'GEOP=',ZFFT(1)
-+      !WRITE(6,*)'ZFFT=',ZFFT
-+      !WRITE(6,*)'ZOUT=',ZOUT
-       CALL FAIENC (IREP,IUFD,'SPECSURF',1,'GEOPOTEN',ZOUT,LLCOSP)
- 
-       ! 5.3 Spectral Surface Pressure
-@@ -461,9 +448,10 @@
-         ZFFT(J) = ZSPT0
-       ENDDO
-         
--       call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
--      WRITE(6,*)'Ps=',ZFFT(1)
--      WRITE(6,*)'ZOUT=',ZOUT
-+      call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-+      !WRITE(6,*)'Ps=',ZFFT(1)
-+      !WRITE(6,*)'Ps=',ZFFT
-+      !WRITE(6,*)'ZOUT=',ZOUT
-       CALL FAIENC(IREP,IUFD,'SURF',1,'PRESSION',ZOUT,LLCOSP)
- 
-       !
-@@ -472,16 +460,16 @@
-       READ(10,*)
- !
-       DO JLEV =1, IFLEV
--         READ(10,*) ZU 
--         DO J = 1,IDGL
--            ZFFT(J) = ZU
--         ENDDO
--         WRITE (6,*)'JLEV UWIND',JLEV,ZFFT(1)
-+        READ(10,*) ZU 
-+        DO J = 1,IDGL
-+          ZFFT(J) = ZU
-+        ENDDO
-+        WRITE (6,*)'JLEV UWIND',JLEV,ZFFT(1)
-     
-         call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-      
--         CALL FAIENC (IREP,IUFD,'S',JLEV,'WIND.U.PHYS',ZOUT,LLCOSP)
--      END DO
-+        CALL FAIENC (IREP,IUFD,'S',JLEV,'WIND.U.PHYS',ZOUT,LLCOSP)
-+      ENDDO
-         
-       ! 
-       ! 5.5 Spectral V-Wind
-@@ -489,61 +477,64 @@
-       READ(10,*)
- !
-       DO JLEV =1, IFLEV
--             READ(10,*) ZV 
-+        READ(10,*) ZV 
-         DO J = 1,IDGL
--           ZFFT(J)=ZV 
-+          ZFFT(J)=ZV 
-         ENDDO
-         WRITE (6,*)'JLEV VWIND',JLEV,ZFFT(1)
- 
--         call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-+        call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
- 
-         CALL FAIENC (IREP,IUFD,'S',JLEV,'WIND.V.PHYS',ZOUT,LLCOSP)
--      END DO
-+      ENDDO
- 
-       !
-       ! 5.6 Spectral Temperature
-       !
-       READ(10,*)
--!
-+      !
-       DO JLEV =1, IFLEV
--          READ(10,*)ZT 
-+        READ(10,*)ZT 
-         DO J = 1,IDGL
-           ZFFT(J)=ZT 
-         ENDDO
-         WRITE(6,*)'JLEV TEMPE',JLEV,ZFFT(1)
--
--         call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
--
-+        !
-+        call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-+        !
-+        !WRITE(6,*) 'JLEV TEMPE ZOUT=',JLEV,ZOUT
-+        !
-         CALL FAIENC (IREP,IUFD,'S',JLEV,'TEMPERATURE',ZOUT,LLCOSP)
--      END DO
-+      ENDDO
- 
- 
-         ! 5.7 NH fields if LNHDYN
- 
-       IF (LNHDYN) THEN
-       !
--         DO JLEV =1, IFLEV
-+        DO JLEV =1, IFLEV
-+          !
-           ! Pressure Departure
-           !      
--            DO J = 1,IDGL
--               ZFFT(J) = 0.0
--            ENDDO
--
--           call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
--	
--            CALL FAIENC (IREP,IUFD,'S',JLEV,'PRESS.DEPARTURE',ZOUT,LLCOSP)
--     
-+          DO J = 1,IDGL
-+            ZFFT(J) = 0.0
-+          ENDDO
-+          !
-+          call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-+          !
-+          CALL FAIENC (IREP,IUFD,'S',JLEV,'PRESS.DEPARTURE',ZOUT,LLCOSP)
-+          !
-           ! Vertical divergence
-           !
--            DO J = 1,IDGL
--               ZFFT(J) = 0.0
--            ENDDO
--        
--           call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
--   	
--            CALL FAIENC (IREP,IUFD,'S',JLEV,'VERTIC.DIVERGENC',ZOUT,LLCOSP)
--
--         END DO
-+          DO J = 1,IDGL
-+            ZFFT(J) = 0.0
-+          ENDDO
-+          ! 
-+          call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-+          !
-+          CALL FAIENC (IREP,IUFD,'S',JLEV,'VERTIC.DIVERGENC',ZOUT,LLCOSP)
-+          !
-+        ENDDO
-       ENDIF
-       ! Finish 3D-spectral data
- 
-@@ -552,210 +543,274 @@
-       !
-       ! 5.7 Grid point or Spectral Humidity
-       !
--
--print*,'LQVGRP=',LQVGRP
--print*,'LSPRT=',LSPRT
--!IF(LQVGRP) THEN
--
--
--   IF ( LSPRT ) THEN
--      ! Grid point specific humidity
--      LLCOSP = .FALSE.      
--      ALLOCATE(ZOUT (IDGL))
--      ZOUT(:) = 0.
--
--      READ(10,*)
--      DO JLEV=1,IFLEV
--         READ(10,*) ZQ
--         DO J = 1,IDGL
-+      print*,'LQVGRP=',LQVGRP
-+      print*,'LSPRT=',LSPRT
-+      !IF(LQVGRP) THEN
-+      !
-+      IF ( LSPRT ) THEN
-+        ! Grid point specific humidity
-+        LLCOSP = .FALSE.      
-+        ALLOCATE(ZOUT (IDGL))
-+        ZOUT(:) = 0.
-+        !
-+        READ(10,*)
-+        DO JLEV=1,IFLEV
-+          READ(10,*) ZQ
-+          DO J = 1,IDGL
-             ZOUT(J)=ZQ
--         ENDDO
--         WRITE (6,*)' JLEV HUMI',JLEV,ZOUT(1)
--         CALL FAIENC (IREP,IUFD,'S',JLEV,'HUMI.SPECIFI',ZOUT,LLCOSP)
--      ENDDO
--      DEALLOCATE (ZOUT) 
--   ELSEIF (.NOT. LSPRT) THEN
--      !
--      ! 5.6 Spectral Humidity
--      !
--print*,'QV en spectral'
-- WRITE(6,*)' Q_v en spectral'
--      ALLOCATE(ZOUT (NSEFRE))
--      ALLOCATE(ZFFT (IDGL)  )
--      ALLOCATE(ZWORK(IDGL+1))
--      
--      LLCOSP =.TRUE.  
--
--      READ(10,*)
--!
--      DO JLEV =1, IFLEV
-+          ENDDO
-+          WRITE (6,*)' JLEV HUMI',JLEV,ZOUT(1)
-+          !WRITE (6,*)' JLEV HUMI',JLEV,ZOUT
-+          CALL FAIENC (IREP,IUFD,'S',JLEV,'HUMI.SPECIFI',ZOUT,LLCOSP)
-+        ENDDO
-+        DEALLOCATE (ZOUT) 
-+      ELSEIF (.NOT. LSPRT) THEN
-+        !
-+        ! 5.6 Spectral Humidity
-+        !
-+        print*,'QV en spectral'
-+        WRITE(6,*)' Q_v en spectral'
-+        ALLOCATE(ZOUT (NSEFRE))
-+        ALLOCATE(ZFFT (IDGL)  )
-+        ALLOCATE(ZWORK(IDGL+1))
-+        !
-+        LLCOSP =.TRUE.  
-+        !
-+        READ(10,*)
-+        !
-+        DO JLEV =1, IFLEV
-           READ(10,*)ZQ
--        DO J = 1,IDGL
--          ZFFT(J)=ZQ
-+          DO J = 1,IDGL
-+            ZFFT(J)=ZQ
-+          ENDDO
-+          WRITE(6,*)'JLEV HUMI',JLEV,ZFFT(1)
-+          ! 
-+          call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
-+          !
-+          !WRITE(6,*) 'JLEV QV ZOUT=',JLEV,ZOUT 
-+          !
-+          CALL FAIENC (IREP,IUFD,'S',JLEV,'HUMI.SPECIFI',ZOUT,LLCOSP)
-         ENDDO
--        WRITE(6,*)'JLEV HUMI',JLEV,ZFFT(1)
--           
--        call real2spec(idgl,nsefre,insmax,trigs, ifax, ZFFT, ZOUT)
--
--        CALL FAIENC (IREP,IUFD,'S',JLEV,'HUMI.SPECIFI',ZOUT,LLCOSP)
--      END DO
--
--      DEALLOCATE (ZOUT) 
--      DEALLOCATE (ZFFT)
--      DEALLOCATE (ZWORK) 
--   ENDIF
--
--!ENDIF
--
-+        !
-+        DEALLOCATE (ZOUT) 
-+        DEALLOCATE (ZFFT)
-+        DEALLOCATE (ZWORK) 
-+      ENDIF
-+      !
-+      !ENDIF
-+      !
-       !
-       ! 5.8 Grid point specific cloud content
-       !
-       IF(LQCGRP) THEN 
--         LLCOSP = .FALSE.      
--         ALLOCATE(ZOUT (IDGL))
--         ZOUT(:) = 0.
--         READ(10,*)
--
--        DO JLEV=1,IFLEV
--          READ(10,*) ZQ
--          DO J = 1,IDGL
--            ZOUT(J)=ZQ
--          ENDDO
--          WRITE (6,*)' JLEV QL',JLEV,ZOUT(1)
--          CALL FAIENC (IREP,IUFD,'S',JLEV,'CLOUD_WATER',ZOUT,LLCOSP)
--          CALL FAIENC (IREP,IUFD,'S',JLEV,'LIQUID_WATER',ZOUT,LLCOSP)
--        ENDDO 
--        DEALLOCATE (ZOUT) 
-+        !
-+        READ(10,*) CBLOCK
-+        print*,'CBLOCK=',CBLOCK
-+        !
-+        IF (CBLOCK.NE.'CLOUD_WATER') THEN
-+          print*,&
-+         & 'the block CLOUD_WATER is not present while it is expected'
-+          STOP
-+        ELSE
-+          LLCOSP = .FALSE.      
-+          ALLOCATE(ZOUT (IDGL))
-+          ZOUT(:) = 0.                
-+          DO JLEV=1,IFLEV
-+            READ(10,*) ZQ
-+            DO J = 1,IDGL
-+              ZOUT(J)=ZQ
-+            ENDDO
-+            WRITE (6,*)' JLEV CLOUD_WATER',JLEV,ZOUT(1)
-+            CALL FAIENC (IREP,IUFD,'S',JLEV,'CLOUD_WATER',ZOUT,LLCOSP)
-+            CALL FAIENC (IREP,IUFD,'S',JLEV,'LIQUID_WATER',ZOUT,LLCOSP)
-+          ENDDO 
-+          DEALLOCATE (ZOUT)        
-+        ENDIF
-       ENDIF
-       !
-       ! 5.9 Grid point specific ice cristal content
-       ! 
-       IF(LQIGRP) THEN
--         LLCOSP = .FALSE.      
--         ALLOCATE(ZOUT (IDGL))
--         ZOUT(:) = 0.
--
--         DO JLEV=1,IFLEV
--          DO J = 1,IDGL
--            ZOUT(J)=0.0
--           ENDDO
--          WRITE (6,*)' JLEV ICE_CRYSTAL',JLEV,ZOUT(1)
--          CALL FAIENC (IREP,IUFD,'S',JLEV,'ICE_CRYSTAL',ZOUT,LLCOSP)
--        ENDDO  
--!
--!for LOPEZ
--!
--         DO JLEV=1,IFLEV
--          DO J = 1,IDGL
--            ZOUT(J)=0.0
--           ENDDO
--          WRITE (6,*)' JLEV SOLID_WATER',JLEV,ZOUT(1)
--          CALL FAIENC (IREP,IUFD,'S',JLEV,'SOLID_WATER',ZOUT,LLCOSP)
--         ENDDO 
--         DEALLOCATE (ZOUT) 
-+        !
-+        READ(10,*) CBLOCK
-+        print*,'CBLOCK=',CBLOCK
-+        !
-+        IF (CBLOCK.NE.'ICE_CRYSTAL') THEN
-+          print*, &
-+         & 'the block ICE_CRYSTAL is not present while it is expected'
-+          STOP
-+        ELSE
-+          LLCOSP = .FALSE.      
-+          ALLOCATE(ZOUT (IDGL))
-+          ZOUT(:) = 0.          
-+          DO JLEV=1,IFLEV
-+            READ(10,*) ZQ
-+            DO J = 1,IDGL
-+              ZOUT(J)=ZQ
-+            ENDDO
-+            WRITE (6,*)' JLEV ICE_CRYSTAL',JLEV,ZOUT(1)
-+            CALL FAIENC (IREP,IUFD,'S',JLEV,'ICE_CRYSTAL',ZOUT,LLCOSP)
-+            CALL FAIENC (IREP,IUFD,'S',JLEV,'SOLID_WATER',ZOUT,LLCOSP)
-+          ENDDO 
-+          DEALLOCATE (ZOUT)           
-+        ENDIF
-       ENDIF 
-       !
-       ! 5.10 Grid point specific rain content
-       !
-       IF(LQRGRP) THEN 
--         LLCOSP = .FALSE.      
--         ALLOCATE(ZOUT (IDGL))
--         ZOUT(:) = 0.
--
--         DO JLEV=1,IFLEV
-+        !
-+        READ(10,*) CBLOCK
-+        print*,'CBLOCK=',CBLOCK
-+        !
-+        IF (CBLOCK.NE.'RAIN') THEN
-+          print*,'the block RAIN is not present while it is expected'
-+          STOP
-+        ELSE
-+          LLCOSP = .FALSE.      
-+          ALLOCATE(ZOUT (IDGL))
-+          ZOUT(:) = 0.
-+          DO JLEV=1,IFLEV
-+            READ(10,*) ZQ          
-             DO J = 1,IDGL
--               ZOUT(J)=0.0
-+              ZOUT(J)=ZQ
-             ENDDO
-             WRITE (6,*)' JLEV RAIN',JLEV,ZOUT(1)
-             CALL FAIENC (IREP,IUFD,'S',JLEV,'RAIN',ZOUT,LLCOSP)
--         ENDDO
--         DEALLOCATE (ZOUT) 
-+          ENDDO
-+          DEALLOCATE (ZOUT)
-+        ENDIF
-       ENDIF
-       !
-       ! 5.11 Grid point specific snow content
-       !
-       IF(LQSGRP) THEN  
--         LLCOSP = .FALSE.      
--         ALLOCATE(ZOUT (IDGL))
--         ZOUT(:) = 0.
--         
--         DO JLEV=1,IFLEV
-+        !
-+        READ(10,*) CBLOCK
-+        print*,'CBLOCK=',CBLOCK
-+        !
-+        IF (CBLOCK.NE.'SNOW') THEN
-+          print*,'the block SNOW is not present while it is expected'
-+          STOP
-+        ELSE   
-+          LLCOSP = .FALSE.      
-+          ALLOCATE(ZOUT (IDGL))
-+          ZOUT(:) = 0.         
-+          DO JLEV=1,IFLEV
-+            READ(10,*) ZQ
-             DO J = 1,IDGL
--               ZOUT(J)=0.0
-+              ZOUT(J)=ZQ
-             ENDDO
-             WRITE (6,*)' JLEV SNOW',JLEV,ZOUT(1)
-             CALL FAIENC (IREP,IUFD,'S',JLEV,'SNOW',ZOUT,LLCOSP)
--         ENDDO
--         DEALLOCATE (ZOUT) 
-+          ENDDO
-+          DEALLOCATE (ZOUT)
-+        ENDIF
-       ENDIF
-       !
-       ! 5.12 Grid point specific graupel content
-       !
-       IF(LQGGRP) THEN 
--         LLCOSP = .FALSE.      
--         ALLOCATE(ZOUT (IDGL))
--         ZOUT(:) = 0.
--         
--         DO JLEV=1,IFLEV
-+        !
-+        READ(10,*) CBLOCK
-+        print*,'CBLOCK=',CBLOCK
-+        !
-+        IF (CBLOCK.NE.'GRAUPEL') THEN
-+          print*,'the block GRAUPEL is not present while it is expected'
-+          STOP
-+        ELSE                 
-+          LLCOSP = .FALSE.      
-+          ALLOCATE(ZOUT (IDGL))
-+          ZOUT(:) = 0.        
-+          DO JLEV=1,IFLEV
-+            READ(10,*) ZQ          
-             DO J = 1,IDGL
--               ZOUT(J)=0.0
-+              ZOUT(J)=ZQ
-             ENDDO
-             WRITE (6,*)' JLEV GRAUPEL',JLEV,ZOUT(1)
-             CALL FAIENC (IREP,IUFD,'S',JLEV,'GRAUPEL',ZOUT,LLCOSP)
--         ENDDO
--         DEALLOCATE (ZOUT) 
-+          ENDDO
-+          DEALLOCATE (ZOUT) 
-+        ENDIF
-       ENDIF
-       !
-       ! 5.13 Grid point cloud fraction
-       !
-       IF(LCFGRP) THEN 
--         LLCOSP = .FALSE.      
--         ALLOCATE(ZOUT (IDGL))
--         ZOUT(:) = 0.
--         
--         DO JLEV=1,IFLEV
-+        !
-+        READ(10,*) CBLOCK
-+        print*,'CBLOCK=',CBLOCK
-+        !
-+        IF (CBLOCK.NE.'CLOUD FRACTION') THEN
-+          print*,&
-+        & 'the block CLOUD FRACTION is not present while it is expected'
-+          STOP
-+        ELSE                 
-+          LLCOSP = .FALSE.      
-+          ALLOCATE(ZOUT (IDGL))
-+          ZOUT(:) = 0.      
-+          DO JLEV=1,IFLEV
-+            READ(10,*) ZQ          
-             DO J = 1,IDGL
--               ZOUT(J)=0.0
-+              ZOUT(J)=ZQ
-             ENDDO
-             WRITE (6,*)' JLEV CLF',JLEV,ZOUT(1)
-             CALL FAIENC (IREP,IUFD,'S',JLEV,' CLOUD FRACTION',ZOUT,LLCOSP)
--         ENDDO
--         DEALLOCATE (ZOUT)
-+          ENDDO
-+          DEALLOCATE (ZOUT)
-+        ENDIF
-       ENDIF
-       !
-       ! 5.14 Grid point SRC
-       !
-       IF(LSRCGRP) THEN 
--         LLCOSP = .FALSE.      
--         ALLOCATE(ZOUT (IDGL))
--         ZOUT(:) = 0.
--         
--         DO JLEV=1,IFLEV
-+        !
-+        READ(10,*) CBLOCK
-+        print*,'CBLOCK=',CBLOCK
-+        !
-+        IF (CBLOCK.NE.'SRC') THEN
-+          print*,'the block SRC is not present while it is expected'
-+          STOP
-+        ELSE                   
-+          LLCOSP = .FALSE.      
-+          ALLOCATE(ZOUT (IDGL))
-+          ZOUT(:) = 0.        
-+          DO JLEV=1,IFLEV
-+            READ(10,*) ZQ           
-             DO J = 1,IDGL
--               ZOUT(J)=0.0
-+              ZOUT(J)=ZQ
-             ENDDO
-             WRITE (6,*)' JLEV SRC',JLEV,ZOUT(1)
-             CALL FAIENC (IREP,IUFD,'S',JLEV,'SRC',ZOUT,LLCOSP)
--         ENDDO
--         DEALLOCATE (ZOUT)
-+          ENDDO
-+          DEALLOCATE (ZOUT)
-+        ENDIF
-       ENDIF
-       !
-       ! 7.15 Grid point TKE 
-       !
-       IF(LTKEGRP) THEN 
--         LLCOSP = .FALSE.      
--         ALLOCATE(ZOUT (IDGL))
--         ZOUT(:) = 0.
--         READ(10,*)
--         DO JLEV=1,IFLEV
--            READ(10,*) ZQ
--            DO J = 1,IDGL
-+         !
-+         READ(10,*) CBLOCK
-+         print*,'CBLOCK=',CBLOCK
-+         !
-+         IF (CBLOCK.NE.'TKE') THEN
-+            print*,'the block TKE is not present'
-+           !
-+         ELSE
-+           LLCOSP = .FALSE.      
-+           ALLOCATE(ZOUT (IDGL))
-+           ZOUT(:) = 0.                 
-+           DO JLEV=1,IFLEV
-+             READ(10,*) ZQ
-+             DO J = 1,IDGL
-                ZOUT(J)=MAX(0.000001,ZQ)
--            ENDDO
--            WRITE (6,*)' JLEV TKE',JLEV,ZOUT(1)
--            CALL FAIENC (IREP,IUFD,'S',JLEV,'TKE',ZOUT,LLCOSP)
--         ENDDO
--         DEALLOCATE (ZOUT)
-+             ENDDO
-+             WRITE (6,*)' JLEV TKE',JLEV,ZOUT(1)
-+             CALL FAIENC (IREP,IUFD,'S',JLEV,'TKE',ZOUT,LLCOSP)
-+           ENDDO
-+           DEALLOCATE (ZOUT)
-+         ENDIF
-       ENDIF
-       !
-       !IF(LOZONE) THEN 
-@@ -773,44 +828,43 @@ print*,'QV en spectral'
-       !   ENDDO
-       !   DEALLOCATE (ZOUT)
-       !ENDIF
--
-+      !
-       ! ----------------------------
-       ! 6. Write data for FORCING
-       ! ----------------------------
-       READ(10,*) CBLOCK
-       print*,'CBLOCK=',CBLOCK
--
-+      !
-       IF (CBLOCK.NE.'FORCING') THEN
-          print*,'the block FORCING is not present'
-          !
-       ELSE
--      !
--      !  Preparation for GP fields
--      !
--      LLCOSP = .FALSE.      
--      ALLOCATE(ZOUT (IDGL))
--      ZOUT(:) = 0.
--      !
--      ! loop for forcing
--      !
--      DO JFORC=1,NFORC
--
--         !  FORCING no JFORC
--         WRITE(YRECFM,'(A4,I3.3)') 'FORC',JFORC
--         print*,'YRECFM=',YRECFM
--         READ(10,*)
--         DO JLEV=1,IFLEV
-+        !
-+        !  Preparation for GP fields
-+        !
-+        LLCOSP = .FALSE.      
-+        ALLOCATE(ZOUT (IDGL))
-+        ZOUT(:) = 0.
-+        !
-+        ! loop for forcing
-+        !
-+        DO JFORC=1,NFORC
-+          !  FORCING no JFORC
-+          WRITE(YRECFM,'(A4,I3.3)') 'FORC',JFORC
-+          print*,'YRECFM=',YRECFM
-+          READ(10,*)
-+          DO JLEV=1,IFLEV
-             READ(10,*) ZZ
-             DO J = 1,IDGL
--               ZOUT(J)=ZZ
-+              ZOUT(J)=ZZ
-             ENDDO
-             WRITE (6,*)YRECFM,JLEV,ZOUT(1)
-             CALL FAIENC (IREP,IUFD,'S',JLEV,YRECFM,ZOUT,LLCOSP)
--         ENDDO            
--      !
--      ENDDO
--      !
--      DEALLOCATE (ZOUT)
-+          ENDDO            
-+        !
-+        ENDDO
-+        !
-+        DEALLOCATE (ZOUT)
-       ENDIF
-       ! ----------------------------
-       ! 7. Write data for SURFACE MAX=100.
-@@ -824,41 +878,43 @@ print*,'QV en spectral'
-       ALLOCATE(ZOUT (IDGL))
-       ZOUT(:) = 0.
-       DO I=1,100
--         READ(10,*)CHAMP
--         IF (CHAMP.EQ.'STOP') THEN 
--                 GOTO 999
--         ENDIF
--         READ(10,*)ZZ
--         print*,CHAMP(5:16),ZZ
--         DO J = 1,IDGL
--            ZOUT(J) = ZZ
--         ENDDO
--         CALL FAIENC(IREP,IUFD,CHAMP(1:4),JLEV,CHAMP(5:16),ZOUT,LLCOSP)
-+        READ(10,*)CHAMP
-+        WRITE(6,*) 'CHAMP',CHAMP
-+        IF (CHAMP.EQ.'STOP') THEN 
-+          GOTO 999
-+        ENDIF
-+        READ(10,*)ZZ
-+        WRITE(6,*) 'ZZ',ZZ
-+        print*,CHAMP(5:16),ZZ
-+        DO J = 1,IDGL
-+          ZOUT(J) = ZZ
-+        ENDDO
-+        CALL FAIENC(IREP,IUFD,CHAMP(1:4),JLEV,CHAMP(5:16),ZOUT,LLCOSP)
-       ENDDO
-       DEALLOCATE (ZOUT)
-       !
-       ! ---------
-       ! 8. Finish
-       ! ---------
--
-+      !
-       ! 8.1 Close the FA file
-  999  WRITE(6,*)'FERMETURE DU FICHIER FA'
-       LLOUT = .FALSE.
-       CALL LFILAF(IREP,IUFD,LLOUT)
-       CALL FAIRME(IREP,IUFD,'UNKNOWN')
--
-+      !
-       ! 8.2 The end
--
-+      !
-       IUFD   = IULOUT
-       LLNOMM = .TRUE.
-       LLERFA = .TRUE.
-       LLIMST = .FALSE.
-       INIMES = 2
-       IBARP  = INART
--
-+      !
-       CALL FAITOU(IREP,IUFD,LLNOMM,CLFILEOUT,'UNKNOWN', &
-      &            LLERFA,LLIMST,INIMES,IBARP,IBARI,CLMCA)
--
-+      !
-       DEALLOCATE(TRIGS)
-       DEALLOCATE(NESN0)
-       DEALLOCATE(NCPL4N)
-@@ -866,11 +922,11 @@ print*,'QV en spectral'
-       DEALLOCATE(IKMTMP)
-       DEALLOCATE(ZVALH)
-       DEALLOCATE(ZVBH)
--
--
-+      !
-+      !
-       WRITE(6,*)
-       WRITE(6,'(A)') 'END OF ACADFA'
-       CLOSE (6)
-       CLOSE(10)
--   STOP
--   END PROGRAM ACADFA1D_MAIN
-+      STOP
-+      END PROGRAM ACADFA1D_MAIN
-diff --git a/UTIL/Tools/ASCII2FA/src/libxrd.a b/UTIL/Tools/ASCII2FA/src/libxrd.a
-deleted file mode 100644
-index 4e4a59c..0000000
-Binary files a/UTIL/Tools/ASCII2FA/src/libxrd.a and /dev/null differ
-diff --git a/UTIL/Tools/ASCII2FA/src/real2spec.F90 b/UTIL/Tools/ASCII2FA/src/real2spec.F90
-index 5e804c6..4f69355 100644
---- a/UTIL/Tools/ASCII2FA/src/real2spec.F90
-+++ b/UTIL/Tools/ASCII2FA/src/real2spec.F90
-@@ -71,6 +71,7 @@ real :: zreal(ndgl + 2)
- 
- ! initialize I/O array with zeroes
- zreal(:)=0.
-+pspec(:)=0.
- zreal(1:ndgl) = preal(1:ndgl) 
- 
- ! -----
-diff --git a/UTIL/Tools/LFA/bin/cllangu b/UTIL/Tools/LFA/bin/cllangu
-index 9f95061..fb1e1b6 100755
-Binary files a/UTIL/Tools/LFA/bin/cllangu and b/UTIL/Tools/LFA/bin/cllangu differ
-diff --git a/UTIL/Tools/LFA/bin/lfa2lfa b/UTIL/Tools/LFA/bin/lfa2lfa
-index f902433..9ea0865 100755
-Binary files a/UTIL/Tools/LFA/bin/lfa2lfa and b/UTIL/Tools/LFA/bin/lfa2lfa differ
-diff --git a/UTIL/Tools/LFA/bin/lfa2lfp b/UTIL/Tools/LFA/bin/lfa2lfp
-index d2129e6..afc92d1 100755
-Binary files a/UTIL/Tools/LFA/bin/lfa2lfp and b/UTIL/Tools/LFA/bin/lfa2lfp differ
-diff --git a/UTIL/Tools/LFA/bin/lfa_autodocumentation b/UTIL/Tools/LFA/bin/lfa_autodocumentation
-index fa079a0..81a8c39 100755
-Binary files a/UTIL/Tools/LFA/bin/lfa_autodocumentation and b/UTIL/Tools/LFA/bin/lfa_autodocumentation differ
-diff --git a/UTIL/Tools/LFA/bin/lfa_demo b/UTIL/Tools/LFA/bin/lfa_demo
-index 64e0248..512a742 100755
-Binary files a/UTIL/Tools/LFA/bin/lfa_demo and b/UTIL/Tools/LFA/bin/lfa_demo differ
-diff --git a/UTIL/Tools/LFA/bin/lfac b/UTIL/Tools/LFA/bin/lfac
-index cfd4db8..da679d3 100755
-Binary files a/UTIL/Tools/LFA/bin/lfac and b/UTIL/Tools/LFA/bin/lfac differ
-diff --git a/UTIL/Tools/LFA/bin/lfacre b/UTIL/Tools/LFA/bin/lfacre
-index 5a4c669..49371c4 100755
-Binary files a/UTIL/Tools/LFA/bin/lfacre and b/UTIL/Tools/LFA/bin/lfacre differ
-diff --git a/UTIL/Tools/LFA/bin/lfadiff b/UTIL/Tools/LFA/bin/lfadiff
-index ea9c582..1098916 100755
-Binary files a/UTIL/Tools/LFA/bin/lfadiff and b/UTIL/Tools/LFA/bin/lfadiff differ
-diff --git a/UTIL/Tools/LFA/bin/lfadiffart b/UTIL/Tools/LFA/bin/lfadiffart
-index 44ba560..db4bfd8 100755
-Binary files a/UTIL/Tools/LFA/bin/lfadiffart and b/UTIL/Tools/LFA/bin/lfadiffart differ
-diff --git a/UTIL/Tools/LFA/bin/lfadiffrel b/UTIL/Tools/LFA/bin/lfadiffrel
-index e345de1..f6fb680 100755
-Binary files a/UTIL/Tools/LFA/bin/lfadiffrel and b/UTIL/Tools/LFA/bin/lfadiffrel differ
-diff --git a/UTIL/Tools/LFA/bin/lfafreq b/UTIL/Tools/LFA/bin/lfafreq
-index f02ec67..db12761 100755
-Binary files a/UTIL/Tools/LFA/bin/lfafreq and b/UTIL/Tools/LFA/bin/lfafreq differ
-diff --git a/UTIL/Tools/LFA/bin/lfalaf b/UTIL/Tools/LFA/bin/lfalaf
-index c6430df..d688e21 100755
-Binary files a/UTIL/Tools/LFA/bin/lfalaf and b/UTIL/Tools/LFA/bin/lfalaf differ
-diff --git a/UTIL/Tools/LFA/bin/lfaminm b/UTIL/Tools/LFA/bin/lfaminm
-index 57bff37..b54e404 100755
-Binary files a/UTIL/Tools/LFA/bin/lfaminm and b/UTIL/Tools/LFA/bin/lfaminm differ
-diff --git a/UTIL/Tools/LFA/bin/lfamoy b/UTIL/Tools/LFA/bin/lfamoy
-index 3dc0bda..24e2039 100755
-Binary files a/UTIL/Tools/LFA/bin/lfamoy and b/UTIL/Tools/LFA/bin/lfamoy differ
-diff --git a/UTIL/Tools/LFA/bin/lfareu b/UTIL/Tools/LFA/bin/lfareu
-index dfe3cf7..b9ee641 100755
-Binary files a/UTIL/Tools/LFA/bin/lfareu and b/UTIL/Tools/LFA/bin/lfareu differ
-diff --git a/UTIL/Tools/LFA/bin/lfatest b/UTIL/Tools/LFA/bin/lfatest
-index cde8c03..81268f2 100755
-Binary files a/UTIL/Tools/LFA/bin/lfatest and b/UTIL/Tools/LFA/bin/lfatest differ
-diff --git a/UTIL/Tools/LFA/bin/lfp2lfa b/UTIL/Tools/LFA/bin/lfp2lfa
-index bc737bb..b47a98e 100755
-Binary files a/UTIL/Tools/LFA/bin/lfp2lfa and b/UTIL/Tools/LFA/bin/lfp2lfa differ
-diff --git a/UTIL/install/install_MUSC.py b/UTIL/install/install_MUSC.py
-index 811f160..7a6cfec 100644
---- a/UTIL/install/install_MUSC.py
-+++ b/UTIL/install/install_MUSC.py
-@@ -13,7 +13,6 @@ repinit = os.getcwd()
- 
- repARPC_UTIL = mainrep + '/UTIL/Init_Forc/ARPCLIMAT/'
- repARO_UTIL = mainrep + '/UTIL/Init_Forc/AROME/'
--repARO46t1_UTIL = mainrep + '/UTIL/Init_Forc/AROME46t1/'
- repARP_UTIL = mainrep + '/UTIL/Init_Forc/ARPPNT/'
- repSFX_UTIL = mainrep + '/UTIL/Init_Forc/SURFEX/'
- repRun_UTIL = mainrep + '/UTIL/Runs/'
-@@ -38,8 +37,6 @@ def install_ATM(model,case,filecase,repout,nlev,timestep=None,subcase=None,lover
-       repUTIL = repARPC_UTIL
-     elif model == 'AROME':
-       repUTIL = repARO_UTIL
--    elif model == 'AROME46t1':
--      repUTIL = repARO46t1_UTIL      
-     elif model == 'ARPPNT':
-       repUTIL = repARP_UTIL
-     else:
-@@ -147,7 +144,7 @@ def install_SFX(model,case,filecase,repout,cycle,PGD,PREP,config,namref,subcase=
- 
-       g.close()
- 
--      os.system('cdat tmp.py')
-+      os.system('python tmp.py')
-       os.system('rm -f tmp.py')
-     
-       if lperf:
-@@ -183,7 +180,7 @@ def install_SFX(model,case,filecase,repout,cycle,PGD,PREP,config,namref,subcase=
- 
-         g.close()
- 
--        os.system('cdat tmp.py')
-+        os.system('python tmp.py')
-         os.system('rm -f tmp.py')
- 
-         os.system('./prepare_SURFEX.sh')
-@@ -308,7 +305,7 @@ def install_Run(model,case,filecase,repout,config,configOut,subcase=None,loverwr
- 
-       g.close()
- 
--      os.system('cdat tmp.py')
-+      os.system('python tmp.py')
-       os.system('rm -f tmp.py')
- 
-       if lperf:
-@@ -325,11 +322,11 @@ def install_Run(model,case,filecase,repout,config,configOut,subcase=None,loverwr
-         print >> g, 'filecase = "' + filecase + '"'
-         print >> g, 'namref = "' + config['namSFXref'] + '"'
-         print >> g, 'namout = "namsfx_' + config['name'] + '"'
--        print >> g, 'prepare_namSFX.prep_nam_SFX(case,filecase,namref,namout=namout)'
-+        print >> g, 'prepare_namSFX.prep_nam_SFX(case,filecase,namref,namout=namout,subcase="'+subcase+'")'
- 
-         g.close()
- 
--        os.system('cdat tmp.py')
-+        os.system('python tmp.py')
-         os.system('rm -f tmp.py')
- 
-         if lperf:
-@@ -523,13 +520,13 @@ def install_Atlas(case,repout,config,configAtlas,subcase=None,loverwrite=False,l
- 
-       g.close()
- 
--      os.system('cdat atlas.py')
-+      os.system('python atlas.py')
- 
-     else: 
-       print 'Directory already exists:', rep
-       if lupdate:
-         os.chdir(rep)
--        os.system('cdat atlas.py')
-+        os.system('python atlas.py')
-       else:
-         print 'Nothing is done'
- 
-diff --git a/UTIL/install/prepare_namATM_AROME.py b/UTIL/install/prepare_namATM_AROME.py
-index 4b36506..d0d9547 100644
---- a/UTIL/install/prepare_namATM_AROME.py
-+++ b/UTIL/install/prepare_namATM_AROME.py
-@@ -367,6 +367,8 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,ls
-       i=i+1
-       for it in range(0,nt):
-         nam[nn]['NL_LSW_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]      
-+  else:
-+      nam[nn]['LGEOST_UV_FRC'] = ['.FALSE.',]
-   if attributes['nudging_u'] > 0. or attributes['nudging_v'] > 0.:
-       nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-       nam[nn]['LUV_NUDG'] = ['.TRUE.',]
-@@ -388,10 +390,10 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,ls
-         nam[nn]['RZ0_FORC'] = [str(float(attributes['z0'])),]
-       else:
-         nam[nn]['RZ0_FORC'] = ['0.035',]
--      nam[nn]["NSH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
-+      nam[nn]["NSH_FORC_DEB"]=[str(int(1+i*nt+j*nt_sfc)),]
-       nam[nn]["NSH_FORC_NUM"]=[str(nt_sfc),]
-       j=j+1
--      nam[nn]["NLH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
-+      nam[nn]["NLH_FORC_DEB"]=[str(int(1+i*nt+j*nt_sfc)),]
-       nam[nn]["NLH_FORC_NUM"]=[str(nt_sfc),]
-       if nt_sfc == 1:
-         dt_sfc = 0.
-diff --git a/UTIL/install/prepare_namATM_AROME46t1.py b/UTIL/install/prepare_namATM_AROME46t1.py
-deleted file mode 100644
-index dccd3f8..0000000
---- a/UTIL/install/prepare_namATM_AROME46t1.py
-+++ /dev/null
-@@ -1,423 +0,0 @@
--#!/usr/bin/env python
--# -*- coding:UTF-8 -*-
--
--import namelist
--import cdms2
--import math
--
--
--def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,lsurfex=False):
--
--  """
--    Prepare AROME namelist for MUSC simulation, 
--    given information in filecase,
--    and from AROME namelist namref
--  """
--
--  if namout is None:
--    namout = namref + '_' + case
--    if subcase is not None:
--      namout = namout + '_' + subcase        
--
--  print '-'*40
--  print 'Prepare AROME namelist for MUSC'
--  print 'case:', case, 'subcase:', subcase
--  print 'Reference namelist:', namref
--  print 'Output namelist:', namout
--
--  nam = namelist.readarp(namref)
--
--  # -----------------------------------------------------------
--  # Some general modification in namref
--  # -----------------------------------------------------------
--
--  for namin in nam.keys():
--    for param in nam[namin].keys():
--      tmp = enumerate(nam[namin][param])
--      for i, obj in tmp:  
--        if obj == '.T.': nam[namin][param][i] = '.TRUE.'
--        if obj == '.F.': nam[namin][param][i] = '.FALSE.'
--        if obj == 'NDPROC': nam[namin][param][i] = '1'
--        if obj == 'NBPROC': nam[namin][param][i] = '1'
--        if obj == 'NCPROC': nam[namin][param][i] = '1'
--        if obj == 'NBPROC_IO': nam[namin][param][i] = '1'
--
--  # Aerosols and Ozone
--  #nam['NAMPHY']['LOZONE'] = ['.FALSE.',]
--  #nam['NAMPHY']['LRAYFM'] = ['.FALSE.',]
--  #nam['NAMPHY']['LO3ABC'] = ['.FALSE.',]
--  #nam['NAMPHY']['LAEROSEA'] = ['.FALSE.',]
--  #nam['NAMPHY']['LAEROLAN'] = ['.FALSE.',]
--  #nam['NAMPHY']['LAEROSOO'] = ['.FALSE.',]
--  #nam['NAMPHY']['LAERODES'] = ['.FALSE.',]
--  #nam['NAMPHY']['LEDR'] = ['.FALSE.',]
--  #nam['NAMPHY']['LO3FL'] = ['.FALSE.',]
--
--  # Empty a few namelists
--  for nn in ['NAMFPC','NAMFPD','NAMLSFORC','NAMDYNA','NAMFPSC2_DEP']:
--    del(nam[nn])
--    nam[nn] = {}
--
--  # Add a few namelists
--  for nn in []:
--    nam[nn] = {}      
--
--  # Update NAMGFL
--  fin = cdms2.open(filecase)
--  time = fin('temp').getTime()
--  nn='NAMGFL'
--  del(nam[nn])
--  nam[nn] = {}
--  nt = time.shape[0]
--  for param in nam[nn].keys():
--    if param[-6:] == 'NREQIN': nam[nn][param] = ['0',]
--    if param[-7:] == 'LREQOUT': nam[nn][param] = ['.FALSE.']
--  nam[nn]['NGFL_EZDIAG'] = ['23',]
--  for it in range(1,24):
--      nam[nn]['YEZDIAG_NL('+str(it)+')%CNAME'] = ["'EZDIAG"+str(it).zfill(2)+"'",]
--  for name in ['TKE','S','R','Q','L','I','G','CVGQ',]:
--      if name == 'CVGQ' : 
--        nam[nn]['Y'+name+'_NL%LCDERS'] = ['.FALSE.',]
--        nam[nn]['Y'+name+'_NL%LSP'] = ['.FALSE.',]      
--        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
--      elif name == 'G':
--        nam[nn]['Y'+name+'_NL%LPT'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
--        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
--      elif name == 'I':
--        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LPHY'] = ['.FALSE.',]
--        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
--        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
--        nam[nn]['Y'+name+'_NL%LADV'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
--      elif name == 'L':
--        nam[nn]['Y'+name+'_NL%LPHY'] = ['.FALSE.',]
--        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LADV'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
--        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
--      elif name == 'Q': 
--        nam[nn]['Y'+name+'_NL%LSP'] = ['.FALSE.',]      
--        nam[nn]['Y'+name+'_NL%LQM'] = ['.FALSE.',]
--        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
--        nam[nn]['Y'+name+'_NL%NREQIN'] = ['1',]
--      elif name == 'R': 
--        nam[nn]['Y'+name+'_NL%LPHY'] = ['.FALSE.',]
--        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
--        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
--        nam[nn]['Y'+name+'_NL%LADV'] = ['.TRUE.',]
--      elif name == 'S': 
--        nam[nn]['Y'+name+'_NL%LPHY'] = ['.FALSE.',]
--        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LADV'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
--        nam[nn]['Y'+name+'_NL%NREQIN'] = ['0',]
--      else: 
--        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LADV'] = ['.FALSE.',]
--        nam[nn]['Y'+name+'_NL%LGPINGP'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LQM'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LREQOUT'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%LT1'] = ['.TRUE.',]
--        nam[nn]['Y'+name+'_NL%NCOUPLING'] = ['0',]
--        nam[nn]['Y'+name+'_NL%NREQIN'] = ['-1',]
--        nam[nn]['Y'+name+'_NL%REFVALI'] = ['0.000001',]
--  
--  # Update due to MUSC/ALADIN config
--  nn = 'NAMDYN'
--  nam[nn]['LADVF'] = ['.FALSE.',]
--  nam[nn]['NSITER'] = ['0',]
--
--  # Update NAMDIM
--  nn='NAMDIM'
--  try:
--    del(nam[nn])
--  except KeyError:
--    pass      
--  nam[nn] = {}
--  nam[nn]['NPROMA'] = ['-4',]
--
--  # Update NAMDYNA
--  #nn='NAMDYNA'
--  #try:
--  #  del(nam[nn])
--  #except KeyError:
--  #  pass      
--  #nam[nn] = {}
--  #nam[nn]['NDLNPR'] = ['0',]
--
--# Update NAMIO_SERV
--  #nn='NAMIO_SERV'
--  #nam[nn]['NIO_SERV_BUF_MAXSIZE'] = ['0']
--  #nam[nn]['NPROCESS_LEVEL'] = ['0']
--  #nam[nn]['NPROC_IO'] = ['0']
--
--  # Update NAMCT1
--  #nn='NAMCT1'
--  #del(nam[nn])
--  #nam[nn] = {}
--  #nam[nn]['LRFILAF'] = ['.FALSE.',]
--  #nam[nn]['N1POS']=['1',]
--  #nam[nn]['N1RES']=['0',]
--  #nam[nn]['N1SFXHIS']=['0',]
--
--  # Update NAMCT0
--  nn = 'NAMCT0'
--  #nam['NAMCT0'] = {}
--  #nam[nn]['LAROME']=['.TRUE.',]
--  #nam[nn]['LREGETA']=['.TRUE.',]
--  #nam[nn]['LSPRT']=['.TRUE.',]
--  #nam[nn]['CNPPATH']=["'.'",]
--  #nam[nn]['LFDBOP']=['.FALSE.',]
--  #nam[nn]['LFBDAP']=['.TRUE.',]
--  nam[nn]['LSFORC']=['.TRUE.',]
--  nam[nn]['LSFORCS']=['.TRUE.',]
--  #nam[nn]['NFRHIS'] = ['1',]
--  #nam[nn]['NFPOS'] = ['1',]
--  #nam[nn]['NFRPOS'] = ['1',]
--  #nam[nn]['NFRSDI'] = ['1',]
--  #nam[nn]['NHISTS(0)'] = ['1',]
--  #nam[nn]['LGRIB_API']=['.FALSE.',]
--  #nam[nn]['LALLOPR']=['.FALSE.',]
--  #nam[nn]['NUNDEFLD'] = ['-99999999',]
--
--  # Update NAMXFU
--  nn =  'NAMXFU'
--  for param in nam[nn].keys():
--    if param[0] == 'L': nam[nn][param] = ['.FALSE.',]
--
--# Update NAMPAR0
--  nn = 'NAMPAR0'
--  del(nam[nn])
--  nam[nn]={}
--  nam[nn][' MBX_SIZE']=['2048000000',]
--  nam[nn][' NOUTPUT']=['1',]
--  nam[nn][' NPROC']=['1',]
--  nam[nn][' MP_TYPE']=['2',]
--  nam[nn][' LOPT_SCALAR']=['.TRUE.',]
--  nam[nn][' NPRINTLEV']=['1',]
--
--# Update NAMPAR1
--  nn = 'NAMPAR1'
--  del(nam[nn])
--  nam[nn]={}
--  nam[nn]['L_GATHERV_WRGP']=['.FALSE.',]
--  nam[nn]['LEQ_REGIONS']=['.FALSE.',]
--  nam[nn]['LSLONDEM']=['.TRUE.',]
--  nam[nn]['LSPLIT']=['.FALSE.',]
--  nam[nn]['LSYNC_SLCOM']=['.TRUE.',]
--  nam[nn]['LSYNC_TRANS']=['.TRUE.',]
--  nam[nn]['NCOMBFLEN']=['1800000',]
--  nam[nn]['NSTRIN']=['1',]
--  nam[nn]['NSTROUT']=['1',]
-- 
--# Update NAMPARAR
--  #nn='NAMPARAR'
--  #nam[nn]['CMF_CLOUD']=["'DIRE'",]
--  #nam[nn]['CMF_UPDRAFT']=["'EDKF'",]
--  #nam[nn]['LMIXUV']=['.TRUE.',]
--  #nam[nn]['NSWB_MNH']=['6',]
--
--# Update NAMARG
--
--  nn = 'NAMARG'
--  nam[nn]['CNMEXP'] = ["'ARPE'",]
--
--# Update NAMCFU
--
--  nn = 'NAMCFU'
--  for param in nam[nn].keys():
--    nam[nn][param] = [".FALSE.",]
--
--# Update NEMELBC0A
--
--  #nn = 'NEMELBC0A'
--  #nam[nn]['LESPCPL'] = [".FALSE.",]
--
--
--  # -----------------------------------------------------------
--  # Case specific modifications in namref
--  # -----------------------------------------------------------
--
--  attributes = {}
--  for att in ['tadvh','qdvh','qtadvh','uadvh','vadvh','tadvv','qadvv','qtadvv','uadvv','vadvv','tadv','qadv','uadv','vadv','trad','forc_omega','forc_w','forc_geo','nudging_t','nudging_q','nudging_u','nudging_v','surfaceForcing','z0','ustar']:
--    attributes[att] = 0
--
--  for att in ['p_nudging_t','p_nudging_q','p_nudging_u','p_nudging_v']:
--    attributes[att] = 110000.     
--  for att in fin.listglobal():
--    attributes[att] = fin.getglobal(att)
--
--  if attributes['surfaceForcing'] == "surfaceFlux" :
--    time_sfc = fin('sfc_sens_flx').getAxis(0)
--    nt_sfc = time_sfc.shape[0]
--
--  # Setting latitude and longitude
--  tmp = fin('temp')
--  lat = tmp.getLatitude()[0]
--  lon = tmp.getLongitude()[0]
--  nam['NEMGEO']['RLAT_ACAD'] = [str(float(lat)),]
--  nam['NEMGEO']['RLON_ACAD'] = [str(float(lon)),]
--
--  # Setting starting date
--  startDate = str(fin.startDate)
--  year = int(startDate[0:4])
--  month = int(startDate[4:6])
--  day = int(startDate[6:8])
--  hour = int(startDate[8:10])
--  minute = int(startDate[10:12])
--  second = int(startDate[12:14])
--  
--#  second = 0
--  #nam['NAMRIP']['NINDAT'] = [startDate[0:8],]
--  #nam['NAMRIP']['NSSSSS'] = [str(int(hour*3600+minute*60+second)),]
--  nam['NAMRIP']['TSTEP'] = [str(timestep),]
--  nam['NAMRIP']['CSTOP'] = ["'"+NSTOP+"'",]
--
--  # Case with no radiation or radiation included in temperature advection
--  nam['NAERAD']['LRRTM'] =  ['.FALSE.',]
--  if attributes['trad'] in [1,'adv']:
--    nam['NAMPHY']['LRAYFM'] = ['.FALSE.',]
--    nam['NAERAD']['LSRTM'] =  ['.FALSE.',]
--    nam['NAERAD']['NSW'] = ['6',]
--    nam['NAERAD']['NOZOCL'] = ['2',]
--
--  # MUSC Forcing
--  nn = 'NAMLSFORC'
--  del(nam[nn])
--  nam[nn] = {}
--
--  i=0 # compter
--  j=0 # compter
--  
--  if nt == 1:
--      dt = 0.
--  else:  
--      dt = time[1]-time[0]
--      
--  #for param in ['LFIXRAD','LGEOST_UV_FRC','LNOWINDTEND','LQV_ADV_FRC','LQV_NUDG','LSOMEGA_FRC','LSW_FRC','LT_ADV_FRC','LT_NUDG','LUV_ADV_FRC','LUV_NUDG']:
--  for param in ['LGEOST_UV_FRC','LQV_ADV_FRC','LT_ADV_FRC']:
--    nam[nn][param] = ['.FALSE.',]
--  nam[nn]['LMUSCLFA'] = ['.TRUE.',]
--  for param in ['NGEOST_U_NUM','NGEOST_V_NUM','NQV_ADV_NUM','NT_ADV_NUM']:
--    nam[nn][param] = ['-1',]
--
--  if attributes['tadv'] == 1 or attributes['tadvh'] == 1 or attributes['tadvv'] == 1:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LT_ADV_FRC'] = ['.TRUE.',]
--      nam[nn]['NT_ADV_DEB'] = [str(1+i*nt),]
--      nam[nn]['NT_ADV_NUM'] = [str(nt),]
--      i=i+1
--      for it in range(0,nt):
--           nam[nn]['NL_T_ADV_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]
--  if attributes['qadv'] == 1 or attributes['qadvh'] == 1 or attributes['qtadvh'] == 1 or attributes['qadvv'] == 1:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LQV_ADV_FRC'] = ['.TRUE.',]
--      nam[nn]['NQV_ADV_DEB'] = [str(1+i*nt),]
--      nam[nn]['NQV_ADV_NUM'] = [str(nt),]
--      i=i+1
--      for it in range(0,nt):
--           nam[nn]['NL_QV_ADV_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]
--  if attributes['uadvh'] == 1 or attributes['uadvh'] == 1 or attributes['uadvv'] == 1 or attributes['vadvv'] == 1:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LUV_ADV_FRC'] = ['.TRUE.',]
--  if attributes['forc_omega'] == 1:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LSOMEGA_FRC'] = ['.TRUE.',]
--  if attributes['forc_geo'] == 1:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LGEOST_UV_FRC'] = ['.TRUE.',]
--      W=7.2921e-5
--      nam[nn]['RCORIO_FORC'] = [str(2.*W*math.sin(lat*math.pi/180)),]
--      nam[nn]['NGEOST_U_DEB']=[str(1+nt*i),]
--      nam[nn]['NGEOST_U_NUM']=[str(nt),]
--      i=i+1
--      nam[nn]['NGEOST_V_DEB']=[str(1+nt*i),] 
--      nam[nn]['NGEOST_V_NUM']=[str(nt),]
--      i=i+1
--      for it in range(0,nt):
--        nam[nn]['NL_GEOST_UV_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]
--  if attributes['forc_w'] == 1:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LSW_FRC'] = ['TRUE',]  
--      nam[nn]['NLSW_DEB'] = [str(1+i*nt),]
--      nam[nn]['NLSW_NUM'] = [str(nt),]
--      i=i+1
--      for it in range(0,nt):
--        nam[nn]['NL_LSW_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]      
--  if attributes['nudging_u'] > 0. or attributes['nudging_v'] > 0.:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LUV_NUDG'] = ['.TRUE.',]
--      nam[nn]['RELAX_TAUU'] = [str(float(attributes['nudging_u'])),]
--      nam['NAMTOPH']['ETRELAXU'] = [str(float(attributes['p_nudging_u'])),]
--  if attributes['nudging_t'] > 0.:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LT_NUDG'] = ['.TRUE.',]
--      nam[nn]['RELAX_TAUT'] = [str(float(attributes['nudging_t'])),]
--      nam['NAMTOPH']['ETRELAXT'] = [str(float(attributes['p_nudging_t'])),]
--  if attributes['nudging_q'] > 0.:
--      nam["NAMCT0"]['LSFORC']=['.TRUE.',]
--      nam[nn]['LQV_NUDG'] = ['.TRUE.',]
--      nam[nn]['RELAX_TAUQ'] = [str(float(attributes['nudging_q'])),]
--      nam['NAMTOPH']['ETRELAXQ'] = [str(float(attributes['p_nudging_q'])),]
--  if attributes['surfaceForcing'] == "surfaceFlux" :
--      nam["NAMCT0"]['LSFORCS']=['.TRUE.',]
--      if attributes['z0'] > 0.:
--        nam[nn]['RZ0_FORC'] = [str(float(attributes['z0'])),]
--      else:
--        nam[nn]['RZ0_FORC'] = ['0.035',]
--      nam[nn]["NSH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
--      nam[nn]["NSH_FORC_NUM"]=[str(nt_sfc),]
--      j=j+1
--      nam[nn]["NLH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
--      nam[nn]["NLH_FORC_NUM"]=[str(nt_sfc),]
--      if nt_sfc == 1:
--        dt_sfc = 0.
--      else:  
--        dt_sfc = time_sfc[1]-time_sfc[0]
--      for it in range(0,nt_sfc):
--         nam[nn]['NL_SH_ADV_TIME(   '+str(int(it+1))+" )"]=[str(int(dt_sfc*it)),]
--         nam[nn]['NL_LH_ADV_TIME(   '+str(int(it+1))+" )"]=[str(int(dt_sfc*it)),]
--      nam["NAMPHYDS"]['NSFORC']=[str(int(2*nt_sfc)),]
--
--  nam['NAMGFL']['NGFL_FORC'] = [str(int(nt*i)),]
--
--
--
--# Do we use SURFEX or not 
--
--  if lsurfex : 
--     nam["NAMARPHY"]['LMSE'] = [".TRUE.",]
--  else:
--     nam["NAMARPHY"]['LMSE'] = [".FALSE.",]
--
--
--
--# -----------------------------------------------------------
--# Final writing
--# -----------------------------------------------------------
--
--  namelist.writearp(nam,namout)
--
--  print '-'*40
-diff --git a/UTIL/install/prepare_namATM_ARPCLIMAT.py b/UTIL/install/prepare_namATM_ARPCLIMAT.py
-index 54467a8..cd18815 100644
---- a/UTIL/install/prepare_namATM_ARPCLIMAT.py
-+++ b/UTIL/install/prepare_namATM_ARPCLIMAT.py
-@@ -70,6 +70,12 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None):
-   nam[nn]['YCVGQ_NL%LSP'] = ['.TRUE.',]
-   for param in nam[nn].keys():
-     if param[-6:] == 'NREQIN': nam[nn][param] = ['0',]
-+  if 'YL_NL%NREQIN' in nam[nn].keys():
-+    nam[nn]['YL_NL%NREQIN'] = ['1',]
-+  if 'YI_NL%NREQIN' in nam[nn].keys():    
-+    nam[nn]['YI_NL%NREQIN'] = ['1',]
-+  if 'YTKE_NL%NREQIN' in nam[nn].keys():    
-+    nam[nn]['YTKE_NL%NREQIN'] = ['1',]
- 
-   # Update due to MUSC/ALADIN config
-   nn = 'NAMDYN'
-diff --git a/UTIL/install/prepare_namATM_ARPPNT.py b/UTIL/install/prepare_namATM_ARPPNT.py
-index 4ca9fa5..0d137e1 100644
---- a/UTIL/install/prepare_namATM_ARPPNT.py
-+++ b/UTIL/install/prepare_namATM_ARPPNT.py
-@@ -271,6 +271,8 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,ls
-       i=i+1
-       for it in range(0,nt):
-         nam[nn]['NL_LSW_TIME(   '+str(int(it+1))+' )']=[str(int(dt*it)),]      
-+  else:
-+      nam[nn]['LGEOST_UV_FRC'] = ['.FALSE.',]
-   if attributes['nudging_u'] > 0. or attributes['nudging_v'] > 0.:
-       nam["NAMCT0"]['LSFORC']=['.TRUE.',]
-       nam[nn]['LUV_NUDG'] = ['.TRUE.',]
-@@ -292,10 +294,10 @@ def prep_nam_ATM(case,filecase,namref,timestep,NSTOP,namout=None,subcase=None,ls
-         nam[nn]['RZ0_FORC'] = [str(float(attributes['z0'])),]
-       else:
-         nam[nn]['RZ0_FORC'] = ['0.035',]
--      nam[nn]["NSH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
-+      nam[nn]["NSH_FORC_DEB"]=[str(int(1+i*nt+j*nt_sfc)),]
-       nam[nn]["NSH_FORC_NUM"]=[str(nt_sfc),]
-       j=j+1
--      nam[nn]["NLH_FORC_DEB"]=[str(int(1+j*nt_sfc)),]
-+      nam[nn]["NLH_FORC_DEB"]=[str(int(1+i*nt+j*nt_sfc)),]
-       nam[nn]["NLH_FORC_NUM"]=[str(nt_sfc),]
-       if nt_sfc == 1:
-         dt_sfc = 0.
-diff --git a/UTIL/post_DEPHY/convert2p.py b/UTIL/post_DEPHY/convert2p.py
-index 5c02a0b..019fcbc 100644
---- a/UTIL/post_DEPHY/convert2p.py
-+++ b/UTIL/post_DEPHY/convert2p.py
-@@ -69,8 +69,10 @@ for var in var2save:
-     for att in data0.listattributes():
-       data.setattribute(att,data0.getattribute(att))
- 
-+    #print MV2.min(data), MV2.max(data)
-     g.write(data)
-   else:
-+    #print MV2.min(data0), MV2.max(data0)
-     g.write(data0)	  
- 
- 
-diff --git a/UTIL/post_DEPHY/convert2p.so b/UTIL/post_DEPHY/convert2p.so
-index eed38ec..20cd20c 100755
-Binary files a/UTIL/post_DEPHY/convert2p.so and b/UTIL/post_DEPHY/convert2p.so differ
-diff --git a/UTIL/post_DEPHY/convert2z.so b/UTIL/post_DEPHY/convert2z.so
-index 690cb49..a432ba5 100755
-Binary files a/UTIL/post_DEPHY/convert2z.so and b/UTIL/post_DEPHY/convert2z.so differ
-diff --git a/UTIL/post_DEPHY/convertLFA2nc.py b/UTIL/post_DEPHY/convertLFA2nc.py
-index a229b45..8bd1f65 100755
---- a/UTIL/post_DEPHY/convertLFA2nc.py
-+++ b/UTIL/post_DEPHY/convertLFA2nc.py
-@@ -9,44 +9,44 @@ else:
-     os.system('rm -f netcdf/*')
- 
- os.system('python lfa2nc_part1.py')
--os.system('cdat lfa2nc_part2.py')
-+os.system('python lfa2nc_part2.py')
- 
- os.system('mv Out_klevel.nc netcdf/')
- 
- if config.convertk1h:
--    os.system('cdat convertk_to_1hourly.py')
-+    os.system('python convertk_to_1hourly.py')
- 
- if config.convertk3h:
-     print 'convertk3h not coded yet'
-     pass #sys.exit()
--    #os.system('cdat convertk_to_3hourly.py')
-+    #os.system('python convertk_to_3hourly.py')
- 
- if config.convertkday:
--    os.system('cdat convertk_to_daily.py')
-+    os.system('python convertk_to_daily.py')
- 
- 
- if config.convert2p:
--    os.system('cdat convert2p.py')
-+    os.system('python convert2p.py')
-     if config.convertp1h:
--        os.system('cdat convertp_to_1hourly.py')
-+        os.system('python convertp_to_1hourly.py')
- 
-     if config.convertp3h:
--        os.system('cdat convertp_to_3hourly.py')
-+        os.system('python convertp_to_3hourly.py')
- 
-     if config.convertpday:
--        os.system('cdat convertp_to_daily.py')
-+        os.system('python convertp_to_daily.py')
- 
- 
- if config.convert2z:
--    os.system('cdat convert2z.py')
-+    os.system('python convert2z.py')
-     if config.convertz1h:
--        os.system('cdat convertz_to_1hourly.py')
-+        os.system('python convertz_to_1hourly.py')
- 
-     if config.convertz3h:
-         print 'convertz3h not coded yet'
-         pass #sys.exit()
--        #os.system('cdat convertz_to_3hourly.py')
-+        #os.system('python convertz_to_3hourly.py')
- 
-     if config.convertzday:
--        os.system('cdat convertz_to_daily.py')
-+        os.system('python convertz_to_daily.py')
- 
-diff --git a/UTIL/post_DEPHY/convertp_to_daily.py b/UTIL/post_DEPHY/convertp_to_daily.py
-index 3cbdf17..5a889fb 100644
---- a/UTIL/post_DEPHY/convertp_to_daily.py
-+++ b/UTIL/post_DEPHY/convertp_to_daily.py
-@@ -1,6 +1,7 @@
- import cdms2
- import MV2
- import cdtime
-+import numpy as np
- #from sets import Set
- 
- cdms2.setNetcdfShuffleFlag(0)
-@@ -17,7 +18,7 @@ nt0 = time0.shape[0]
- t0 = cdtime.reltime(time0[0],time0.units)
- dt = time0[1]-time0[0]
- 
--nt = int(nt0*dt/86400)-1
-+nt = int(nt0*dt/86400)#-1
- 
- kt = int(86400/dt)
- nt1 = kt*nt
-@@ -42,6 +43,13 @@ for var in f.listvariables():
-   rms = 0.
- 
-   tmp = f(var, squeeze=1)
-+  if len(tmp.shape) == 2 and tmp.shape[1] >= 10:
-+    lev = tmp.getLevel()
-+
-+  if var in ['rsuscs','rsdscs']:
-+    tmp = MV2.where(np.isnan(tmp),0,tmp) # problem with nan values... to be understood in MUSC...
-+
-+  #print MV2.min(tmp),MV2.max(tmp)
- 
-   for it in range(0,kt+1):
-     if it == 0:
-@@ -57,8 +65,9 @@ for var in f.listvariables():
-   data.setAxis(0,time)
-   rms.setAxis(0,time)
- 
-+  #print MV2.min(data),MV2.max(data)
-+
-   if len(tmp.shape) == 2 and tmp.shape[1] >= 10:
--    lev = tmp.getLevel()	 
-     data.setAxis(1,lev)
-     rms.setAxis(1,lev)
- 
-diff --git a/UTIL/post_DEPHY/lfa2nc_part1.py b/UTIL/post_DEPHY/lfa2nc_part1.py
-index 490d80d..a0f1633 100644
---- a/UTIL/post_DEPHY/lfa2nc_part1.py
-+++ b/UTIL/post_DEPHY/lfa2nc_part1.py
-@@ -235,6 +235,5 @@ for file in sorted(files):
- 
-         data[var][it] = tmp
- 
--
- f.close()
- 
-diff --git a/UTIL/post_DEPHY/lfa2nc_part2.py b/UTIL/post_DEPHY/lfa2nc_part2.py
-index 84f7336..d495b62 100644
---- a/UTIL/post_DEPHY/lfa2nc_part2.py
-+++ b/UTIL/post_DEPHY/lfa2nc_part2.py
-@@ -41,6 +41,7 @@ if saveall:
-       var2save.append(var)
-       varnames[var] = var
-       names[var] = var
-+      coefs[var] = 1.
-       varunits[var] = '-'
- else:
-   var2save0 = f.listvariables()
-@@ -54,6 +55,7 @@ else:
-       var2save1.append(var)
-       varnames[var] = var
-       names[var] = var
-+      coefs[var] = 1.
-       varunits[var] = '-'
-   var2save = set(var2save).intersection(set(var2save1))
- 
-@@ -274,7 +276,7 @@ if lmisr:
- g = cdms2.open('Out_klevel.nc','w')
- for var in var2save:
-   if config.verbose >= 1:
--    print var	
-+    print var
-   data = f(varnames[var])*coefs[var]
-   data = MV2.array(data, typecode=MV2.float32)
-   if var in ['cltcalipso','cllcalipso','clmcalipso','clhcalipso','clcalipso','cllcalipsoice','clmcalipsoice','clhcalipsoice','cltcalipsoice','cllcalipsoliq','clmcalipsoliq','clhcalipsoliq','cltcalipsoliq','cllcalipsoun','clmcalipsoun','clhcalipsoun','cltcalipsoun','clcalipso','lidarBetaMol532','clcalipsoice','clcalipsoliq','clcalipsoun','clcalipsotmp','clcalipsotmpice','clcalipsotmpliq','clcalipsotmpun','parasolRefl','cltlidarradar','clcalipso2','cltisccp','pctisccp','tauisccp','albisccp','meantbisccp','meantbclrisccp','boxtauisccp','boxptopisccp','cltmodis','clwmodis','climodis','clhmodis','clmmodis','cllmodis','tautmodis','tauwmodis','tauimodis','tautlogmodis','tauwlogmodis','tauilogmodis','reffclwmodis','reffclimodis','pctmodis','lwpmodis','iwpmodis','fracout', 'atb532', 'dbze94','cfadDbze94','cfadLidarsr532','clisccp', 'clmodis','clMISR']:
-diff --git a/UTIL/python/lfa.so b/UTIL/python/lfa.so
-index e757e1f..fa60fc2 100755
-Binary files a/UTIL/python/lfa.so and b/UTIL/python/lfa.so differ
-diff --git a/UTIL/python/lfa/makelib.sh b/UTIL/python/lfa/makelib.sh
-index 245f06e..6ab2673 100755
---- a/UTIL/python/lfa/makelib.sh
-+++ b/UTIL/python/lfa/makelib.sh
-@@ -1,5 +1,7 @@
- #!/bin/bash
- 
-+source activate myuvcdat
-+
- DIR0=`pwd`
- 
- for ff in cllang caracteres_lfa lfa
-@@ -11,7 +13,7 @@ done
- 
- gfortran -L$DIR0 -llfa -I$DIR0 -fconvert=big-endian -cpp  -c -fPIC -o famusc.o famusc.f90
- 
--/opt/cdat/bin/f2py -I/opt/cdat/include -lgfortran -c famusc.pyf famusc.o liblfa.a
-+f2py -lgfortran -c famusc.pyf famusc.o liblfa.a
- 
- rm -f *.o *.mod *.a
- 
-@@ -20,3 +22,5 @@ mv lfa.so ../
- # Test
- 
- #python tmp.py
-+
-+source deactivate myuvcdat
-diff --git a/UTIL/python/lfa/makelib.sh.cnrm b/UTIL/python/lfa/makelib.sh.cnrm
-deleted file mode 100644
-index f08dba5..0000000
---- a/UTIL/python/lfa/makelib.sh.cnrm
-+++ /dev/null
-@@ -1,18 +0,0 @@
--
--
--#/opt/cdat/bin/f2py -m lfa -h famusc.pyf famusc.f90 (comment lfaread* subroutines)
--gfortran -I./ -fconvert=big-endian -cpp  -c -fPIC cllang.f90
--gfortran -I./ -fconvert=big-endian -cpp  -c -fPIC caracteres_lfa.f90
--gfortran -I./ -fconvert=big-endian -cpp  -c -fPIC lfa.f90
--ar r liblfa.a *.o
--gfortran -L./ -llfa -I./ -fconvert=big-endian -cpp  -c -fPIC -o famusc.o famusc.f90
--#f2py -L./ -llfa -lm -lgfortran --f77flags='-L./ -llfa -I./ -fPIC -fconvert=big-endian -cpp' --f90flags='-L./ -llfa -I./ -fPIC -fconvert=big-endian -cpp' --fcompiler=gnu95 -c famusc.pyf famusc.o
--/opt/cdat/bin/f2py -I/opt/cdat/include -L./ -llfa -lm -lgfortran --f77flags='-L./ -llfa -I./ -fPIC -fconvert=big-endian -cpp' --f90flags='-L./ -llfa -I./ -fPIC -fconvert=big-endian -cpp' --fcompiler=gnu95 -c famusc.pyf famusc.o
--
--##Ne fonctionne pas...
--#pgf90 -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -c -fPIC cllang.f90
--#pgf90 -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -c -fPIC caracteres_lfa.f90
--#pgf90 -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -c -fPIC lfa.f90
--#ar r liblfa.a *.o
--#pgf90 -L./ -llfa -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -c -fPIC -o famusc.o famusc.f90
--#/opt/cdat/bin/f2py -L./ -llfa --f77flags='-L./ -llfa -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -fPIC' --f90flags='-L./ -llfa -I./ -Mpreprocess -Mextend -Kieee -byteswapio info=inform-Dr4pre2 -fPIC' --fcompiler=pg -c famusc.pyf famusc.o
-diff --git a/install_macRR.sh b/install_macRR.sh
-new file mode 100755
-index 0000000..821e115
---- /dev/null
-+++ b/install_macRR.sh
-@@ -0,0 +1,133 @@
-+#!/bin/sh
-+
-+set -evx
-+
-+#####################################################
-+# User specific
-+
-+REP_EMS=$HOME/Tools/EMS
-+REP_MUSC=$HOME/MUSC
-+
-+#####################################################
-+
-+
-+
-+DIR0=`pwd`
-+
-+#####################################################
-+# Some tests to avoid overwriting
-+
-+if [ -d $REP_EMS ]; then
-+  echo "REP_EMS="$REP_EMS
-+  echo "REP_EMS already exists. Please remove it or modify REP_EMS at the top of install_macRR.sh"
-+  exit
-+fi
-+
-+if [ -d $REP_MUSC ]; then
-+  echo "REP_MUSC="$REP_MUSC
-+  echo "REP_MUSC already exists. Please remove it or modify REP_MUSC at the top of install_macRR.sh"
-+  exit
-+fi
-+
-+#####################################################
-+# Download and install EMS in REP_EMS
-+[ -d $REP_EMS ] || mkdir -p $REP_EMS
-+cd $REP_EMS
-+git clone https://github.com/romainroehrig/EMS.git .
-+git checkout macRR
-+
-+# Modify your .bash_profile to initialize a few environment variables
-+cd ~/
-+
-+# save profile
-+cat .profile > .profile.EMS-saved_$(date +"%Y-%m-%d_at_%H:%M:%S")
-+
-+# Modify it
-+sed -i '' "/^export REP_EMS=/ s/$/ #commented on $(date)/" .profile
-+sed -i '' "s/^export REP_EMS=/#&/" .profile
-+sed -i '' "/^export REP_MUSC=/ s/$/ #commented on $(date)/" .profile
-+sed -i '' "s/^export REP_MUSC=/#&/" .profile
-+sed -i '' "/^export PYTHONPATH=.:\$REP_EMS/ s/$/ #commented on $(date)/" .profile
-+sed -i '' "s/^export PYTHONPATH=.:\$REP_EMS/#&/" .profile
-+
-+cat << EOF >> .profile
-+
-+# Modifications for Environment for MUSC simulations (EMS)
-+# included on $(date)
-+export REP_EMS=$REP_EMS
-+export REP_MUSC=$REP_MUSC
-+export PYTHONPATH=.:\$REP_EMS/CASES:\$REP_EMS/UTIL/python:\$REP_EMS/UTIL/install/:\$PYTHONPATH
-+EOF
-+
-+. ~/.profile
-+
-+# Some compilation if you want
-+compile="n"
-+
-+if [ $compile == "y" ]; then
-+
-+  # lfa python library
-+  cd $REP_EMS/UTIL/python/lfa
-+  ./makelib.sh
-+
-+  # ascii2lfa binary
-+  cd $REP_EMS/UTIL/Tools/ASCII2FA/src
-+  #cp /Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/lib/libxrd.local.a libxrd.a
-+  #cp /Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/lib/libxla.local.a libxla.a
-+  #cp /Users/romainroehrig/libraries/auxlibs/GNU/auxlibs/lib/libgribex.a libgribex.a
-+  #cp /Users/romainroehrig/libraries/auxlibs/GNU/auxlibs/lib/libmpidummy.a libmpidummy.a
-+  make all
-+  make clean
-+
-+  # LFA tools
-+  cd $REP_EMS//UTIL/Tools/LFA
-+  ./install
-+
-+  # a few python libraries
-+  source activate myuvcdat
-+
-+  cd $REP_EMS/UTIL/Init_Forc/ARPCLIMAT
-+  f2py -c interpvertp.F90 -m interpvertp
-+  cd $REP_EMS/UTIL/post_DEPHY
-+  f2py -c convert2p.F90 -m convert2p
-+  f2py -c convert2z.F90 -m convert2z
-+
-+  source deactivate myuvcdat
-+
-+fi
-+
-+#####################################################
-+# Prepare what is needed to run MUSC simulations in REP_MUSC
-+[ -d $REP_MUSC ] || mkdir -p $REP_MUSC
-+cd $REP_MUSC
-+cp -r $REP_EMS/Examples/* .
-+ln -s $REP_EMS/main/install_ATM_cases.py install_ATM_cases.py
-+ln -s $REP_EMS/main/install_SFX_cases.py install_SFX_cases.py
-+ln -s $REP_EMS/main/run_MUSC_cases.py run_MUSC_cases.py
-+
-+for ff in convertLFA2nc.py convertp_to_1hourly.py convertz_to_1hourly.py lfa2nc_part2.py convert2p.py convert2z.py convertk_to_1hourly.py convertp_to_3hourly.py convertz_to_daily.py convert2p.so convert2z.so convertk_to_daily.py convertp_to_daily.py lfa2nc_part1.py
-+do
-+
-+  ln -s $REP_EMS/UTIL/post_DEPHY/$ff $REP_MUSC/post/$ff
-+
-+done
-+
-+#####################################################
-+# Some Testing
-+cd $REP_MUSC
-+
-+source activate myuvcdat
-+
-+./install_ATM_cases.py AYOTTE 24SC
-+[ -f $REP_MUSC/ATM/ARPCLIMAT/AYOTTE/24SC/initfile_L91 ] || echo "PROBLEM with install_ATM_cases.py"
-+
-+./install_SFX_cases.py config/config_arp631_CMIP6.py AYOTTE 24SC
-+[ -f $REP_MUSC/SURFEX/arp631/CMIP6/AYOTTE/24SC/PGD.lfi ] || echo "PROBLEM with install_SFX_cases.py: PGD"
-+[ -f $REP_MUSC/SURFEX/arp631/CMIP6/AYOTTE/24SC/PREP.lfi ] || echo "PROBLEM with install_SFX_cases.py: PREP"
-+
-+./run_MUSC_cases.py config/config_arp631_CMIP6.py AYOTTE 24SC
-+[ -f $REP_MUSC/simulations/arp631/CMIP6/L91_300s/AYOTTE/24SC/Output/netcdf/Out_klevel.nc ] || echo "PROBLEM with run_MUSC_cases.py"
-+
-+#####################################################
-+# Back in directory where installation was launched
-+cd $DIR0
-diff --git a/main/install_ATM_cases.py b/main/install_ATM_cases.py
-index f315997..6c31544 100755
---- a/main/install_ATM_cases.py
-+++ b/main/install_ATM_cases.py
-@@ -1,4 +1,4 @@
--#!/usr/bin/env cdat
-+#!/usr/bin/env python
- # -*- coding:UTF-8 -*-
- 
- #
-@@ -32,7 +32,7 @@ except:
-     pass
- 
- model = configsim.model
--if model not in ['AROME','AROME46t1','ARPPNT','ARPCLIMAT']:
-+if model not in ['AROME','ARPPNT','ARPCLIMAT']:
-   print 'Model unexpected:', configsim.model
-   sys.exit()
- 
-@@ -41,7 +41,7 @@ repout = REP_MUSC + '/ATM/' + model + '/'
- 
- nlev = configsim.nlev
- timestep = configsim.timestep
--if model in ['AROME','AROME46t1','ARPPNT']:
-+if model in ['AROME','ARPPNT']:
-     timestep = None
- 
- 
-diff --git a/main/install_SFX_cases.py b/main/install_SFX_cases.py
-index 86cc76b..e145372 100755
---- a/main/install_SFX_cases.py
-+++ b/main/install_SFX_cases.py
-@@ -1,4 +1,4 @@
--#!/usr/bin/env cdat
-+#!/usr/bin/env python
- # -*- coding:UTF-8 -*-
- 
- #
-diff --git a/main/run_MUSC_cases.py b/main/run_MUSC_cases.py
-index 594bf8f..5e75635 100755
---- a/main/run_MUSC_cases.py
-+++ b/main/run_MUSC_cases.py
-@@ -1,4 +1,4 @@
--#!/usr/bin/env cdat
-+#!/usr/bin/env python
- # -*- coding:UTF-8 -*-
- 
- #
diff --git a/install_macRR.sh b/install_macRR.sh
new file mode 100755
index 0000000..821e115
--- /dev/null
+++ b/install_macRR.sh
@@ -0,0 +1,133 @@
+#!/bin/sh
+
+set -evx
+
+#####################################################
+# User specific
+
+REP_EMS=$HOME/Tools/EMS
+REP_MUSC=$HOME/MUSC
+
+#####################################################
+
+
+
+DIR0=`pwd`
+
+#####################################################
+# Some tests to avoid overwriting
+
+if [ -d $REP_EMS ]; then
+  echo "REP_EMS="$REP_EMS
+  echo "REP_EMS already exists. Please remove it or modify REP_EMS at the top of install_macRR.sh"
+  exit
+fi
+
+if [ -d $REP_MUSC ]; then
+  echo "REP_MUSC="$REP_MUSC
+  echo "REP_MUSC already exists. Please remove it or modify REP_MUSC at the top of install_macRR.sh"
+  exit
+fi
+
+#####################################################
+# Download and install EMS in REP_EMS
+[ -d $REP_EMS ] || mkdir -p $REP_EMS
+cd $REP_EMS
+git clone https://github.com/romainroehrig/EMS.git .
+git checkout macRR
+
+# Modify your .bash_profile to initialize a few environment variables
+cd ~/
+
+# save profile
+cat .profile > .profile.EMS-saved_$(date +"%Y-%m-%d_at_%H:%M:%S")
+
+# Modify it
+sed -i '' "/^export REP_EMS=/ s/$/ #commented on $(date)/" .profile
+sed -i '' "s/^export REP_EMS=/#&/" .profile
+sed -i '' "/^export REP_MUSC=/ s/$/ #commented on $(date)/" .profile
+sed -i '' "s/^export REP_MUSC=/#&/" .profile
+sed -i '' "/^export PYTHONPATH=.:\$REP_EMS/ s/$/ #commented on $(date)/" .profile
+sed -i '' "s/^export PYTHONPATH=.:\$REP_EMS/#&/" .profile
+
+cat << EOF >> .profile
+
+# Modifications for Environment for MUSC simulations (EMS)
+# included on $(date)
+export REP_EMS=$REP_EMS
+export REP_MUSC=$REP_MUSC
+export PYTHONPATH=.:\$REP_EMS/CASES:\$REP_EMS/UTIL/python:\$REP_EMS/UTIL/install/:\$PYTHONPATH
+EOF
+
+. ~/.profile
+
+# Some compilation if you want
+compile="n"
+
+if [ $compile == "y" ]; then
+
+  # lfa python library
+  cd $REP_EMS/UTIL/python/lfa
+  ./makelib.sh
+
+  # ascii2lfa binary
+  cd $REP_EMS/UTIL/Tools/ASCII2FA/src
+  #cp /Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/lib/libxrd.local.a libxrd.a
+  #cp /Users/romainroehrig/rootpack/arp603_export.01.MPIGNU640.x/lib/libxla.local.a libxla.a
+  #cp /Users/romainroehrig/libraries/auxlibs/GNU/auxlibs/lib/libgribex.a libgribex.a
+  #cp /Users/romainroehrig/libraries/auxlibs/GNU/auxlibs/lib/libmpidummy.a libmpidummy.a
+  make all
+  make clean
+
+  # LFA tools
+  cd $REP_EMS//UTIL/Tools/LFA
+  ./install
+
+  # a few python libraries
+  source activate myuvcdat
+
+  cd $REP_EMS/UTIL/Init_Forc/ARPCLIMAT
+  f2py -c interpvertp.F90 -m interpvertp
+  cd $REP_EMS/UTIL/post_DEPHY
+  f2py -c convert2p.F90 -m convert2p
+  f2py -c convert2z.F90 -m convert2z
+
+  source deactivate myuvcdat
+
+fi
+
+#####################################################
+# Prepare what is needed to run MUSC simulations in REP_MUSC
+[ -d $REP_MUSC ] || mkdir -p $REP_MUSC
+cd $REP_MUSC
+cp -r $REP_EMS/Examples/* .
+ln -s $REP_EMS/main/install_ATM_cases.py install_ATM_cases.py
+ln -s $REP_EMS/main/install_SFX_cases.py install_SFX_cases.py
+ln -s $REP_EMS/main/run_MUSC_cases.py run_MUSC_cases.py
+
+for ff in convertLFA2nc.py convertp_to_1hourly.py convertz_to_1hourly.py lfa2nc_part2.py convert2p.py convert2z.py convertk_to_1hourly.py convertp_to_3hourly.py convertz_to_daily.py convert2p.so convert2z.so convertk_to_daily.py convertp_to_daily.py lfa2nc_part1.py
+do
+
+  ln -s $REP_EMS/UTIL/post_DEPHY/$ff $REP_MUSC/post/$ff
+
+done
+
+#####################################################
+# Some Testing
+cd $REP_MUSC
+
+source activate myuvcdat
+
+./install_ATM_cases.py AYOTTE 24SC
+[ -f $REP_MUSC/ATM/ARPCLIMAT/AYOTTE/24SC/initfile_L91 ] || echo "PROBLEM with install_ATM_cases.py"
+
+./install_SFX_cases.py config/config_arp631_CMIP6.py AYOTTE 24SC
+[ -f $REP_MUSC/SURFEX/arp631/CMIP6/AYOTTE/24SC/PGD.lfi ] || echo "PROBLEM with install_SFX_cases.py: PGD"
+[ -f $REP_MUSC/SURFEX/arp631/CMIP6/AYOTTE/24SC/PREP.lfi ] || echo "PROBLEM with install_SFX_cases.py: PREP"
+
+./run_MUSC_cases.py config/config_arp631_CMIP6.py AYOTTE 24SC
+[ -f $REP_MUSC/simulations/arp631/CMIP6/L91_300s/AYOTTE/24SC/Output/netcdf/Out_klevel.nc ] || echo "PROBLEM with run_MUSC_cases.py"
+
+#####################################################
+# Back in directory where installation was launched
+cd $DIR0
diff --git a/main/install_ATM_cases.py b/main/install_ATM_cases.py
index f315997..6c31544 100755
--- a/main/install_ATM_cases.py
+++ b/main/install_ATM_cases.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env cdat
+#!/usr/bin/env python
 # -*- coding:UTF-8 -*-
 
 #
@@ -32,7 +32,7 @@ except:
     pass
 
 model = configsim.model
-if model not in ['AROME','AROME46t1','ARPPNT','ARPCLIMAT']:
+if model not in ['AROME','ARPPNT','ARPCLIMAT']:
   print 'Model unexpected:', configsim.model
   sys.exit()
 
@@ -41,7 +41,7 @@ repout = REP_MUSC + '/ATM/' + model + '/'
 
 nlev = configsim.nlev
 timestep = configsim.timestep
-if model in ['AROME','AROME46t1','ARPPNT']:
+if model in ['AROME','ARPPNT']:
     timestep = None
 
 
diff --git a/main/install_SFX_cases.py b/main/install_SFX_cases.py
index 86cc76b..e145372 100755
--- a/main/install_SFX_cases.py
+++ b/main/install_SFX_cases.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env cdat
+#!/usr/bin/env python
 # -*- coding:UTF-8 -*-
 
 #
diff --git a/main/run_MUSC_cases.py b/main/run_MUSC_cases.py
index 594bf8f..5e75635 100755
--- a/main/run_MUSC_cases.py
+++ b/main/run_MUSC_cases.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env cdat
+#!/usr/bin/env python
 # -*- coding:UTF-8 -*-
 
 #
